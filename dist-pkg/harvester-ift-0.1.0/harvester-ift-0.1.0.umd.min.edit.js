(("undefined"!==typeof self?self:this)["webpackJsonpharvester_ift_0_1_0"]=("undefined"!==typeof self?self:this)["webpackJsonpharvester_ift_0_1_0"]||[]).push([[6],{"0e4c":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("Loading",{attrs:{mode:"relative",loading:e.loading}}),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hev-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hev-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),options:e.VOLUME_TYPE,required:"",mode:e.mode},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hav-storage"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.storage.storageClass.label"),value:e.value.storageClassName,mode:e.mode}},[t("LabeledSelect",{attrs:{options:e.storageClassOptions,label:e.t("harvester.storage.storageClass.label"),mode:e.mode,disabled:e.isDisabled,required:e.validateRequired},on:{input:e.update},model:{value:e.value.storageClassName,callback:function(t){e.$set(e.value,"storageClassName",t)},expression:"value.storageClassName"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hev-size"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.size"),value:e.value.size,mode:e.mode}},[t("UnitInput",{attrs:{"output-modifier":!0,increment:1024,"input-exponent":3,mode:e.mode,min:10,required:e.validateRequired,label:e.t("harvester.fields.size")},on:{input:e.update},model:{value:e.value.size,callback:function(t){e.$set(e.value,"size",t)},expression:"value.size"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-3",attrs:{"data-testid":"input-hev-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),mode:e.mode,options:e.InterfaceOption,required:""},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])],1)},i=[],l=a("15ca"),r=a("4978"),o=a("5361"),n=a("8e93"),d=a("466b"),u=a("907c"),c=a("d37d"),m=a("7c47"),p=a("90cd"),v={name:"HarvesterEditVolume",components:{InputOrDisplay:o["a"],Loading:l["a"],LabeledInput:n["a"],LabeledSelect:d["a"],UnitInput:r["a"]},props:{mode:{type:String,default:"create"},isEdit:{type:Boolean,default:!1},value:{type:Object,default:()=>({})},validateRequired:{type:Boolean,required:!0},isVirtualType:{type:Boolean,default:!0}},data(){return{VOLUME_TYPE:m["e"],InterfaceOption:m["b"],loading:!1}},computed:{pvcsResource(){const e=this.$store.getters[p["b"]+"/all"](u["x"])||[];return e.find(e=>e.metadata.name===this.value.volumeName)},isDisabled(){return!this.value.newCreateId&&this.isEdit&&this.isVirtualType},storageClassOptions(){const e=this.$store.getters[p["b"]+"/all"](u["E"])||[],t=e.filter(e=>{var t;return!(null!==(t=e.parameters)&&void 0!==t&&t.backingImage)}).map(e=>{const t=e.isDefault?`${e.name} (${this.t("generic.default")})`:e.name;return{label:t,value:e.name}})||[];return t}},watch:{"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())},pvcsResource:{handler(e){var t;if(null!==e&&void 0!==e&&null!==(t=e.spec)&&void 0!==t&&null!==(t=t.resources)&&void 0!==t&&null!==(t=t.requests)&&void 0!==t&&t.storage){const t=Object(c["d"])(e.spec.resources.requests.storage),a=Object(c["c"])(t,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3});this.value.size=a+"Gi"}},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")}}},h=v,b=a("d802"),f=Object(b["a"])(h,s,i,!1,null,null,null);t["default"]=f.exports},1916:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".header[data-v-0f630528]{display:flex;justify-content:flex-end}",""]),e.exports=t},2344:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".kv-item.value>.unlabeled-select[data-v-b112e3c2]{height:40px;line-height:1}",""]),e.exports=t},"27e7":function(e,t,a){"use strict";a("38a4")},"2a79":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.input.sshKey"),taggable:!0,mode:e.mode,multiple:!0,searchable:e.searchable,disabled:e.disabled,options:e.sshOption},on:{input:e.update},model:{value:e.checkedSsh,callback:function(t){e.checkedSsh=t},expression:"checkedSsh"}}),t("ModalWithCard",{ref:e.randomStr,attrs:{name:e.randomStr,width:"40%",errors:e.errors},on:{finish:e.save,close:e.cancel},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.sshTitle"))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.name"),required:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),(()=>{}).apply(null,arguments))}},model:{value:e.sshName,callback:function(t){e.sshName=t},expression:"sshName"}}),t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.sshKeyValue"),"min-height":160,type:"multiline",required:""},model:{value:e.publicKey,callback:function(t){e.publicKey=t},expression:"publicKey"}})]},proxy:!0}])})],1)},i=[],l=a("9ce4"),r=a("2cb5"),o=a("8e93"),n=a("466b"),d=a("977e"),u=a("90cd"),c=a("e24b"),m=a("da25");const p="_NEW";var v={components:{LabeledInput:o["a"],ModalWithCard:d["a"],LabeledSelect:n["a"]},props:{value:{type:Array,default:()=>[]},mode:{type:String,default:"create"},disableCreate:{type:Boolean,default:!1},namespace:{type:String,default:""},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},data(){return{checkedSsh:this.value,publicKey:"",sshName:"",randomStr:Object(r["p"])(5).toLowerCase(),errors:[],isAll:!1,checkAll:!1}},computed:{...Object(l["a"])({t:"i18n/t"}),schema(){return this.$store.getters[u["b"]+"/schemaFor"](u["a"].SSH)},isCreatable(){var e;return!(this.schema&&(null===(e=this.schema)||void 0===e||!e.collectionMethods.find(e=>["blocked-post","post"].includes(e.toLowerCase()))))},sshOption(){const e=this.$store.getters[u["b"]+"/all"](u["a"].SSH).map(e=>({label:e.id,value:e.id}));return!this.disableCreate&&this.mode!==m["w"]&&this.isCreatable&&e.unshift({label:this.t("harvester.virtualMachine.createSSHKey"),value:p}),e}},watch:{publicKey(e){const t=e.split(/\s+/);3===t.length&&t[2].includes("@")&&t[2].split("@")&&(this.sshName||(this.sshName=t[2].split("@")[0]))},value(e){this.checkedSsh=e},checkedSsh(e,t){e.includes(p)&&(this.$set(this,"checkedSsh",t),this.update(),this.show())}},methods:{show(){this.$modal.show(this.randomStr)},hide(){this.$modal.hide(this.randomStr)},async save(e){if(this.errors=[],!this.sshName){const e=this.t("harvester.virtualMachine.input.name"),t=this.t("validation.required",{key:e});this.errors.push(t)}if(!this.publicKey){const e=this.t("harvester.virtualMachine.input.sshKeyValue"),t=this.t("validation.required",{key:e});this.errors.push(t)}if(this.sshName.length>63){const e=this.t("harvester.validation.custom.tooLongName",{max:63});this.errors.push(e)}if(this.errors.length>0)e(!1);else try{const t=await this.$store.dispatch(u["b"]+"/create",{metadata:{name:this.sshName,namespace:this.namespace},spec:{publicKey:this.publicKey},type:u["a"].SSH}),a=await t.save();a.id&&this.checkedSsh.push(`${this.namespace}/${this.sshName}`),e(!0),this.cancel()}catch(t){this.errors=[t.message],e(!1)}},cancel(){this.hide(),this.resetFields()},resetFields(){this.sshName="",this.publicKey="",this.errors=[]},update(){this.$emit("update:sshKey",Object(c["e"])(this.checkedSsh))}}},h=v,b=(a("482d"),a("d802")),f=Object(b["a"])(h,s,i,!1,null,"5f271ac4",null);t["a"]=f.exports},"2d15":function(e,t,a){"use strict";a("ff89")},3705:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".restart-modal[data-v-c430a37c]{z-index:45}.prompt-restart[data-v-c430a37c]{margin:0}.bottom[data-v-c430a37c]{display:flex;flex-direction:column;flex:1}.bottom .banner[data-v-c430a37c]{margin-top:0}.bottom .buttons[data-v-c430a37c]{display:flex;justify-content:flex-end;width:100%}",""]),e.exports=t},"38a4":function(e,t,a){var s=a("6b0f");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("517a51b3",s,!0,{sourceMap:!1,shadowMode:!1})},"411b":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vm__credentials-users"},[t("LabeledSelect",{class:{hasUsers:e.selectedUser.length>0},attrs:{options:e.userOptions,label:e.t("harvester.virtualMachine.accessCredentials.injectSSH.users"),taggable:e.multiple,mode:e.mode,multiple:e.multiple,searchable:!1,tooltip:e.t("harvester.virtualMachine.accessCredentials.userTips")},on:{input:e.update},model:{value:e.selectedUser,callback:function(t){e.selectedUser=t},expression:"selectedUser"}}),t("ModalWithCard",{ref:e.randomStr,attrs:{name:e.randomStr,width:"40%",errors:e.errors},on:{finish:e.addUser,close:e.cancel},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.accessCredentials.injectSSH.addUser"))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.username"),required:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),(()=>{}).apply(null,arguments))}},model:{value:e.newUsername,callback:function(t){e.newUsername=t},expression:"newUsername"}})]},proxy:!0}])})],1)},i=[],l=a("9ce4"),r=a("e24b"),o=a("2cb5"),n=a("8e93"),d=a("466b"),u=a("977e");const c="_NEW";var m={components:{LabeledInput:n["a"],LabeledSelect:d["a"],ModalWithCard:u["a"]},props:{value:{type:[Array,String],default:()=>[]},resource:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!1},mode:{type:String,default:"create"},disabled:{type:Boolean,default:!1}},data(){return{selectedUser:this.value,newUsername:"",randomStr:Object(o["p"])(5).toLowerCase(),errors:[]}},computed:{...Object(l["a"])({t:"i18n/t"})},watch:{value(e){this.selectedUser=e},selectedUser(e,t){e.includes(c)&&(this.$set(this,"selectedUser",t),this.update(),this.show())}},methods:{update(){this.$emit("update:user",Object(r["e"])(this.selectedUser))},addUser(e){const t=/^[-._0-9a-zA-Z]+$/;if(this.errors=[],!t.test(this.newUsername)){const t=this.t("harvester.virtualMachine.accessCredentials.invalidUser");return this.errors.push(t),void e(!1)}if(this.userOptions.includes(this.newUsername)){const t=this.t("harvester.virtualMachine.accessCredentials.duplicatedUser");return this.errors.push(t),void e(!1)}this.multiple?this.selectedUser.push(this.newUsername):this.selectedUser=this.newUsername,this.$emit("update:newUser",this.newUsername),this.update(),e(!0),this.cancel()},show(){this.$modal.show(this.randomStr)},hide(){this.$modal.hide(this.randomStr)},cancel(){this.hide(),this.newUsername=""}}},p=m,v=(a("ba19"),a("d802")),h=Object(v["a"])(p,s,i,!1,null,null,null);t["a"]=h.exports},4564:function(e,t,a){"use strict";a("c504")},"482d":function(e,t,a){"use strict";a("85b9")},4890:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),mode:e.mode,options:e.VOLUME_TYPE,required:""},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-volumeName"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.volume"),value:e.value.volumeName,mode:e.mode}},[t("LabeledSelect",{attrs:{disabled:e.isDisabled,label:e.t("harvester.fields.volume"),mode:e.mode,options:e.volumeOption,required:""},on:{input:e.update},model:{value:e.value.volumeName,callback:function(t){e.$set(e.value,"volumeName",t)},expression:"value.volumeName"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-size"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.size"),value:e.value.size,mode:e.mode}},[t("UnitInput",{attrs:{"output-modifier":!0,increment:1024,"input-exponent":3,label:e.t("harvester.fields.size"),mode:e.mode,disabled:!0},on:{input:e.update},model:{value:e.value.size,callback:function(t){e.$set(e.value,"size",t)},expression:"value.size"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[e.image?t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-image"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.image"),value:e.image,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.image"),mode:e.mode,disabled:!0},on:{input:e.update},model:{value:e.image,callback:function(t){e.image=t},expression:"image"}})],1)],1):e._e(),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),mode:e.mode,options:e.InterfaceOption,disabled:!0,required:""},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])])},i=[],l=a("4978"),r=a("8e93"),o=a("466b"),n=a("5361"),d=a("1d19"),u=a("907c"),c=a("90cd"),m=a("da25"),p=a("7c47"),v=a("873f"),h={name:"HarvesterEditExisting",components:{UnitInput:l["a"],LabeledInput:r["a"],LabeledSelect:o["a"],InputOrDisplay:n["a"]},props:{mode:{type:String,default:m["n"]},value:{type:Object,required:!0},isEdit:{type:Boolean,default:!1},namespace:{type:String,default:null},idx:{type:Number,default:0},rows:{type:Array,required:!0}},data(){return this.value.realName&&(this.value.volumeName=this.value.realName),{VOLUME_TYPE:p["e"],InterfaceOption:p["b"],loading:!1}},computed:{isDisabled(){return!this.value.newCreateId&&this.isEdit},allPVCs(){const e=this.$store.getters[c["b"]+"/all"](u["x"]);return e.filter(e=>!this.namespace||this.namespace===e.metadata.namespace)||[]},image(){const e=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE).find(e=>{var t;return e.id===(null===(t=this.pvcResource)||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[v["a"].IMAGE_ID])});if(e)return`${e.metadata.namespace}/${e.spec.displayName}`},pvcResource(){return this.allPVCs.find(e=>e.metadata.name===this.value.volumeName)},volumeOption(){return Object(d["a"])(this.allPVCs.filter(e=>{var t,a,s,i;let l=!0,r=!1,o=!1;if(this.rows.forEach(t=>{t.volumeName===e.metadata.name&&(l=!1)}),0===this.idx&&(null===(t=e.metadata)||void 0===t||null===(t=t.annotations)||void 0===t||!t[v["a"].IMAGE_ID]))return!1;if(e.attachVM&&l&&(null===(a=e.attachVM)||void 0===a?void 0:a.id)===(null===(s=this.vm)||void 0===s?void 0:s.id)&&this.isEdit?r=!1:e.attachVM&&(r=!0),null!==e&&void 0!==e&&null!==(i=e.metadata)&&void 0!==i&&null!==(i=i.annotations)&&void 0!==i&&i[v["a"].VOLUME_VM]){var n;const t=JSON.parse(null===e||void 0===e||null===(n=e.metadata)||void 0===n||null===(n=n.annotations)||void 0===n?void 0:n[v["a"].VOLUME_VM]).type;o="disk"===t}return l&&!r&&e.isAvailable&&o}).map(e=>({label:e.metadata.name,value:e.metadata.name})),"label")}},watch:{"value.volumeName"(e){const t=this.allPVCs.find(t=>t.metadata.name===e);t&&(this.value.accessModes=t.spec.accessModes[0],this.value.size=t.spec.resources.requests.storage,this.value.storageClassName=t.spec.storageClassName,this.value.volumeMode=t.spec.volumeMode)},"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())},pvcResource:{handler(e){var t;!this.value.volumeName&&null!==e&&void 0!==e&&null!==(t=e.metadata)&&void 0!==t&&t.name&&(this.value.volumeName=e.metadata.name)},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")}}},b=h,f=a("d802"),y=Object(f["a"])(b,s,i,!1,null,null,null);t["default"]=y.exports},"4b06":function(e,t,a){"use strict";a.d(t,"a",(function(){return v})),a.d(t,"b",(function(){return b}));var s=a("e3b5"),i=a.n(s),l=a("7838"),r=a.n(l),o=a("9e74"),n=a.n(o),d=a("e24b"),u=a("907c"),c=a("90cd"),m=a("873f"),p=a("6834");const v={package_update:!0,packages:["qemu-guest-agent"],runcmd:[["systemctl","enable","--now","qemu-guest-agent.service"]]},h={default:"qemu-guest-agent.service"},b=[{bus:"usb",name:"tablet",type:"tablet"}],f={EXISTING_ALL:"EXISTING_ALL",EXISTING_ONLY_ANNOTATION:"EXISTING_ANNOTATION",EXISTING_ONLY_CLOUD:"EXISTING_CLOUD"};t["c"]={methods:{hasCloudConfigComment(e){var t,a,s;const l=e?i.a.parseDocument(e):i.a.parseDocument({}),r=(null===l||void 0===l||null===(t=l.contents)||void 0===t?void 0:t.items)||[];let o=!1;return("cloud-config"===(null===l||void 0===l?void 0:l.comment)||null!==l&&void 0!==l&&null!==(a=l.comment)&&void 0!==a&&a.includes("cloud-config\n"))&&(o=!0),("cloud-config"===(null===l||void 0===l?void 0:l.commentBefore)||null!==l&&void 0!==l&&null!==(s=l.commentBefore)&&void 0!==s&&s.includes("cloud-config\n"))&&(o=!0),r.map(e=>{var t;const a=e.key;("cloud-config"===(null===a||void 0===a?void 0:a.commentBefore)||null!==a&&void 0!==a&&null!==(t=a.commentBefore)&&void 0!==t&&t.includes("cloud-config\n"))&&(o=!0)}),o},getSSHValue(e){var t;const a=this.$store.getters[c["b"]+"/all"](c["a"].SSH)||[];return(null===(t=a.find(t=>t.id===e))||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.publicKey)||void 0},getOsType(e){var t;return null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[m["a"].OS]},getMatchQGA(e){const t=Object(d["e"])(v);let a=!1;return p["b"].forEach(t=>{t.match&&(a=t.match.find(t=>t===e))}),t.runcmd[0][3]=a?h[e]:h["default"],t},getSimilarRuncmd(e){const t=Object(d["e"])(v);return t.runcmd[0][3]="openSUSE"===e?h["default"]:h["suse"],t.runcmd[0]},hasInstallAgent(e,t,a){var s,i;let l={};const o=this.getMatchQGA(t);try{l=r.a.load(e)||{}}catch(n){return new Error("Function(hasInstallAgent) error"),a}return(null===(s=l)||void 0===s||null===(s=s.packages)||void 0===s?void 0:s.includes("qemu-guest-agent"))&&!(null===(i=l)||void 0===i||null===(i=i.runcmd)||void 0===i||!i.find(e=>Array.isArray(e)&&e.join("-")===o.runcmd[0].join("-")))},isInstallUSBTablet(e){var t;const a=null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.devices)||void 0===t?void 0:t.inputs;return!!Array.isArray(a)&&!!a.find(e=>n()(e,b[0]))},isEfiEnabled(e){var t,a;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.features)||void 0===t||!t.smm||null===e||void 0===e||null===(a=e.template)||void 0===a||null===(a=a.spec)||void 0===a||null===(a=a.domain)||void 0===a||null===(a=a.firmware)||void 0===a||null===(a=a.bootloader)||void 0===a||!a.efi)},isSecureBoot(e){var t;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.firmware)||void 0===t||null===(t=t.bootloader)||void 0===t||null===(t=t.efi)||void 0===t||!t.secureBoot)},getCloudInitNoCloud(e){var t,a,s;const i=this.getSecret(e);let l=null===i||void 0===i||null===(t=i.decodedData)||void 0===t?void 0:t.userdata,r=null===i||void 0===i||null===(a=i.decodedData)||void 0===a?void 0:a.networkdata;const o=(null===e||void 0===e||null===(s=e.template)||void 0===s||null===(s=s.spec)||void 0===s||null===(s=s.volumes)||void 0===s||null===(s=s.find(e=>"cloudinitdisk"===e.name))||void 0===s?void 0:s.cloudInitNoCloud)||{};return null!==o&&void 0!==o&&o.userData&&(l=o.userData,this.saveUserDataAsClearText=!0),null!==o&&void 0!==o&&o.networkData&&(r=o.networkData,this.saveNetworkDataAsClearText=!0),{userData:l,networkData:r}},getSecret(e){var t,a,s;const i=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.volumes)||void 0===t||null===(t=t.find(e=>"cloudinitdisk"===e.name))||void 0===t?void 0:t.cloudInitNoCloud)||{},l=this.$store.getters[c["b"]+"/all"](u["B"])||[],r=(null===i||void 0===i||null===(a=i.secretRef)||void 0===a?void 0:a.name)||(null===i||void 0===i||null===(s=i.networkDataSecretRef)||void 0===s?void 0:s.name),o=l.find(e=>e.metadata.name===r);return o},getAccessCredentials(e){var t,a;const s=this.$store.getters[c["b"]+"/all"](u["B"])||[],i=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.accessCredentials)||[],l=JSON.parse((null===(a=e.template.metadata)||void 0===a||null===(a=a.annotations)||void 0===a?void 0:a[m["a"].DYNAMIC_SSHKEYS_NAMES])||"[]");return i.map(e=>{var t;const a=e.userPassword?"userPassword":"sshPublicKey",i=null===(t=e[a])||void 0===t||null===(t=t.source)||void 0===t||null===(t=t.secret)||void 0===t?void 0:t.secretName,r=s.find(e=>e.metadata.name===i),o={source:a,username:"",newPassword:"",users:[],sshkeys:[],secretName:i,secretRef:r};if(r)if("userPassword"===a){const e=Object.keys(null===r||void 0===r?void 0:r.data)[0],t=r.decodedData[e];o.username=e,o.newPassword=t}else{const t=e[a].propagationMethod.qemuGuestAgent.users,s=null===l||void 0===l?void 0:l[i];o.users=t,o.sshkeys=s}else o.secretRef=void 0;return o})},getVolumeClaimTemplates(e){let t=[];try{t=JSON.parse(e.metadata.annotations[m["a"].VOLUME_CLAIM_TEMPLATE])}catch(a){new Error("Function: getVolumeClaimTemplates, "+a)}return t},getRootImageId(e){var t;const a=this.getVolumeClaimTemplates(e);return(null===(t=a[0])||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[m["a"].IMAGE_ID])||""},getSSHFromAnnotation(e){var t;const a=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[m["a"].SSH_NAMES])||"[]";return JSON.parse(a)},convertToJson(e=""){let t={};try{t=r.a.load(e)}catch(a){new Error("Function(convertToJson) error")}return t},getSSHFromUserData(e){var t;return(null===(t=this.convertToJson(e))||void 0===t?void 0:t.ssh_authorized_keys)||[]},compareSSHValue(e="",t=""){const a=/(\r\n\t|\n|\r\t)|(\s*)/gm;return e.replace(a,"")===t.replace(a,"")},mergeAllSSHs(e){const t=this.getSSHFromAnnotation(e),{userScript:a}=this.getCloudInitNoCloud(e);if(!(null!==t&&void 0!==t&&t.length)<0&&!a)return[];let s=[];const i=this.$store.getters[c["b"]+"/all"](c["a"].SSH)||[];s=(t||[]).map(e=>{const t=i.find(t=>t.id===e);return t?{id:t.id,data:t,type:f.EXISTING_ALL}:{id:e,data:e,type:f.EXISTING_ONLY_ANNOTATION}});const l=this.getSSHFromUserData(a);return l.map(e=>{const t=i.find(t=>{var a;return this.compareSSHValue(e,null===(a=t.spec)||void 0===a?void 0:a.publicKey)});t&&!s.find(e=>e.id===t.id)?s.push({id:t.id,data:t,type:f.EXISTING_ALL}):t||s.push({id:"Unknown",data:e,type:f.EXISTING_ONLY_CLOUD})}),s}}}},"4cdd":function(e,t,a){var s=a("9dda");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("4b2bcdb6",s,!0,{sourceMap:!1,shadowMode:!1})},"4cf0":function(e,t,a){var s=a("d227");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("aeb9b5d2",s,!0,{sourceMap:!1,shadowMode:!1})},5993:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hec-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),required:"",mode:e.mode},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hec-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),options:e.VOLUME_TYPE,mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hec-container"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.dockerImage"),value:e.value.container,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.virtualMachine.volume.dockerImage"),mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.container,callback:function(t){e.$set(e.value,"container",t)},expression:"value.container"}})],1)],1),t("div",{staticClass:"col span-3",attrs:{"data-testid":"input-hec-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),options:e.InterfaceOption,mode:e.mode},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])])},i=[],l=a("8e93"),r=a("466b"),o=a("5361"),n=a("7c47"),d={name:"HarvesterEditContainer",components:{LabeledInput:l["a"],LabeledSelect:r["a"],InputOrDisplay:o["a"]},props:{mode:{type:String,default:"create"},value:{type:Object,required:!0}},data(){return{VOLUME_TYPE:n["e"],InterfaceOption:n["b"]}},watch:{"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())}},methods:{update(){this.$emit("update")}}},u=d,c=a("d802"),m=Object(c["a"])(u,s,i,!1,null,null,null);t["default"]=m.exports},"61a1":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("modal",{staticClass:"restart-modal",attrs:{name:"restartDialog",width:600,height:"auto","click-to-close":!1},on:{closed:e.close}},[t("Card",{staticClass:"prompt-restart",attrs:{"show-highlight-border":!1}},[t("h4",{staticClass:"text-default-text",attrs:{slot:"title"},domProps:{innerHTML:e._s(e.t("harvester.modal.restart.title"))},slot:"title"}),t("template",{slot:"body"},[e._t("body",(function(){return[t("div",{staticClass:"pl-10 pr-10",domProps:{innerHTML:e._s(e.t("harvester.modal.restart.tip"))}})]}))],2),t("div",{staticClass:"bottom",attrs:{slot:"actions"},slot:"actions"},[e._l(e.errors,(function(e,a){return t("Banner",{key:a,attrs:{color:"error",label:e}})})),t("div",{staticClass:"buttons"},[t("button",{staticClass:"btn role-secondary mr-10",on:{click:e.close}},[e._v(" "+e._s(e.t("harvester.modal.restart.cancel"))+" ")]),t("AsyncButton",{attrs:{mode:"restart"},on:{click:e.apply}})],1)],2)],2)],1)},i=[],l=a("9ce4"),r=a("d709"),o=a("7b9e"),n=a("6418"),d=a("3e9d"),u={components:{Card:o["a"],AsyncButton:r["b"],Banner:n["a"]},props:{vm:{type:Object,required:!0}},data(){return{errors:[],resolve:null}},computed:{...Object(l["a"])({t:"i18n/t"})},methods:{close(){this.resolve(),this.$emit("close")},apply(e){try{this.vm.doActionGrowl("restart",{}),e(!0),this.resolve(),this.close()}catch(t){console.error(t),this.errors=Object(d["b"])(t),e(!1)}}}},c=u,m=(a("9c1e"),a("d802")),p=Object(m["a"])(c,s,i,!1,null,"c430a37c",null);t["default"]=p.exports},6439:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".infoBox[data-v-6aafe4d4]{position:relative}.remove-vol[data-v-6aafe4d4]{position:absolute;top:10px;right:16px;padding:0;max-height:28px;min-height:28px}",""]),e.exports=t},6834:function(e,t,a){"use strict";a.d(t,"a",(function(){return O})),a.d(t,"b",(function(){return I}));var s=a("e3b5"),i=a.n(s),l=a("7838"),r=a.n(l),o=a("9e74"),n=a.n(o),d=a("330a"),u=a.n(d),c=a("94a3"),m=a.n(c),p=a("1d19"),v=a("e24b"),h=a("a8b9"),b=a("2cb5"),f=a("0f81"),y=a("d37d"),g=a("7c47"),C=a("da25"),S=a("907c"),w=a("90cd");const k={BACKUP_TARGET:"backup-target",CONTAINERD_REGISTRY:"containerd-registry",LOG_LEVEL:"log-level",SERVER_VERSION:"server-version",UI_INDEX:"ui-index",UI_PLUGIN_INDEX:"ui-plugin-index",UPGRADE_CHECKER_ENABLED:"upgrade-checker-enabled",UPGRADE_CHECKER_URL:"upgrade-checker-url",VLAN:"vlan",UI_SOURCE:"ui-source",HTTP_PROXY:"http-proxy",ADDITIONAL_CA:"additional-ca",OVERCOMMIT_CONFIG:"overcommit-config",CLUSTER_REGISTRATION_URL:"cluster-registration-url",DEFAULT_STORAGE_CLASS:"default-storage-class",VIP:"vip-pools",SUPPORT_BUNDLE_TIMEOUT:"support-bundle-timeout",SUPPORT_BUNDLE_IMAGE:"support-bundle-image",STORAGE_NETWORK:"storage-network",VM_FORCE_RESET_POLICY:"vm-force-reset-policy",SSL_CERTIFICATES:"ssl-certificates",SSL_PARAMETERS:"ssl-parameters",SUPPORT_BUNDLE_NAMESPACES:"support-bundle-namespaces",AUTO_DISK_PROVISION_PATHS:"auto-disk-provision-paths",RELEASE_DOWNLOAD_URL:"release-download-url",CCM_CSI_VERSION:"harvester-csi-ccm-versions"};k.BACKUP_TARGET,k.LOG_LEVEL,k.VLAN,k.SERVER_VERSION,k.UPGRADE_CHECKER_ENABLED,k.UPGRADE_CHECKER_URL,k.HTTP_PROXY,k.ADDITIONAL_CA,k.OVERCOMMIT_CONFIG,k.SUPPORT_BUNDLE_TIMEOUT,k.SUPPORT_BUNDLE_IMAGE,k.STORAGE_NETWORK,k.VM_FORCE_RESET_POLICY,k.SSL_CERTIFICATES,k.VIP,k.SSL_PARAMETERS,k.SUPPORT_BUNDLE_NAMESPACES,k.AUTO_DISK_PROVISION_PATHS,k.RELEASE_DOWNLOAD_URL,k.UI_PLUGIN_INDEX,k.CONTAINERD_REGISTRY,k.UI_SOURCE,k.UI_INDEX,k.CLUSTER_REGISTRATION_URL;var N=a("4ac6"),_=a("873f"),M=a("4b06");const O="management Network",I=[{label:"Windows",value:"windows"},{label:"Linux",value:"linux"},{label:"SUSE Linux Enterprise",value:"SLEs"},{label:"Debian",value:"debian"},{label:"Fedora",value:"fedora"},{label:"Gentoo",value:"gentoo"},{label:"Oracle",value:"oracle"},{label:"Red Hat",value:"redhat"},{label:"openSUSE",value:"openSUSE"},{label:"Ubuntu",value:"ubuntu"},{label:"Other Linux",match:["centos"],value:"otherLinux"}],E="cd-rom",T="disk";t["c"]={mixins:[M["c"]],props:{value:{type:Object,required:!0},resource:{type:String,default:""}},async fetch(){var e;const t={pvs:this.$store.dispatch(w["b"]+"/findAll",{type:S["w"]}),pvcs:this.$store.dispatch(w["b"]+"/findAll",{type:S["x"]}),storageClasses:this.$store.dispatch(w["b"]+"/findAll",{type:S["E"]}),sshs:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].SSH}),settings:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].SETTING}),images:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].IMAGE}),versions:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].VM_VERSION}),templates:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].VM_TEMPLATE}),networkAttachment:this.$store.dispatch(w["b"]+"/findAll",{type:S["q"]}),vmis:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].VMI}),vmims:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].VMIM}),vms:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].VM}),secrets:this.$store.dispatch(w["b"]+"/findAll",{type:S["B"]}),addons:this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].ADD_ONS})};this.$store.getters[w["b"]+"/schemaFor"](S["s"])&&(t.nodes=this.$store.dispatch(w["b"]+"/findAll",{type:S["s"]})),this.$store.getters[w["b"]+"/schemaFor"](w["a"].CLUSTER_NETWORK)&&(t.clusterNetworks=this.$store.dispatch(w["b"]+"/findAll",{type:w["a"].CLUSTER_NETWORK}));const a=await Object(h["a"])(t),s=this.$store.getters[w["b"]+"/schemaFor"](w["a"].PCI_DEVICE);this.enabledPCI=!0===(null===(e=a.addons.find(e=>"pcidevices-controller"===e.name))||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.enabled)&&s},data(){const e=this.realMode===C["l"];return{OS:I,isClone:e,spec:null,osType:"linux",sshKey:[],runStrategy:"RerunOnFailure",installAgent:!0,hasCreateVolumes:[],installUSBTablet:!0,networkScript:"",userScript:"",imageId:"",diskRows:[],networkRows:[],machineType:"",secretName:"",secretRef:null,showAdvanced:!1,deleteAgent:!0,memory:null,cpu:"",reservedMemory:null,accessCredentials:[],efiEnabled:!1,secureBoot:!1,userDataTemplateId:"",saveUserDataAsClearText:!1,saveNetworkDataAsClearText:!1,enabledPCI:!1,immutableMode:this.realMode===C["n"]?C["n"]:C["w"]}},computed:{inStore(){return w["b"]},images(){return this.$store.getters[this.inStore+"/all"](w["a"].IMAGE)},versions(){return this.$store.getters[this.inStore+"/all"](w["a"].VM_VERSION)},templates(){return this.$store.getters[this.inStore+"/all"](w["a"].VM_TEMPLATE)},pvcs(){return this.$store.getters[this.inStore+"/all"](S["x"])},secrets(){return this.$store.getters[this.inStore+"/all"](S["B"])},nodesIdOptions(){const e=this.$store.getters[this.inStore+"/all"](S["s"]);return e.filter(e=>!e.isUnSchedulable).map(e=>({label:e.nameDisplay,value:e.id}))},defaultStorageClass(){var e;const t=this.$store.getters[this.inStore+"/all"](S["E"]).find(e=>e.isDefault);return(null===t||void 0===t||null===(e=t.metadata)||void 0===e?void 0:e.name)||"longhorn"},storageClassSetting(){try{var e;const t=null===(e=this.$store.getters[this.inStore+"/all"](w["a"].SETTING).find(e=>e.id===k.DEFAULT_STORAGE_CLASS))||void 0===e?void 0:e.value;return JSON.parse(t)}catch(t){return{}}},customVolumeMode(){return this.storageClassSetting.volumeMode||"Block"},customAccessMode(){return this.storageClassSetting.accessModes||"ReadWriteMany"},isWindows(){return"windows"===this.osType},needNewSecret(){return this.resource===w["a"].VM_VERSION||this.isCreate}},async created(){await this.$store.dispatch(this.inStore+"/findAll",{type:S["B"]}),this.getInitConfig({value:this.value,init:this.isCreate})},methods:{getInitConfig(e){var t,a,s,i,l;const{value:r,existUserData:o,fromTemplate:n=!1,init:d=!1}=e,u=this.resource===w["a"].VM?r:this.resource===w["a"].BACKUP?null===(t=this.value.status)||void 0===t?void 0:t.source:r.spec.vm,c=null===u||void 0===u?void 0:u.spec;if(!c)return;const m=c.template.spec.domain.resources;null!==m&&void 0!==m&&m.limits&&(null===m||void 0===m||!m.limits||null!==m&&void 0!==m&&null!==(a=m.limits)&&void 0!==a&&a.memory||null===(null===m||void 0===m||null===(s=m.limits)||void 0===s?void 0:s.memory))||(c.template.spec.domain.resources={...c.template.spec.domain.resources,limits:{...c.template.spec.domain.resources.limits,memory:c.template.spec.domain.resources.requests.memory}});const p=c.runStrategy||"RerunOnFailure",v=r.machineType,h=null===(i=c.template.spec.domain)||void 0===i||null===(i=i.cpu)||void 0===i?void 0:i.cores,b=c.template.spec.domain.resources.limits.memory,y=null===(l=u.metadata)||void 0===l||null===(l=l.annotations)||void 0===l?void 0:l[_["a"].VM_RESERVED_MEMORY],g=this.getSSHFromAnnotation(c)||[],C=this.getRootImageId(u)||"",S=this.getDiskRows(u),k=this.getNetworkRows(u,{fromTemplate:n,init:d}),N=this.getHasCreatedVolumes(c)||[];let{userData:M,networkData:O}=this.getCloudInitNoCloud(c);if(this.resource===w["a"].BACKUP){var I;const e=null===(I=this.value.status)||void 0===I?void 0:I.secretBackups;if(e){var E,T;const t=(null===(E=e[0])||void 0===E||null===(E=E.data)||void 0===E?void 0:E.networkdata)||"",a=(null===(T=e[0])||void 0===T||null===(T=T.data)||void 0===T?void 0:T.userdata)||"";M=Object(f["a"])(a),O=Object(f["a"])(t)}}const x=this.getOsType(u)||"linux";M=!this.isCreate||o||this.isClone?M:this.getInitUserData({osType:x});const A=this.isInstallUSBTablet(c),$=this.hasInstallAgent(M,x,!0),D=this.isEfiEnabled(c),V=this.isSecureBoot(c),R=this.getSecret(c),L=this.getAccessCredentials(c);Object.prototype.hasOwnProperty.call(c,"running")&&(delete c.running,c.runStrategy="RerunOnFailure"),this.$set(this,"spec",c),this.$set(this,"runStrategy",p),this.$set(this,"secretRef",R),this.$set(this,"accessCredentials",L),this.$set(this,"userScript",M),this.$set(this,"networkScript",O),this.$set(this,"sshKey",g),this.$set(this,"osType",x),this.$set(this,"installAgent",$),this.$set(this,"cpu",h),this.$set(this,"memory",b),this.$set(this,"reservedMemory",y),this.$set(this,"machineType",v),this.$set(this,"installUSBTablet",A),this.$set(this,"efiEnabled",D),this.$set(this,"secureBoot",V),this.$set(this,"hasCreateVolumes",N),this.$set(this,"networkRows",k),this.$set(this,"imageId",C),this.$set(this,"diskRows",S),this.refreshYamlEditor()},getDiskRows(e){const t=e.metadata.namespace,a=e.spec.template.spec.volumes||[],s=e.spec.template.spec.domain.devices.disks||[],i=this.getVolumeClaimTemplates(e);let l=[];return 0===s.length?l.push({id:Object(b["p"])(5),source:g["d"].IMAGE,name:"disk-0",accessMode:"ReadWriteMany",bus:"virtio",volumeName:"",size:"10Gi",type:T,storageClassName:"",image:this.imageId,volumeMode:"Block"}):l=s.map((e,s)=>{var l,r,o,n;const d=a.find(t=>t.name===e.name);let u="",c="",m="",p="",v="",h="",f="",C="",k="",N=!1,M=null;const O=null!==e&&void 0!==e&&e.cdrom?E:null!==e&&void 0!==e&&e.disk?T:"";if(null!==d&&void 0!==d&&d.containerDisk&&(m=g["d"].CONTAINER,v=d.containerDisk.image),d.persistentVolumeClaim&&null!==(l=d.persistentVolumeClaim)&&void 0!==l&&l.claimName){h=d.persistentVolumeClaim.claimName;const e=i.find(e=>e.metadata.name===h);if(p=h,e){var I,x,A,$;if(void 0!==(null===(I=e.metadata)||void 0===I||null===(I=I.annotations)||void 0===I?void 0:I[_["a"].IMAGE_ID]))c=null===($=e.metadata)||void 0===$||null===($=$.annotations)||void 0===$?void 0:$[_["a"].IMAGE_ID],m=g["d"].IMAGE;else m=g["d"].NEW;const t=(null===e||void 0===e?void 0:e.spec)||{};C=null===t||void 0===t?void 0:t.volumeMode,f=null===t||void 0===t||null===(x=t.accessModes)||void 0===x?void 0:x[0],u=(null===t||void 0===t||null===(A=t.resources)||void 0===A||null===(A=A.requests)||void 0===A?void 0:A.storage)||"10Gi",k=null===t||void 0===t?void 0:t.storageClassName,M=null===t||void 0===t?void 0:t.dataSource}else{var D,V,R,L,U;const e=this.$store.getters[w["b"]+"/all"](S["x"]),a=e.find(e=>{var a;return e.id===`${t}/${null===d||void 0===d||null===(a=d.persistentVolumeClaim)||void 0===a?void 0:a.claimName}`});m=g["d"].ATTACH_VOLUME,f=(null===a||void 0===a||null===(D=a.spec)||void 0===D||null===(D=D.accessModes)||void 0===D?void 0:D[0])||"ReadWriteMany",u=(null===a||void 0===a||null===(V=a.spec)||void 0===V||null===(V=V.resources)||void 0===V||null===(V=V.requests)||void 0===V?void 0:V.storage)||"10Gi",k=null===a||void 0===a||null===(R=a.spec)||void 0===R?void 0:R.storageClassName,C=(null===a||void 0===a||null===(L=a.spec)||void 0===L?void 0:L.volumeMode)||"Block",h=(null===a||void 0===a||null===(U=a.metadata)||void 0===U?void 0:U.name)||""}N=d.persistentVolumeClaim.hotpluggable||!1}const P=(null===e||void 0===e||null===(r=e.disk)||void 0===r?void 0:r.bus)||(null===e||void 0===e||null===(o=e.cdrom)||void 0===o?void 0:o.bus),j=null!==e&&void 0!==e&&e.bootOrder?null===e||void 0===e?void 0:e.bootOrder:s,B=Object(y["d"])(u),q=Object(y["c"])(B,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3}),G=null===(n=this.pvcs.find(e=>e.id===`${this.value.metadata.namespace}/${h}`))||void 0===n||null===(n=n.relatedPV)||void 0===n||null===(n=n.metadata)||void 0===n||null===(n=n.annotations)||void 0===n?void 0:n[_["a"].VOLUME_ERROR];return{id:Object(b["p"])(5),bootOrder:j,source:m,name:e.name,realName:p,bus:P,volumeName:h,container:v,accessMode:f,size:q+"Gi",volumeMode:C||this.customVolumeMode,image:c,type:O,storageClassName:k,hotpluggable:N,volumeStatus:G,dataSource:M}}),l=Object(p["a"])(l,"bootOrder"),l.filter(e=>"cloudinitdisk"!==e.name)},getNetworkRows(e,t){const{fromTemplate:a=!1,init:s=!1}=t,i=e.spec.template.spec.networks||[],l=e.spec.template.spec.domain.devices.interfaces||[],r=l.map((e,t)=>{var l;const r=i.find(t=>e.name===t.name),o=e.sriov?"sriov":e.bridge?"bridge":"masquerade",n=!!r.pod;return{...e,index:t,type:o,isPod:n,newCreateId:!(!a&&!s)&&Object(b["p"])(10),model:e.model,networkName:n?O:null===r||void 0===r||null===(l=r.multus)||void 0===l?void 0:l.networkName}});return r},parseVM(){this.userData=this.getUserData({osType:this.osType,installAgent:this.installAgent}),this.parseOther(),this.parseAccessCredentials(),this.parseNetworkRows(this.networkRows),this.parseDiskRows(this.diskRows)},parseOther(){this.spec.template.spec.domain.machine?this.$set(this.spec.template.spec.domain.machine,"type",this.machineType):this.$set(this.spec.template.spec.domain,"machine",{type:this.machineType}),this.spec.template.spec.domain.cpu.cores=this.cpu,this.spec.template.spec.domain.resources.limits.cpu=this.cpu?this.cpu.toString():this.cpu,this.spec.template.spec.domain.resources.limits.memory=this.memory;const e=this.resource===w["a"].VM?this.value:this.value.spec.vm;this.reservedMemory?e.metadata.annotations[_["a"].VM_RESERVED_MEMORY]=this.reservedMemory:delete e.metadata.annotations[_["a"].VM_RESERVED_MEMORY]},parseDiskRows(e){var t,a,s,i,l,r,o;const n=[],d=[],u=[],c=[];if(e.forEach((e,t)=>{var a;const s=(null===(a=this.value.metadata)||void 0===a?void 0:a.name)||"";let i="";i=e.source===g["d"].ATTACH_VOLUME?e.volumeName:this.isClone||!this.hasCreateVolumes.includes(e.realName)?`${s}-${e.name}-${Object(b["p"])(5).toLowerCase()}`:e.realName;const l=this.parseDisk(e,t),r=this.parseVolume(e,i),o=this.parseVolumeClaimTemplate(e,i);n.push(l),d.push(r),u.push(i),e.source!==g["d"].CONTAINER&&c.push(o)}),this.secretName&&!this.needNewSecret||(this.secretName=this.generateSecretName(this.secretNamePrefix)),!n.find(e=>"cloudinitdisk"===e.name)&&(this.userData||this.networkData)&&!this.isWindows){n.push({name:"cloudinitdisk",disk:{bus:"virtio"}});const e=this.getUserData({osType:this.osType,installAgent:this.installAgent}),t={name:"cloudinitdisk",cloudInitNoCloud:{}};this.saveUserDataAsClearText?t.cloudInitNoCloud.userData=e:t.cloudInitNoCloud.secretRef={name:this.secretName},this.saveNetworkDataAsClearText?t.cloudInitNoCloud.networkData=this.networkScript:t.cloudInitNoCloud.networkDataSecretRef={name:this.secretName},d.push(t)}let m={...this.spec,runStrategy:this.runStrategy,template:{...this.spec.template,metadata:{...null===(t=this.spec)||void 0===t||null===(t=t.template)||void 0===t?void 0:t.metadata,annotations:{...null===(a=this.spec)||void 0===a||null===(a=a.template)||void 0===a||null===(a=a.metadata)||void 0===a?void 0:a.annotations,[_["a"].SSH_NAMES]:JSON.stringify(this.sshKey)},labels:{...null===(s=this.spec)||void 0===s||null===(s=s.template)||void 0===s||null===(s=s.metadata)||void 0===s?void 0:s.labels,[_["a"].VM_NAME]:null===(i=this.value)||void 0===i||null===(i=i.metadata)||void 0===i?void 0:i.name}},spec:{...null===(l=this.spec.template)||void 0===l?void 0:l.spec,domain:{...null===(r=this.spec.template)||void 0===r||null===(r=r.spec)||void 0===r?void 0:r.domain,devices:{...null===(o=this.spec.template)||void 0===o||null===(o=o.spec)||void 0===o||null===(o=o.domain)||void 0===o?void 0:o.devices,disks:n}},volumes:d}}};0===d.length&&delete m.template.spec.volumes,this.resource===w["a"].VM?(this.isSingle||(m=this.multiVMScheduler(m)),this.$set(this.value.metadata,"annotations",{...this.value.metadata.annotations,[_["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(c),[_["a"].NETWORK_IPS]:JSON.stringify(this.value.networkIps)}),this.$set(this.value.metadata,"labels",{...this.value.metadata.labels,[_["a"].CREATOR]:"harvester",[_["a"].OS]:this.osType}),this.$set(this.value,"spec",m),this.$set(this,"spec",m)):this.resource===w["a"].VM_VERSION&&(this.$set(this.value.spec.vm,"spec",m),this.$set(this.value.spec.vm.metadata,"annotations",{...this.value.spec.vm.metadata.annotations,[_["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(c)}),this.$set(this.value.spec.vm.metadata,"labels",{[_["a"].OS]:this.osType}),this.$set(this,"spec",m))},multiVMScheduler(e){var t,a;e.template.metadata.labels[_["a"].VM_NAME_PREFIX]=this.namePrefix;const s={weight:1,podAffinityTerm:{topologyKey:N["g"],labelSelector:{matchLabels:{[_["a"].VM_NAME_PREFIX]:this.namePrefix}}}};return{...e,template:{...e.template,spec:{...e.template.spec,affinity:{...e.template.spec.affinity,podAntiAffinity:{...null===(t=e.template.spec)||void 0===t||null===(t=t.affinity)||void 0===t?void 0:t.podAntiAffinity,preferredDuringSchedulingIgnoredDuringExecution:[...(null===(a=e.template.spec)||void 0===a||null===(a=a.affinity)||void 0===a||null===(a=a.podAntiAffinity)||void 0===a?void 0:a.preferredDuringSchedulingIgnoredDuringExecution)||[],s]}}}}}},parseNetworkRows(e){const t=[],a=[];e.forEach(e=>{const s=this.parseNetwork(e),i=this.parseInterface(e);t.push(s),a.push(i)});const s={...this.spec.template.spec,domain:{...this.spec.template.spec.domain,devices:{...this.spec.template.spec.domain.devices,interfaces:a}},networks:t};this.$set(this.spec.template,"spec",s)},parseAccessCredentials(){var e;const t=[],a={},s=JSON.parse((null===(e=this.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[_["a"].DYNAMIC_SSHKEYS_USERS])||"[]");for(const i of this.accessCredentials)this.needNewSecret&&(i.secretName=this.generateSecretName(this.secretNamePrefix)),i.source===g["a"].RESET_PWD&&(s.push(i.username),t.push({userPassword:{source:{secret:{secretName:i.secretName}},propagationMethod:{qemuGuestAgent:{}}}})),i.source===g["a"].INJECT_SSH&&(s.push(...i.users),a[i.secretName]=i.sshkeys,t.push({sshPublicKey:{source:{secret:{secretName:i.secretName}},propagationMethod:{qemuGuestAgent:{users:i.users}}}}));0===t.length&&this.spec.template.spec.accessCredentials?delete this.spec.template.spec.accessCredentials:this.spec.template.spec.accessCredentials=t,0!==s.length&&(this.spec.template.metadata.annotations[_["a"].DYNAMIC_SSHKEYS_USERS]=JSON.stringify(Array.from(new Set(s))),this.spec.template.metadata.annotations[_["a"].DYNAMIC_SSHKEYS_NAMES]=JSON.stringify(a))},getInitUserData(e){const t=this.getMatchQGA(e.osType),a=r.a.dump(t);return"#cloud-config\n"+a},getUserData(e){try{let t=this.userScript?i.a.parseDocument(this.userScript):i.a.parseDocument({});const a=this.mergeSSHAuthorizedKeys(this.userScript);a.length>0?t.setIn(["ssh_authorized_keys"],a):i.a.isCollection(t.getIn("ssh_authorized_keys"))&&t.deleteIn(["ssh_authorized_keys"]),t=e.installAgent?this.mergeQGA({userDataDoc:t,...e}):this.deleteQGA({userDataDoc:t,...e});const s=t.toString();if("{}\n"===s)return;return s}catch(t){return console.error("Error: Unable to parse yaml document",t),this.userScript}},updateSSHKey(e){this.$set(this,"sshKey",e)},updateCpuMemory(e,t){this.$set(this,"cpu",e),this.$set(this,"memory",t)},parseDisk(e,t){const a={name:e.name};return e.type===T?a.disk={bus:e.bus}:e.type===E&&(a.cdrom={bus:e.bus}),a.bootOrder=t+1,a},parseVolume(e,t){const a={name:e.name};return e.source===g["d"].CONTAINER?a.containerDisk={image:e.container}:e.source!==g["d"].IMAGE&&e.source!==g["d"].NEW&&e.source!==g["d"].ATTACH_VOLUME||(a.persistentVolumeClaim={claimName:t},e.hotpluggable&&(a.persistentVolumeClaim.hotpluggable=!0)),a},parseVolumeClaimTemplate(e,t){!String(e.size).includes("Gi")&&e.size&&(e.size=e.size+"Gi");const a={metadata:{name:t},spec:{accessModes:[e.accessMode],resources:{requests:{storage:e.size}},volumeMode:e.volumeMode}};switch(e.dataSource&&(a.spec.dataSource=e.dataSource),e.source){case g["d"].ATTACH_VOLUME:a.spec.storageClassName=e.storageClassName;break;case g["d"].NEW:a.spec.storageClassName=e.storageClassName;break;case g["d"].IMAGE:{const t=this.images.find(t=>e.image===t.id);t?(a.spec.storageClassName="longhorn-"+t.metadata.name,a.metadata.annotations={[_["a"].IMAGE_ID]:t.id}):a.metadata.annotations={[_["a"].IMAGE_ID]:""};break}}return a},getSSHListValue(e){return e.map(e=>this.getSSHValue(e)).filter(e=>void 0!==e)},parseInterface(e){const t={},a=e.type;return t[a]={},e.macAddress&&(t.macAddress=e.macAddress),t.model=e.model,t.name=e.name,t},parseNetwork(e){const t={name:e.name};return e.isPod?t.pod={}:t.multus={networkName:e.networkName},t},updateUserData(e){this.userScript=e},updateNetworkData(e){this.networkScript=e},mergeSSHAuthorizedKeys(e){try{var t;const a=(null===(t=i.a.parseDocument(e).get("ssh_authorized_keys"))||void 0===t?void 0:t.toJSON())||[],s=this.getSSHListValue(this.sshKey);return a.length?[...new Set([...s,...a])]:s}catch(a){return[]}},deleteYamlDocProp(e,t){try{var a,s;const i=null===(a=e.getIn([]))||void 0===a?void 0:a.items[0],l=null===i||void 0===i?void 0:i.key,r=!(null===l||void 0===l||null===(s=l.commentBefore)||void 0===s||!s.includes("cloud-config")),o=l.source===t[t.length-1];l&&r&&o||e.deleteIn(t)}catch(i){}},mergeQGA(e){const{osType:t,userDataDoc:a}=e,s=this.getMatchQGA(t),l=a.toString(),r=i.a.parse(l);let o=(null===r||void 0===r?void 0:r.packages)||[],n=(null===r||void 0===r?void 0:r.runcmd)||[];if(a.setIn(["package_update"],!0),Array.isArray(o)?o.includes("qemu-guest-agent")||o.push("qemu-guest-agent"):o=M["a"].packages,Array.isArray(n)){let e=-1;const a=n.find(e=>Array.isArray(e)&&e.join("-")===s.runcmd[0].join("-")),i=n.find((a,s)=>!(!Array.isArray(a)||a.join("-")!==this.getSimilarRuncmd(t).join("-"))&&(e=s,!0));i?n[e]=s.runcmd[0]:a||n.push(s.runcmd[0])}else n=s.runcmd;return o.length>0?a.setIn(["packages"],o):(a.setIn(["packages"],[]),this.deleteYamlDocProp(a,["packages"]),this.deleteYamlDocProp(a,["package_update"])),n.length>0?a.setIn(["runcmd"],n):this.deleteYamlDocProp(a,["runcmd"]),a},deleteQGA(e){var t;const{osType:a,userDataDoc:s,deletePackage:l=!1}=e,r=(null===(t=this.$store.getters[w["b"]+"/byId"](S["c"],this.userDataTemplateId))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.cloudInit)||"",o=s.toString(),n=i.a.parse(o),d=(null===n||void 0===n?void 0:n.packages)||[],u=(null===n||void 0===n?void 0:n.runcmd)||[];if(Array.isArray(d)&&l){const e=this.convertToJson(r);for(let t=0;t<d.length;t++)"qemu-guest-agent"===d[t]&&(Array.isArray(null===e||void 0===e?void 0:e.packages)&&e.packages.includes("qemu-guest-agent")||d.splice(t,1))}if(Array.isArray(u)){const e=this.getMatchQGA(a);for(let t=0;t<u.length;t++)Array.isArray(u[t])&&u[t].join("-")===e.runcmd[0].join("-")&&u.splice(t,1)}return d.length>0?s.setIn(["packages"],d):(s.setIn(["packages"],[]),this.deleteYamlDocProp(s,["packages"]),this.deleteYamlDocProp(s,["package_update"])),u.length>0?s.setIn(["runcmd"],u):this.deleteYamlDocProp(s,["runcmd"]),s},generateSecretName(e){return e?`${e}-${Object(b["p"])(5).toLowerCase()}`:void 0},getOwnerReferencesFromVM(e){var t;const a=e.metadata.name,s=e.kind,i=this.resource===w["a"].VM?"kubevirt.io/v1":"harvesterhci.io/v1beta1",l=null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.uid;return[{name:a,kind:s,uid:l,apiVersion:i}]},async saveSecret(e){if(null===e||void 0===e||!e.spec||!this.secretName||this.isWindows)return!0;let t=this.getSecret(e.spec);!t&&this.isEdit&&this.secretRef&&(t=this.secretRef),t&&!this.needNewSecret||(t=await this.$store.dispatch(w["b"]+"/create",{metadata:{name:this.secretName,namespace:this.value.metadata.namespace,labels:{[_["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:S["B"]}));try{t&&(this.saveUserDataAsClearText&&this.saveNetworkDataAsClearText||(t.setData("userdata",this.userData||""),t.setData("networkdata",this.networkScript||""),await t.save()))}catch(a){return Promise.reject(a)}},async saveAccessCredentials(e){if(null===e||void 0===e||!e.spec)return!0;const t=[];for(const s of this.accessCredentials){let a=s.secretRef;if(a&&!this.needNewSecret||(a=await this.$store.dispatch(w["b"]+"/create",{metadata:{name:s.secretName,namespace:e.metadata.namespace,labels:{[_["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:S["B"]})),s.source===g["a"].RESET_PWD&&a.setData(s.username,s.newPassword),s.source===g["a"].INJECT_SSH)for(const e of s.sshkeys){const t=(this.$store.getters["cluster/all"](w["a"].SSH)||[]).find(t=>t.id===e);a.setData(`${t.metadata.namespace}-${t.metadata.name}`,t.spec.publicKey)}t.push(a)}try{for(const e of t)await e.save()}catch(a){return Promise.reject(a)}},getAccessCredentialsValidation(){const e=[];for(let t=0;t<this.accessCredentials.length;t++){const a=this.accessCredentials[t],s=a.source;if(s===g["a"].RESET_PWD){if(!a.username){const t=this.t("harvester.virtualMachine.input.username"),a=this.t("validation.required",{key:t});e.push(a)}if(!a.newPassword){const t=this.t("harvester.virtualMachine.input.password"),a=this.t("validation.required",{key:t});e.push(a)}if(a.newPassword&&a.newPassword.length<6){const t=this.t("harvester.virtualMachine.input.password"),a=this.t("validation.number.min",{key:t,val:"6"});e.push(a)}}else{if(!a.users||0===a.users.length){const t=this.t("harvester.virtualMachine.input.username"),a=this.t("validation.required",{key:t});e.push(a)}if(!a.sshkeys||0===a.sshkeys.length){const t=this.t("harvester.virtualMachine.input.sshKeyValue"),a=this.t("validation.required",{key:t});e.push(a)}}if(e.length>0)break}return e},getHasCreatedVolumes(e){const t=[];return e.template.spec.volumes&&e.template.spec.volumes.forEach(e=>{var a;null!==e&&void 0!==e&&null!==(a=e.persistentVolumeClaim)&&void 0!==a&&a.claimName&&t.push(e.persistentVolumeClaim.claimName)}),t},handlerUSBTablet(e){var t;const a=this.isInstallUSBTablet(this.spec),s=(null===(t=this.spec.template.spec.domain.devices)||void 0===t?void 0:t.inputs)||[];if(e&&!a)s.length>0?s.push(M["b"][0]):Object.assign(this.spec.template.spec.domain.devices,{inputs:[M["b"][0]]});else if(!e){const e=s.findIndex(e=>n()(e,M["b"][0]));a&&1===s.length?this.$delete(this.spec.template.spec.domain.devices,"inputs"):a&&(s.splice(e,1),this.$set(this.spec.template.spec.domain.devices,"inputs",s))}},setBootMethod(e={efi:!1,secureBoot:!1}){e.efi&&e.secureBoot?(Object(v["j"])(this.spec.template.spec.domain,"features.smm.enabled",!0),Object(v["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!0)):e.efi&&!e.secureBoot?(Object(v["j"])(this.spec.template.spec.domain,"features.smm.enabled",!1),Object(v["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!1)):(this.$delete(this.spec.template.spec.domain,"firmware"),this.$delete(this.spec.template.spec.domain.features,"smm"))},deleteSSHFromUserData(e=[]){const t=this.getSSHFromUserData(this.userScript);e.map(e=>{const a=t.findIndex(t=>t===this.getSSHValue(e));a>=0&&t.splice(a,1)});const a=this.convertToJson(this.userScript);a.ssh_authorized_keys=t,0===t.length&&delete a.ssh_authorized_keys,u()(a)?this.$set(this,"userScript",void 0):this.$set(this,"userScript",r.a.dump(a)),this.refreshYamlEditor()},refreshYamlEditor(){this.$nextTick(()=>{var e;null===(e=this.$refs.yamlEditor)||void 0===e||e.updateValue()})},toggleAdvanced(){this.showAdvanced=!this.showAdvanced},updateAgent(e){e||(this.deletePackage=!0)},updateDataTemplateId(e,t){if("user"===e){const e=this.installAgent;this.userDataTemplateId=t,this.$nextTick(()=>{e&&(this.installAgent=e)})}},updateReserved(e={}){const{memory:t}=e;this.$set(this,"reservedMemory",t)}},watch:{diskRows:{handler(e,t){if(Array.isArray(e)){var a,s;const i=null===(a=e[0])||void 0===a?void 0:a.image,l=this.images.find(e=>i===e.id),r=null===l||void 0===l?void 0:l.imageOSType,o=null===(s=t[0])||void 0===s?void 0:s.image;this.isCreate&&o===i&&i&&(this.osType=r)}}},secretRef:{handler(e){e&&this.resource!==w["a"].BACKUP&&(this.secretName=null===e||void 0===e?void 0:e.metadata.name)},immediate:!0,deep:!0},isWindows(e){e&&(this.$set(this,"sshKey",[]),this.$set(this,"userScript",void 0),this.$set(this,"installAgent",!1))},installUSBTablet(e){this.handlerUSBTablet(e)},efiEnabled(e){this.setBootMethod({efi:e,secureBoot:this.secureBoot})},secureBoot(e){this.setBootMethod({efi:this.efiEnabled,secureBoot:e})},installAgent:{handler(e){if(this.deleteAgent){let t=this.getUserData({installAgent:e,osType:this.osType,deletePackage:this.deletePackage});if(e){const e=this.hasCloudConfigComment(t);e||(t="#cloud-config\n"+t)}this.$set(this,"userScript",t),this.refreshYamlEditor()}this.deleteAgent=!0,this.deletePackage=!1}},osType(e){const t=this.getUserData({installAgent:this.installAgent,osType:e});this.$set(this,"userScript",t),this.refreshYamlEditor()},userScript(e,t){const a=this.hasInstallAgent(e,this.osType,this.installAgent);a!==this.installAgent&&(this.deleteAgent=!1,this.installAgent=a)},sshKey(e,t){const a=m()(t,e);a.length&&this.isEdit&&this.deleteSSHFromUserData(a)}}}},"6b0f":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".action[data-v-4ed320b6]{display:flex;flex-direction:row-reverse}",""]),e.exports=t},"6b14":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".access[data-v-1d65dfc6]{display:flex;flex-direction:row}",""]),e.exports=t},"76d0":function(e,t,a){var s=a("79ec");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("f16dd53e",s,!0,{sourceMap:!1,shadowMode:!1})},"79ec":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".compat-matrix,.device-col{display:flex}.device-col{flex-direction:column;border-right:1px solid var(--border)}.device-col>*{border-bottom:1px solid var(--border)}.compat-cell{flex-basis:1em;padding:0 10px 0 10px}.compat-cell.has-device{background-color:var(--info-banner-bg)}.device-label,.node-label{display:flex;align-items:center;color:var(--input-label)}.node-label{padding:0 10px;justify-content:center}.blank-corner,.compat-cell,.device-label,.node-label{flex-basis:calc(2em + 10px)}.blank-corner{background:linear-gradient(to top right,#fff 0,#fff calc(50% - 1px),var(--body-text) 50%,#fff calc(50% + 1px),#fff)}.blank-corner DIV.text-right{padding-left:80px}",""]),e.exports=t},"7a52":function(e,t,a){"use strict";a("8123")},"7ebf":function(e,t,a){"use strict";a("f56d")},8123:function(e,t,a){var s=a("2344");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("0e0965e0",s,!0,{sourceMap:!1,shadowMode:!1})},8287:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[t("Banner",{staticClass:"mb-20",attrs:{color:"info",label:e.t("harvester.virtualMachine.accessCredentials.tips")}}),e._l(e.rows,(function(a,s){return t("div",{key:a.id},[t("InfoBox",{staticClass:"volume-source"},[e.isEdit?t("button",{staticClass:"role-link btn btn-sm remove-vol",attrs:{type:"button"},on:{click:function(t){return e.remove(a)}}},[t("i",{staticClass:"icon icon-x"})]):e._e(),t("h3",[t("span",[e._v(" "+e._s(e.headerFor(a.source))+" ")])]),t("div",[t(e.componentFor(a.source),{tag:"component",attrs:{rows:e.rows,resource:e.resource,"user-options":e.userOptions,mode:e.mode,idx:s},on:{update:e.update,"update:newUser":e.updateNewUser},model:{value:e.rows[s],callback:function(t){e.$set(e.rows,s,t)},expression:"rows[i]"}})],1)])],1)})),e.isEdit&&e.isQemuInstalled?t("div",{staticClass:"mt-20"},[t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addCredentials(e.ACCESS_CREDENTIALS.RESET_PWD)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.accessCredentials.resetPwd.label"))+" ")]),t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addCredentials(e.ACCESS_CREDENTIALS.INJECT_SSH)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.accessCredentials.injectSSH.label"))+" ")])]):e._e()],2)},i=[],l=a("9ce4"),r=a("6418"),o=a("13a9"),n=a("2cb5"),d=a("bddd"),u=a("7c47"),c=a("da25"),m=a("873f");const p="_NEW";var v={components:{Banner:r["a"],InfoBox:o["a"]},props:{value:{type:Array,default:()=>[]},resource:{type:Object,default:()=>({})},mode:{type:String,default:"create"},disableCreate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isQemuInstalled:{type:Boolean,default:!1}},data(){return{ACCESS_CREDENTIALS:u["a"],toRemove:[],toSave:[],rows:[],newUserOptions:[]}},computed:{...Object(l["a"])({t:"i18n/t"}),isEdit(){return this.mode===c["p"]},historyUsersOptions(){var e;const t=JSON.parse((null===(e=this.resource)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[m["a"].DYNAMIC_SSHKEYS_USERS])||"[]");return t.unshift({label:this.t("harvester.virtualMachine.accessCredentials.injectSSH.addUser"),value:p}),t},userOptions(){return Array.from(new Set([...this.historyUsersOptions,...this.newUserOptions]))}},watch:{value:{handler(e){this.rows=[...e]},deep:!0,immediate:!0}},methods:{addCredentials(e){const t={source:e,users:[],sshkeys:[],username:"",newPassword:"",secretName:this.generateSecretName(this.resource.metadata.name)};this.rows.push(t),this.update()},remove(e){Object(d["i"])(this.rows,e),this.update()},update(){this.$emit("input",this.rows)},updateNewUser(e){this.newUserOptions.push(e)},generateSecretName(e){return e?`${e}-${Object(n["p"])(5).toLowerCase()}`:void 0},componentFor(e){switch(e){case u["a"].RESET_PWD:return a("e299").default;case u["a"].INJECT_SSH:return a("db40").default}},headerFor(e){return{userPassword:this.$store.getters["i18n/t"]("harvester.virtualMachine.accessCredentials.resetPwd.label"),sshPublicKey:this.$store.getters["i18n/t"]("harvester.virtualMachine.accessCredentials.injectSSH.label")}[e]}}},h=v,b=(a("7ebf"),a("d802")),f=Object(b["a"])(h,s,i,!1,null,"6386f148",null);t["a"]=f.exports},"85b9":function(e,t,a){var s=a("aeeb");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("6a5bc2fa",s,!0,{sourceMap:!1,shadowMode:!1})},8885:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return e.spec?t("CruResource",{attrs:{id:"vm","done-route":e.doneRoute,resource:e.value,mode:e.mode,"can-yaml":!!e.isSingle,errors:e.errors,"generate-yaml":e.generateYaml,"apply-hooks":e.applyHooks},on:{finish:e.saveVM}},[e.isCreate?t("RadioGroup",{staticClass:"mb-20 vm-radio-group",attrs:{name:"createInstanceMode",options:[!0,!1],disabled:"",labels:[e.t("harvester.virtualMachine.instance.single.label"),e.t("harvester.virtualMachine.instance.multiple.label")]},model:{value:e.isSingle,callback:function(t){e.isSingle=t},expression:"isSingle"}}):e._e(),t("NameNsDescription",{attrs:{mode:e.mode,"has-extra":!e.isSingle,"name-label":e.nameLabel,namespaced:!0,"name-placeholder":e.isSingle?"nameNsDescription.name.placeholder":"harvester.virtualMachine.instance.multiple.nameNsDescription","extra-columns":e.isSingle?[]:["type"]},scopedSlots:e._u([{key:"type",fn:function(){return[e.isSingle?e._e():t("LabeledInput",{directives:[{name:"int-number",rawName:"v-int-number"}],attrs:{type:"number",label:e.t("harvester.virtualMachine.instance.multiple.count"),required:""},on:{input:e.validateCount},model:{value:e.count,callback:function(t){e.count=e._n(t)},expression:"count"}})]},proxy:!0}],null,!1,4082063570),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e.isCreate?t("Checkbox",{staticClass:"check mb-20",attrs:{type:"checkbox",disabled:"","label-key":"harvester.virtualMachine.useTemplate.label"},model:{value:e.useTemplate,callback:function(t){e.useTemplate=t},expression:"useTemplate"}}):e._e(),e.useTemplate?t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{"label-key":"harvester.virtualMachine.useTemplate.template.label",options:e.templateOptions},on:{input:e.updateTemplateId},model:{value:e.templateId,callback:function(t){e.templateId=t},expression:"templateId"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{"label-key":"harvester.virtualMachine.useTemplate.version.label",options:e.versionOptions},model:{value:e.templateVersionId,callback:function(t){e.templateVersionId=t},expression:"templateVersionId"}})],1)]):e._e(),t("Tabbed",{attrs:{"side-tabs":!0},on:{changed:e.onTabChanged}},[t("Tab",{attrs:{name:"basics",label:e.t("harvester.virtualMachine.detail.tabs.basics")}},[t("CpuMemory",{attrs:{cpu:e.cpu,memory:e.memory,mode:e.mode},on:{updateCpuMemory:e.updateCpuMemory}}),t("SSHKey",{staticClass:"mb-20",attrs:{namespace:e.value.metadata.namespace,mode:e.mode,disabled:e.isWindows},on:{"update:sshKey":e.updateSSHKey,"register-after-hook":e.registerAfterHook},model:{value:e.sshKey,callback:function(t){e.sshKey=t},expression:"sshKey"}})],1),t("Tab",{attrs:{name:"Volume",label:e.t("harvester.tab.volume"),weight:-1}},[t("Volume",{attrs:{mode:e.mode,"custom-volume-mode":e.customVolumeMode,namespace:e.value.metadata.namespace,"resource-type":e.value.type,vm:e.value,"validate-required":!0},model:{value:e.diskRows,callback:function(t){e.diskRows=t},expression:"diskRows"}})],1),t("Tab",{attrs:{name:"Network",label:e.t("harvester.tab.network"),weight:-2}},[t("Network",{attrs:{namespace:e.value.metadata.namespace,mode:e.mode,"is-single":e.isSingle},model:{value:e.networkRows,callback:function(t){e.networkRows=t},expression:"networkRows"}})],1),t("Tab",{attrs:{name:"nodeScheduling",label:e.t("workload.container.titles.nodeScheduling"),weight:-3},scopedSlots:e._u([{key:"default",fn:function({active:a}){return[t("NodeScheduling",{key:a,attrs:{mode:e.mode,value:e.spec.template.spec,nodes:e.nodesIdOptions}})]}}],null,!1,4193668642)}),t("Tab",{attrs:{label:e.t("harvester.tab.gpu"),name:"pciDevices",weight:-4}},[t("PciDevices",{attrs:{mode:e.mode,value:e.spec.template.spec,vm:e.value}})],1),e.isEdit?t("Tab",{attrs:{label:e.t("harvester.tab.accessCredentials"),name:"accessCredentials",weight:-5}},[t("AccessCredentials",{attrs:{mode:e.mode,resource:e.value,"is-qemu-installed":e.isQemuInstalled},model:{value:e.accessCredentials,callback:function(t){e.accessCredentials=t},expression:"accessCredentials"}})],1):e._e(),t("Tab",{attrs:{name:"advanced",label:e.t("harvester.tab.advanced"),weight:-5}},[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{"label-key":"harvester.virtualMachine.runStrategy",options:e.RunStrategys,mode:e.mode},model:{value:e.runStrategy,callback:function(t){e.runStrategy=t},expression:"runStrategy"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{"label-key":"harvester.virtualMachine.osType",options:e.OS,disabled:!e.isCreate},model:{value:e.osType,callback:function(t){e.osType=t},expression:"osType"}})],1)]),t("div",{staticClass:"row mb-20"},[(e.showAdvanced,t("a",{directives:[{name:"t",rawName:"v-t",value:"harvester.generic.showMore",expression:"'harvester.generic.showMore'"}],attrs:{role:"button"},on:{click:e.toggleAdvanced}}))]),e.showAdvanced?t("div",{staticClass:"mb-20"},[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{"label-key":e.hostnameLabel,placeholder:e.hostPlaceholder,mode:e.mode},model:{value:e.hostname,callback:function(t){e.hostname=t},expression:"hostname"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{"label-key":"harvester.virtualMachine.input.MachineType",options:e.machineTypeOptions,mode:e.mode},model:{value:e.machineType,callback:function(t){e.machineType=t},expression:"machineType"}})],1)])]):e._e(),t("CloudConfig",{ref:"yamlEditor",attrs:{"user-script":e.userScript,mode:e.mode,"view-code":e.isWindows,namespace:e.value.metadata.namespace,"network-script":e.networkScript},on:{updateUserData:e.updateUserData,updateNetworkData:e.updateNetworkData,updateDataTemplateId:e.updateDataTemplateId}}),t("Checkbox",{staticClass:"check mt-20",attrs:{type:"checkbox","tooltip-key":"harvester.virtualMachine.usbTip","label-key":"harvester.virtualMachine.enableUsb",mode:e.mode},model:{value:e.installUSBTablet,callback:function(t){e.installUSBTablet=t},expression:"installUSBTablet"}}),t("Checkbox",{staticClass:"check",attrs:{type:"checkbox",disabled:e.isWindows,"label-key":"harvester.virtualMachine.installAgent",mode:e.mode},on:{input:e.updateAgent},model:{value:e.installAgent,callback:function(t){e.installAgent=t},expression:"installAgent"}}),t("Checkbox",{staticClass:"check",attrs:{type:"checkbox",label:e.t("harvester.virtualMachine.efiEnabled"),mode:e.mode,disabled:""},model:{value:e.efiEnabled,callback:function(t){e.efiEnabled=t},expression:"efiEnabled"}}),e.efiEnabled?t("Checkbox",{staticClass:"check",attrs:{type:"checkbox",label:e.t("harvester.virtualMachine.secureBoot"),mode:e.mode,disabled:""},model:{value:e.secureBoot,callback:function(t){e.secureBoot=t},expression:"secureBoot"}}):e._e()],1)],1),t("RestartVMDialog",{ref:"restartDialog",attrs:{vm:e.value}})],1):e._e()},i=[],l=a("9e74"),r=a.n(l),o=a("9ce4"),n=a("0cb2"),d=a("38de"),u=a("0df0"),c=a("fd5f"),m=a("e143"),p=a("8e93"),v=a("466b"),h=a("3c8c"),b=a("907c"),f=a("2a79"),y=a("9216"),g=a("fea5"),C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("InputOrDisplay",{staticClass:"mb-20",attrs:{name:"CPU",value:e.cupDisplay,mode:e.mode}},[t("UnitInput",{directives:[{name:"int-number",rawName:"v-int-number"}],staticClass:"mb-20",attrs:{label:"CPU",suffix:"C",delay:0,required:"",disabled:e.disabled,mode:e.mode},on:{input:e.change},model:{value:e.localCpu,callback:function(t){e.localCpu=t},expression:"localCpu"}})],1)],1),t("div",{staticClass:"col span-6"},[t("InputOrDisplay",{staticClass:"mb-20",attrs:{name:e.t("harvester.virtualMachine.input.memory"),value:e.memoryDisplay,mode:e.mode}},[t("UnitInput",{directives:[{name:"int-number",rawName:"v-int-number"}],staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.memory"),mode:e.mode,"input-exponent":3,delay:0,increment:1024,"output-modifier":!0,disabled:e.disabled,required:""},on:{input:e.change},model:{value:e.localMemory,callback:function(t){e.localMemory=t},expression:"localMemory"}})],1)],1)])},S=[],w=a("4978"),k=a("5361"),N={name:"HarvesterEditCpuMemory",components:{UnitInput:w["a"],InputOrDisplay:k["a"]},props:{cpu:{type:Number,default:null},memory:{type:String,default:null},mode:{type:String,default:"create"},disabled:{type:Boolean,default:!1}},data(){return{localCpu:this.cpu,localMemory:this.memory}},computed:{cupDisplay(){return this.localCpu+" C"},memoryDisplay(){return this.localMemory+" GiB"}},watch:{cpu(e){this.localCpu=e},memory(e){e&&!e.includes("null")&&(this.localMemory=e)}},methods:{change(){let e="";e=String(this.localMemory).includes("Gi")?this.localMemory:this.localMemory+"Gi",e.includes("null")&&(e=null),this.$emit("updateCpuMemory",this.localCpu,e)}}},_=N,M=a("d802"),O=Object(M["a"])(_,C,S,!1,null,null,null),I=O.exports,E=function(){var e=this,t=e._self._c;return t("div",[e.isView?e._e():t("h2",[e._v(" "+e._s(e.t("harvester.virtualMachine.cloudConfig.title"))+" ")]),t("div",{staticClass:"mb-20"},[t("DataTemplate",{ref:"userTemplate",attrs:{type:"user","view-code":e.viewCode,mode:e.mode,"config-id":e.configUserId,options:e.optionUser},on:{show:e.show,update:e.update,updateTemplateId:e.updateTemplateId},model:{value:e.userScript,callback:function(t){e.userScript=t},expression:"userScript"}})],1),t("div",{staticClass:"mb-20"},[t("DataTemplate",{ref:"networkTemplate",attrs:{type:"network","view-code":e.viewCode,mode:e.mode,"config-id":e.configNetworkId,options:e.optionNetwork},on:{show:e.show,update:e.update},model:{value:e.networkScript,callback:function(t){e.networkScript=t},expression:"networkScript"}})],1),t("ModalWithCard",{ref:"createCloudTemplate",attrs:{name:"createCloudTemplate",width:"40%",errors:e.errors},on:{finish:e.save,close:e.cancel},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.cloudConfig.createTemplateTitle",{name:e.createTypeLable}))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.name"),required:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),(()=>{}).apply(null,arguments))}},model:{value:e.cloudTemplateName,callback:function(t){e.cloudTemplateName=t},expression:"cloudTemplateName"}}),t("div",{staticClass:"yaml"},[t("div",{staticClass:"resource-yaml"},[t("YamlEditor",{ref:"createTemplate",staticClass:"yaml-editor",attrs:{"editor-mode":e.editorMode},model:{value:e.cloudTemplate,callback:function(t){e.cloudTemplate=t},expression:"cloudTemplate"}})],1)])]},proxy:!0}])})],1)},T=[],x=a("870a"),A=a("977e"),$=a("873f"),D=a("da25"),V=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mb-20"},[t("h3",[e._v(e._s(e.t(`harvester.virtualMachine.cloudConfig.${e.type}.title`)))]),t("p",{staticClass:"text-muted mb-20"},[t("t",{attrs:{k:`harvester.virtualMachine.cloudConfig.${e.type}.tip`,raw:!0}})],1),e.isView?e._e():t("LabeledSelect",{staticClass:"mb-20",attrs:{options:e.options,disabled:e.viewCode,"label-key":`harvester.virtualMachine.cloudConfig.${e.type}.label`},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}}),t("div",{staticClass:"resource-yaml"},[t("YamlEditor",{ref:"yaml",staticClass:"yaml-editor",attrs:{"editor-mode":e.editorMode},model:{value:e.yamlScript,callback:function(t){e.yamlScript=t},expression:"yamlScript"}})],1)],1)},R=[],L=a("90cd");const U="_NEW",P="_NONE";var j={components:{YamlEditor:x["b"],LabeledSelect:v["a"]},props:{mode:{type:String,default:"create"},value:{type:String,default:""},type:{type:String,default:""},options:{type:Array,default:()=>[]},configId:{type:String,default:""},viewCode:{type:Boolean,default:!1}},data(){return{id:"",yamlScript:this.value}},computed:{...Object(o["a"])({t:"i18n/t"}),editorMode(){return this.isView||this.viewCode?x["a"].VIEW_CODE:x["a"].EDIT_CODE},isView(){return this.mode===D["w"]}},watch:{value(e){this.yamlScript=e},configId(e){this.id=this.configId},id(e,t){var a;const s=(null===(a=this.$store.getters[L["b"]+"/byId"](b["c"],e))||void 0===a||null===(a=a.data)||void 0===a?void 0:a.cloudInit)||"";if(this.$emit("updateTemplateId",this.type,e),e){if(e===U)return this.$emit("show",this.type),void(this.id=t);this.yamlScript=e===P?"":s,this.$refs["yaml"].updateValue(s)}},yamlScript(e){this.$emit("update",e,this.type)}},methods:{refresh(){this.$refs.yaml.refresh()},updateValue(){this.$refs["yaml"].updateValue(this.value)}}},B=j,q=(a("b134"),Object(M["a"])(B,V,R,!1,null,"7d491695",null)),G=q.exports;const H="_NEW",K="_NONE";var F={components:{DataTemplate:G,YamlEditor:x["b"],LabeledInput:p["a"],ModalWithCard:A["a"]},props:{mode:{type:String,default:"create"},namespace:{type:String,default:""},userScript:{type:String,default:""},networkScript:{type:String,default:""},viewCode:{type:Boolean,default:!1}},data(){return{errors:[],templateType:"",cloudTemplate:"",cloudTemplateName:"",configUserId:"",configNetworkId:"",optionUser:[],optionNetwork:[]}},async fetch(){const e=await this.$store.dispatch(L["b"]+"/findAll",{type:b["c"]}),t=[],a=[];for(const l of e){var s,i;"user"===(null===(s=l.metadata)||void 0===s||null===(s=s.labels)||void 0===s?void 0:s[$["a"].CLOUD_INIT])&&t.push({label:null===l||void 0===l?void 0:l.id,value:null===l||void 0===l?void 0:l.id}),"network"===(null===(i=l.metadata)||void 0===i||null===(i=i.labels)||void 0===i?void 0:i[$["a"].CLOUD_INIT])&&a.push({label:null===l||void 0===l?void 0:l.id,value:null===l||void 0===l?void 0:l.id})}t.unshift({label:this.t("harvester.virtualMachine.cloudConfig.createNew"),value:H}),t.unshift({label:this.t("harvester.virtualMachine.cloudConfig.cloudInit.placeholder"),value:K}),a.unshift({label:this.t("harvester.virtualMachine.cloudConfig.createNew"),value:H}),a.unshift({label:this.t("harvester.virtualMachine.cloudConfig.cloudInit.placeholder"),value:K}),this.optionUser=t,this.optionNetwork=a},computed:{...Object(o["a"])({t:"i18n/t"}),createTypeLable(){const e=`harvester.virtualMachine.cloudConfig.${this.templateType}.label`;return this.t(e)},editorMode(){return this.isView?x["a"].VIEW_CODE:x["a"].EDIT_CODE},isView(){return this.mode===D["w"]}},methods:{updateValue(){this.$refs["userTemplate"].updateValue(),this.$refs["networkTemplate"].updateValue()},update(e,t){"user"===t&&this.$emit("updateUserData",e),"network"===t&&this.$emit("updateNetworkData",e)},updateTemplateId(e,t){this.$emit("updateDataTemplateId",e,t)},show(e){this.templateType=e,this.$modal.show("createCloudTemplate")},async save(e){if(this.errors=[],!this.cloudTemplateName)return this.errors.push(this.t("validation.required",{key:this.t("harvester.virtualMachine.input.name")},!0)),void e(!1);if(!this.cloudTemplate){const t="user"===this.templateType?"harvester.cloudTemplate.userData":"harvester.cloudTemplate.networkData";return this.errors.push(this.t("validation.required",{key:this.t(t)},!0)),void e(!1)}const t=await this.$store.dispatch(L["b"]+"/create",{type:b["c"],metadata:{labels:{[$["a"].CLOUD_INIT]:this.templateType},name:this.cloudTemplateName,namespace:this.namespace},data:{cloudInit:this.cloudTemplate}});try{const a=await t.save();a.id&&("user"===this.templateType?this.configUserId=a.id:this.configNetworkId=a.id,this.$fetch()),e(!0),this.cancel()}catch(a){this.errors=[a.message],e(!1)}},cancel(){this.cloudTemplate="",this.cloudTemplateName="",this.$set(this,"errors",[]),this.$modal.hide("createCloudTemplate")},refresh(){this.$refs["userTemplate"].refresh(),this.$refs["networkTemplate"].refresh()}}},W=F,Y=(a("f7b6"),Object(M["a"])(W,E,T,!1,null,"6a2ca441",null)),z=Y.exports,J=a("2e57"),X=a("8287"),Q=function(){var e=this,t=e._self._c;return t("div",[e.oldFormatDevices.length>0?t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[t("Banner",{attrs:{color:"warning"}},[t("p",{domProps:{innerHTML:e._s(e.t("harvester.pci.oldFormatDevices.help",{oldFormatDevicesHTML:e.oldFormatDevicesHTML},!0))}})])],1)]):t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[t("Banner",{attrs:{color:"info"}},[t("t",{attrs:{k:"harvester.pci.howToUseDevice"}})],1),e.selectedDevices.length>0?t("Banner",{attrs:{color:"info"}},[t("t",{attrs:{k:"harvester.pci.deviceInTheSameHost"}})],1):e._e()],1)]),e.enabledDevices.length?[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Available GPUs",searchable:"",multiple:"",taggable:"",options:e.deviceOpts,mode:e.mode},scopedSlots:e._u([{key:"option",fn:function(a){return[t("span",[e._v(e._s(a.value)+" "),t("span",{staticClass:"text-label"},[e._v("("+e._s(a.displayLabel)+")")])])]}}],null,!1,975880344),model:{value:e.selectedDevices,callback:function(t){e.selectedDevices=t},expression:"selectedDevices"}})],1)]),e.compatibleNodes.length&&e.selectedDevices.length?t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12 text-muted"},[e._v(" Compatible hosts: "),e._l(e.compatibleNodes,(function(a,s){return t("span",{key:a},[e._v(e._s(a)+e._s(s<e.compatibleNodes.length-1?", ":""))])}))],2)]):e.selectedDevices.length?t("div",{staticClass:"text-error"},[e._v(" "+e._s(e.t("harvester.pci.impossibleSelection"))+" ")]):e._e(),e.showMatrix?t("div",{staticClass:"row mt-20"},[t("div",{staticClass:"col span-12"},[t("CompatibilityMatrix",{attrs:{"enabled-devices":e.enabledDevices,"devices-by-node":e.devicesByNode,"devices-in-use":e.devicesInUse}})],1)]):e._e()]:e._e(),t("div",{staticClass:"row mt-20"},[t("div",{staticClass:"col span-12"},[t("DeviceList",{attrs:{allgpu:e.pciDevices,node:e.node,schema:e.pciDeviceSchema,rows:e.filterByGroup},on:{submit:function(e){e.preventDefault()}}})],1)])],2)])},Z=[],ee=a("a8b9"),te=a("eb32"),ae=function(){var e=this,t=e._self._c;return t("div",{staticClass:"compat-matrix"},[t("div",{staticClass:"device-col node-names"},[t("div",{staticClass:"blank-corner"},[t("div",{staticClass:"text-right"},[e._v(" "+e._s(e.t("harvester.pci.matrixDeviceClaimName"))+" ")]),t("div",[e._v(e._s(e.t("harvester.pci.matrixHostName")))])]),e._l(e.allNodeNames,(function(a){return t("div",{key:a,staticClass:"node-label"},[t("span",[e._v(" "+e._s(a))])])}))],2),e._l(e.enabledDevices,(function(a){return t("div",{key:a.metadata.name,staticClass:"device-col"},[t("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.deviceTooltip(a),expression:"deviceTooltip(deviceCRD)"}],staticClass:"compat-cell device-label",class:{"text-muted":e.noneAvailable(a)}},[e._v(" "+e._s(a.metadata.name)+" ")]),e._l(e.allNodeNames,(function(s){return t("div",{key:s,staticClass:"compat-cell",class:{"has-device":e.nodeHasDevice(s,a)}})}))],2)}))],2)},se=[],ie={props:{enabledDevices:{type:Array,required:!0},devicesByNode:{type:Object,required:!0},devicesInUse:{type:Object,default:()=>{}}},computed:{...Object(o["a"])({t:"i18n/t"}),allNodeNames(){return Object.keys(this.devicesByNode)},allDeviceIds(){return Object.keys(this.uniqueDevices)}},methods:{nodeNameFromId(e){var t;return null===(t=this.devicesByNode[e])||void 0===t?void 0:t.name},nodeHasDevice(e,t){return t.status.nodeName===e},noneAvailable(e){var t;const a=null===(t=e.metadata)||void 0===t?void 0:t.name;return!!this.devicesInUse[a]},deviceTooltip(e){var t,a;return`${null===e||void 0===e||null===(t=e.status)||void 0===t?void 0:t.resourceName}<br/>${null===e||void 0===e||null===(a=e.status)||void 0===a?void 0:a.description}`}}},le=ie,re=(a("af36"),Object(M["a"])(le,ae,se,!1,null,null,null)),oe=re.exports,ne=a("9a01"),de=a("9274"),ue=a.n(de),ce=a("e24b"),me={name:"VirtualMachinePCIDevices",components:{LabeledSelect:v["a"],DeviceList:ne["a"],CompatibilityMatrix:oe,Banner:te["a"]},props:{mode:{type:String,default:D["p"]},value:{type:Object,default:()=>{}},vm:{type:Object,default:()=>{}}},async fetch(){var e;const t={pciDevices:this.$store.dispatch(L["b"]+"/findAll",{type:L["a"].PCI_DEVICE}),claims:this.$store.dispatch(L["b"]+"/findAll",{type:L["a"].PCI_CLAIM}),vms:this.$store.dispatch(L["b"]+"/findAll",{type:L["a"].VM}),node:this.$store.dispatch(L["b"]+"/findAll",{type:"node"})},a=await Object(ee["a"])(t);for(const l in a)this[l]=a[l];const s=[],i=[];((null===(e=this.value)||void 0===e||null===(e=e.domain)||void 0===e||null===(e=e.devices)||void 0===e?void 0:e.gpus)||[]).forEach(({name:e,deviceName:t})=>{var a;const l=null===(a=(t||"").split("/"))||void 0===a?void 0:a[1];l&&e.includes(l)?i.push(e):this.enabledDevices.find(t=>{var a;return(null===t||void 0===t||null===(a=t.metadata)||void 0===a?void 0:a.name)===e})&&s.push(e)}),i.length>0?this.oldFormatDevices=i:this.selectedDevices=s},data(){return{pciDevices:[],claims:[],vms:[],node:[],selectedDevices:[],pciDeviceSchema:this.$store.getters[L["b"]+"/schemaFor"](L["a"].PCI_DEVICE),showMatrix:!1,oldFormatDevices:[]}},watch:{selectedDevices(e){const t=e.map(e=>{var t;const a=this.enabledDevices.find(t=>t.metadata.name===e),s=null===a||void 0===a||null===(t=a.status)||void 0===t?void 0:t.resourceName;return{deviceName:s,name:null===a||void 0===a?void 0:a.metadata.name}});Object(ce["j"])(this.value.domain.devices,"gpus",t)}},computed:{enabledDevices(){return this.filterByGroup.filter(e=>e.isEnabled&&e.claimedByMe)||[]},devicesInUse(){const e=this.vms.reduce((e,t)=>{var a;if(t.metadata.name===(null===(a=this.vm)||void 0===a||null===(a=a.metadata)||void 0===a?void 0:a.name))return e;const s=Object(ce["g"])(t,"spec.template.spec.domain.devices.hostDevices")||[];return s.forEach(a=>{e[a.name]={usedBy:[t.metadata.name]}}),e},{});return e},devicesByNode(){const e={};return this.enabledDevices.forEach(t=>{var a;const s=null===(a=t.status)||void 0===a?void 0:a.nodeName;e[s]?e[s].push(t):e[s]=[t]}),e},compatibleNodes(){const e=[...Object.keys(this.devicesByNode)];return this.selectedDevices.forEach(t=>{ue()(e,e=>{const a=this.enabledDevices.find(e=>e.metadata.name===t);return a.status.nodeName!==e})}),e},filterByGroup(){const e={},t=[],a=[];this.node.forEach(e=>{"true"===e.metadata.labels["gpu.infortrend.com/vm-gpu-mode"]&&a.push(e.metadata.name)}),this.pciDevices.forEach(t=>{"10de"===t.status.vendorId&&(e[t.status.iommuGroup]||(e[t.status.iommuGroup]=[]),e[t.status.iommuGroup].push(t))});for(const i in e){const a=e[i],s=a.reduce((e,t)=>t.status.address<e.status.address?t:e,a[0]);t.push(s)}const s=t.filter(e=>a.includes(e.status.nodeName))||[];return s},deviceOpts(){const e=this.enabledDevices.filter(e=>{if(this.selectedDevices.length>0){const t=this.enabledDevices.find(e=>e.metadata.name===this.selectedDevices[0]);return!this.devicesInUse[null===e||void 0===e?void 0:e.metadata.name]&&e.status.nodeName===t.status.nodeName}return!this.devicesInUse[null===e||void 0===e?void 0:e.metadata.name]});return e.map(e=>{var t;return{value:null===e||void 0===e?void 0:e.metadata.name,label:null===e||void 0===e?void 0:e.metadata.name,displayLabel:null===e||void 0===e||null===(t=e.status)||void 0===t?void 0:t.resourceName}})},oldFormatDevicesHTML(){return this.oldFormatDevices.map(e=>`<li>${e}</li>`).join("")}},methods:{nodeNameFromUid(e){for(const t in this.uniqueDevices){const a=this.uniqueDevices[t].nodes,s=a.find(t=>t.systemUUID===e);if(s)return s.name}}}},pe=me,ve=Object(M["a"])(pe,Q,Z,!1,null,null,null),he=ve.exports,be=a("61a1"),fe=a("bddd"),ye=a("7c47"),ge=a("c5e6"),Ce=a("3e9d"),Se=a("842c"),we=a("6834"),ke=a("305c"),Ne={name:"HarvesterEditVM",components:{Tab:d["a"],Tabbed:n["a"],Checkbox:u["a"],RadioGroup:m["a"],CruResource:c["a"],LabeledInput:p["a"],LabeledSelect:v["a"],NameNsDescription:h["a"],Volume:y["a"],SSHKey:f["a"],Network:g["a"],CpuMemory:I,CloudConfig:z,NodeScheduling:J["a"],AccessCredentials:X["a"],PciDevices:he,RestartVMDialog:be["default"]},mixins:[ke["a"],we["c"]],props:{value:{type:Object,required:!0}},data(){var e;const t=Object(ce["e"])(this.value),a="Running"===this.value.actualState,s=this.value.spec.template.spec.hostname||"",i=this.$store.getters[L["b"]+"/all"](b["E"]).find(e=>e.isDefault),l=(null===i||void 0===i||null===(e=i.metadata)||void 0===e?void 0:e.name)||"nfs-csi";return{cloneVM:t,count:2,templateId:"",templateVersionId:"",namePrefix:"",isSingle:!0,useTemplate:!1,hostname:s,isRestartImmediately:a,RunStrategys:ye["c"],defaultStorage:l}},computed:{...Object(o["a"])({t:"i18n/t"}),machineTypeOptions(){return[{label:"None",value:""},{label:"q35",value:"q35"},{label:"pc",value:"pc"}]},templateOptions(){return this.templates.map(e=>{const t=this.hasAvailableVersion(e.id);return{label:e.id,value:e.id,disabled:!t}})},versionOptions(){var e;const t=null===(e=this.curTemplateResource)||void 0===e?void 0:e.defaultVersion;return this.versions.filter(e=>e.templateId===this.templateId).map(e=>{const a=e.version,s=t===a?`${a} (${this.t("generic.default")})`:a,i=e.id;return{label:s,value:i,disabled:!e.isReady}})},curTemplateResource(){return this.templates.find(e=>e.id===this.templateId)},nameLabel(){return this.isSingle?"harvester.virtualMachine.instance.single.nameLabel":"harvester.virtualMachine.instance.multiple.nameLabel"},hostnameLabel(){return this.isSingle?"harvester.virtualMachine.instance.single.host.label":"harvester.virtualMachine.instance.multiple.host.label"},hostPlaceholder(){return this.isSingle?this.t("harvester.virtualMachine.instance.single.host.placeholder"):this.t("harvester.virtualMachine.instance.multiple.host.placeholder")},secretNamePrefix(){var e;return null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.name},isQemuInstalled(){return this.value.isQemuInstalled},hasRestartAction(){return this.value.hasAction("restart")},hasStartAction(){return this.value.hasAction("start")}},watch:{templateId:{async handler(e,t){if(e&&e!==t&&!this.templateVersionId){var a;const t=await this.$store.dispatch(L["b"]+"/findAll",{type:L["a"].VM_TEMPLATE});this.templateVersionId=null===(a=t.find(t=>t.id===e))||void 0===a||null===(a=a.spec)||void 0===a?void 0:a.defaultVersionId}},immediate:!1},templateVersionId:{async handler(e){var t,a,s;if(!e)return;const i=await this.$store.dispatch(L["b"]+"/findAll",{type:L["a"].VM_VERSION}),l=i.find(t=>t.id===e),r=Object(ce["e"])(l.spec.vm);null===(t=r.spec)||void 0===t||null===(t=t.template)||void 0===t||null===(t=t.spec)||void 0===t||delete t.accessCredentials,null===(a=r.spec)||void 0===a||null===(a=a.template)||void 0===a||null===(a=a.metadata)||void 0===a||null===(a=a.annotations)||void 0===a||delete a[$["a"].DYNAMIC_SSHKEYS_NAMES],null===(s=r.spec)||void 0===s||null===(s=s.template)||void 0===s||null===(s=s.metadata)||void 0===s||null===(s=s.annotations)||void 0===s||delete s[$["a"].DYNAMIC_SSHKEYS_USERS];const o=this.getVolumeClaimTemplates(r),n=o.map(e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.spec)&&void 0!==t&&t.dataSource&&delete e.spec.dataSource,e});r.metadata.annotations[$["a"].VOLUME_CLAIM_TEMPLATE]=JSON.stringify(n),this.getInitConfig({value:r,existUserData:!0,fromTemplate:!0}),this.$set(this,"hasCreateVolumes",[])}},useTemplate(e){!1===e&&(this.templateId="",this.templateVersionId="",this.value.applyDefaults(),this.getInitConfig({value:this.value,init:this.isCreate}))}},created(){this.registerAfterHook(async()=>{await this.restartVM();const e=`${this.value.metadata.namespace}/${this.value.metadata.name}`,t=this.$store.getters[L["b"]+"/byId"](L["a"].VM,e);try{await this.saveSecret(t),await this.saveAccessCredentials(t)}catch(a){this.errors.push(...Object(Ce["b"])(a))}!this.errors.length&&this.isSingle&&this.done()}),this.registerBeforeHook&&this.registerBeforeHook(this.updateBeforeSave);const e={name:this.defaultStorage};this.value.metadata.annotations[$["a"].SC_SETTING]=JSON.stringify(e)},mounted(){var e;this.imageId=(null===(e=this.$route.query)||void 0===e?void 0:e.image)||this.imageId;const t=this.getDiskRows(this.value);this.$set(this,"diskRows",t);const a=this.$route.query.templateId,s=this.$route.query.versionId;a&&s&&(this.templateId=a,this.templateVersionId=s,this.useTemplate=!0)},methods:{saveVM(e){Object(fe["c"])(this.errors),this.isSingle?this.saveSingle(e):this.saveMultiple(e)},async saveSingle(e){this.parseVM(),this.value.spec.template.spec.hostname=this.hostname?this.hostname:this.value.metadata.name,await this._save(this.value,e),this.errors.length?e(!1):e(!0)},async saveMultiple(e){this.namePrefix=this.value.metadata.name||"";const t=this.namePrefix.endsWith("-")?"":"-",a=this.hostname?this.hostname:this.namePrefix;if(this.count<1)return this.errors=[this.t("harvester.virtualMachine.instance.multiple.countTip")],void e(!1);if(!this.value.metadata.name)return this.errors.push(this.t("validation.required",{key:this.t("generic.name")},!0)),void e(!1);const s=Object(ce["e"])(this.value),i=Object(ce["e"])(this.spec);for(let l=1;l<=this.count;l++){this.$set(this.value,"spec",s.spec),this.$set(this,"spec",i);const r=l<10?"0"+l:l;this.value.cleanForNew(),this.value.metadata.name=`${this.namePrefix}${t}${r}`,this.$set(this.value.spec.template.spec,"hostname",`${a}${t}${r}`),this.secretName="",await this.parseVM();const o=await this.$store.dispatch(L["b"]+"/clone",{resource:this.value});await this._save(o,e),l!==this.count||this.errors.length?l===this.count&&(this.value.metadata.name=this.namePrefix,e(!1)):(e(!0),this.done())}},async _save(e,t){try{await this.applyHooks(Se["b"]),await e.save(),await this.applyHooks(Se["a"])}catch(a){this.errors.push(...Object(Ce["b"])(a)),t(!1)}},restartVM(){var e,t;if("edit"!==this.mode)return;if(!this.value.isRunning)return;const a=Object(ce["e"])(this.value);null===a||void 0===a||delete a.metadata,null===(e=this.cloneVM)||void 0===e||delete e.metadata,null===(t=this.cloneVM)||void 0===t||delete t.__clone;const s=JSON.parse(JSON.stringify(this.cloneVM)),i=JSON.parse(JSON.stringify(a));return r()(s,i)?void 0:new Promise(e=>{this.$modal.show("restartDialog"),this.$refs.restartDialog.resolve=e})},updateBeforeSave(){this.isSingle&&(this.value.spec.template.spec.hostname||this.$set(this.value.spec.template.spec,"hostname",this.value.metadata.name));const e=this.getAccessCredentialsValidation();return e.length>0?Promise.reject(e):Promise.resolve()},validateCount(e){e>10&&this.$set(this,"count",10)},updateTemplateId(){this.templateVersionId=""},onTabChanged({tab:e}){var t;"advanced"===e.name&&(null===(t=this.$refs.yamlEditor)||void 0===t||t.refresh())},hasAvailableVersion(e){let t=!1;return this.versions.filter(t=>t.templateId===e).find(e=>{e.isReady&&(t=!0)}),t},generateYaml(){this.parseVM();const e=Object(ge["d"])(this.value);return e}}},_e=Ne,Me=(a("4564"),Object(M["a"])(_e,s,i,!1,null,"9f4d8be6",null));t["default"]=Me.exports},9216:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[e.isView?e._e():t("Banner",{attrs:{color:"info","label-key":"harvester.virtualMachine.volume.dragTip"}}),t("draggable",{attrs:{disabled:e.isView},on:{end:e.update},model:{value:e.rows,callback:function(t){e.rows=t},expression:"rows"}},[t("transition-group",e._l(e.rows,(function(a,s){return t("div",{key:a.id},[t("InfoBox",{staticClass:"box"},[e.isView?e._e():t("button",{staticClass:"role-link btn btn-sm remove",attrs:{type:"button"},on:{click:function(t){return e.removeVolume(a)}}},[t("i",{staticClass:"icon icon-x"})]),a.hotpluggable&&e.isView?t("button",{staticClass:"role-link btn remove",attrs:{type:"button"},on:{click:function(t){return e.unplugVolume(a)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.unplug.detachVolume"))+" ")]):e._e(),t("h3",[a.to&&e.isVirtualType?t("span",{staticClass:"title"},[t("n-link",{attrs:{to:a.to}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.edit"))+" "+e._s(e.headerFor(a.source))+" ")]),a.pvc?t("BadgeStateFormatter",{staticClass:"ml-10 state",attrs:{arbitrary:!0,row:a.pvc,value:a.pvc.state}}):e._e(),e.dev&&a.pvc.resourceExternalLink?t("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.t(a.pvc.resourceExternalLink.tipsKey||"generic.resourceExternalLinkTips"),expression:"t(volume.pvc.resourceExternalLink.tipsKey || 'generic.resourceExternalLinkTips')"}],staticClass:"ml-5 resource-external",attrs:{rel:"nofollow noopener noreferrer",target:"_blank",href:a.pvc.resourceExternalLink.url}},[t("i",{staticClass:"icon icon-external-link"})]):e._e()],1):t("span",[e._v(" "+e._s(e.headerFor(a.source))+" ")])]),t("div",[t(e.componentFor(a.source),{tag:"component",attrs:{rows:e.rows,namespace:e.namespace,"is-create":e.isCreate,"is-edit":e.isEdit,"is-view":e.isView,"is-virtual-type":e.isVirtualType,mode:e.mode,idx:s,"validate-required":e.validateRequired},on:{update:e.update},model:{value:e.rows[s],callback:function(t){e.$set(e.rows,s,t)},expression:"rows[i]"}})],1),t("div",{staticClass:"bootOrder"},[e.isView?e._e():t("div",{staticClass:"mr-15"},[t("button",{staticClass:"btn btn-sm role-primary",attrs:{disabled:0===s},on:{click:function(t){return t.preventDefault(),e.changeSort(s,!1)}}},[t("i",{staticClass:"icon icon-lg icon-chevron-up"})]),t("button",{staticClass:"btn btn-sm role-primary",attrs:{disabled:s===e.rows.length-1},on:{click:function(t){return t.preventDefault(),e.changeSort(s,!0)}}},[t("i",{staticClass:"icon icon-lg icon-chevron-down"})])]),t("div",{staticClass:"text-muted"},[e._v(" bootOrder: "+e._s(s+1)+" ")])]),a.volumeStatus&&!e.isCreate?t("Banner",{staticClass:"mt-15 volume-status",attrs:{color:"warning",label:a.volumeStatus}}):e._e()],1)],1)})),0)],1),e.showVolumeTip?t("Banner",{attrs:{color:"warning",label:e.t("harvester.virtualMachine.volume.volumeTip")}}):e._e(),e.isView?e._e():t("div",[t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button",disabled:0===e.rows.length},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.NEW)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addVolume"))+" ")]),e.existingVolumeDisabled?e._e():t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.ATTACH_VOLUME)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addExistingVolume"))+" ")]),t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.IMAGE)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addVmImage"))+" ")]),t("button",{staticClass:"btn btn-sm bg-primary mb-10",attrs:{type:"button"},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.CONTAINER)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addContainer"))+" ")])]),t("ModalWithCard",{ref:"deleteTip",attrs:{name:"deleteTip",width:400},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.unmount.title"))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("span",[e._v(e._s(e.t("harvester.virtualMachine.volume.unmount.message")))])]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticClass:"buttons"},[t("button",{staticClass:"btn role-secondary mr-20",on:{click:function(t){return t.preventDefault(),e.cancel.apply(null,arguments)}}},[e._v(" "+e._s(e.t("generic.no"))+" ")]),t("button",{staticClass:"btn bg-primary mr-20",on:{click:function(t){return t.preventDefault(),e.deleteVolume.apply(null,arguments)}}},[e._v(" "+e._s(e.t("generic.yes"))+" ")])])]},proxy:!0}])})],1)},i=[],l=a("6e12"),r=a.n(l),o=a("13a9"),n=a("6418"),d=a("7b24"),u=a("4978"),c=a("8e93"),m=a("466b"),p=a("977e"),v=a("907c"),h=a("90cd"),b=a("e24b"),f=a("bddd"),y=a("2cb5"),g=a("7c47"),C=a("da25"),S=a("4aac"),w=a("5000"),k={components:{Banner:n["a"],BadgeStateFormatter:d["a"],draggable:r.a,InfoBox:o["a"],LabeledInput:c["a"],UnitInput:u["a"],LabeledSelect:m["a"],ModalWithCard:p["a"]},props:{vm:{type:Object,default:()=>({})},mode:{type:String,default:C["n"]},value:{type:Array,default:()=>[]},namespace:{type:String,default:null},existingVolumeDisabled:{type:Boolean,default:!1},validateRequired:{type:Boolean,default:!1},customVolumeMode:{type:String,default:"Block"},customAccessMode:{type:String,default:"ReadWriteMany"},resourceType:{type:String,default:""}},async fetch(){await this.$store.dispatch(h["b"]+"/findAll",{type:v["x"]})},data(){return{SOURCE_TYPE:g["d"],rows:Object(b["e"])(this.value),nameIdx:1,vol:null}},computed:{dev(){try{return this.$store.getters["prefs/get"](w["l"])}catch{return this.$store.getters["prefs/get"](w["c"])}},isVirtualType(){return this.resourceType===h["a"].VM},isView(){return this.mode===C["w"]},isEdit(){return this.mode===C["p"]},isCreate(){return this.mode===C["n"]},showVolumeTip(){var e;const t=this.getImageDisplayName(null===(e=this.rows[0])||void 0===e?void 0:e.image);return!(1!==this.rows.length||"cd-rom"!==this.rows[0].type||!/.iso$/i.test(t))},pvcs(){return this.$store.getters[h["b"]+"/all"](v["x"])||[]}},watch:{value:{handler(e){const t=e.map(e=>(this.isCreate||e.source===g["d"].CONTAINER||e.newCreateId||(e.to={name:S["PRODUCT_NAME"]+"-c-cluster-resource-namespace-id",params:{resource:h["a"].VOLUME,namespace:this.namespace,id:e.realName},query:{mode:C["p"]}},e.pvc=this.pvcs.find(t=>t.metadata.name===e.realName)),e));this.$set(this,"rows",t)},deep:!0,immediate:!0}},methods:{addVolume(e){const t=this.generateName(),a={id:Object(y["p"])(5),name:t,source:e,size:"10Gi",type:"disk",accessMode:this.customAccessMode,volumeMode:this.customVolumeMode,volumeName:"",bus:"virtio",newCreateId:Object(y["p"])(10)};if(e===g["d"].NEW){var s;const e=this.$store.getters[h["b"]+"/all"](v["E"]).find(e=>e.isDefault);a.storageClassName=(null===e||void 0===e||null===(s=e.metadata)||void 0===s?void 0:s.name)||"longhorn"}this.rows.push(a),this.update()},generateName(){let e="",t=!0;while(t)e="disk-"+this.nameIdx,t=this.rows.find(t=>t.name===e),this.nameIdx++;return e},removeVolume(e){this.vol=e,!e.newCreateId&&this.isEdit&&this.isVirtualType?this.$refs.deleteTip.open():(Object(f["i"])(this.rows,e),this.update())},unplugVolume(e){this.vm.unplugVolume(e.name)},componentFor(e){switch(e){case g["d"].NEW:return a("0e4c").default;case g["d"].IMAGE:return a("df1c").default;case g["d"].ATTACH_VOLUME:return a("4890").default;case g["d"].CONTAINER:return a("5993").default}},headerFor(e){return{[g["d"].NEW]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.volume"),[g["d"].IMAGE]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.vmImage"),[g["d"].ATTACH_VOLUME]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.existingVolume"),[g["d"].CONTAINER]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.container")}[e]},update(){this.$emit("input",this.rows)},deleteVolume(){Object(f["i"])(this.rows,this.vol),this.update(),this.cancel()},cancel(){this.$refs.deleteTip.hide()},changeSort(e,t){this.rows.splice(t?e:e-1,1,...this.rows.splice(t?e+1:e,1,this.rows[t?e:e-1])),this.update()},getImageDisplayName(e){var t;return null===(t=this.$store.getters[h["b"]+"/all"](h["a"].IMAGE).find(t=>t.id===e))||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.displayName}}},N=k,_=(a("f19e"),a("d802")),M=Object(_["a"])(N,s,i,!1,null,"55a8420f",null);t["a"]=M.exports},"935b":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("CruResource",{attrs:{"done-route":e.doneRoute,mode:e.mode,resource:e.value,subtypes:[],"validation-passed":!0,errors:e.errors},on:{error:t=>e.errors=t,finish:e.save,cancel:e.done}},[t("NameNsDescription",{attrs:{value:e.value,mode:e.mode,"register-before-hook":e.registerBeforeHook,namespaced:!0}}),t("ResourceTabs",{attrs:{mode:e.mode,"side-tabs":!0,"default-tab":e.defaultTab},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("Tab",{attrs:{name:"volumeclaim",label:e.t("persistentVolumeClaim.volumeClaim.label"),weight:4}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("RadioGroup",{attrs:{name:"source",mode:e.immutableMode,label:e.t("persistentVolumeClaim.source.label"),options:e.sourceOptions},on:{input:e.updateDefaults},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}})],1),t("div",{staticClass:"col span-6"},[t("div",{staticClass:"row"},["new"===e.source?t("div",{staticClass:"col span-12"},[e.canListStorageClasses?t("LabeledSelect",{attrs:{options:e.storageClassOptions,label:e.t("persistentVolumeClaim.volumeClaim.storageClass"),mode:e.immutableMode},model:{value:e.value.spec.storageClassName,callback:function(t){e.$set(e.value.spec,"storageClassName",t)},expression:"value.spec.storageClassName"}}):t("LabeledInput",{attrs:{label:e.t("persistentVolumeClaim.volumeClaim.storageClass"),mode:e.immutableMode,tooltip:e.t("persistentVolumeClaim.volumeClaim.tooltips.noStorageClass")},model:{value:e.value.spec.storageClassName,callback:function(t){e.$set(e.value.spec,"storageClassName",t)},expression:"value.spec.storageClassName"}})],1):t("div",{staticClass:"col span-12"},[e.canListPersistentVolumes?t("LabeledSelect",{attrs:{options:e.persistentVolumeOptions,label:e.t("persistentVolumeClaim.volumeClaim.persistentVolume"),selectable:e.isPersistentVolumeSelectable,mode:e.immutableMode,loading:e.isLoadingSecondaryResources},model:{value:e.persistentVolume,callback:function(t){e.persistentVolume=t},expression:"persistentVolume"}}):t("LabeledInput",{attrs:{label:e.t("persistentVolumeClaim.volumeClaim.persistentVolume"),mode:e.immutableMode,tooltip:e.t("persistentVolumeClaim.volumeClaim.tooltips.noPersistentVolume")},model:{value:e.persistentVolume,callback:function(t){e.persistentVolume=t},expression:"persistentVolume"}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12 mt-10"},[t("UnitInput",{ref:"volumeSize",attrs:{label:e.t("persistentVolumeClaim.volumeClaim.requestStorage"),mode:e.storageAmountMode,"input-exponent":3,"output-modifier":!0,increment:1024,min:10,required:!0},model:{value:e.value.spec.resources.requests.storage,callback:function(t){e.$set(e.value.spec.resources.requests,"storage",t)},expression:"value.spec.resources.requests.storage"}}),e.isEdit&&!e.value.expandable?t("Banner",{staticClass:"mt-10",attrs:{color:"info"}},[e._v(" "+e._s(e.t("persistentVolumeClaim.expand.notSupported"))+" ")]):e.isEdit&&!e.value.bound?t("Banner",{staticClass:"mt-10",attrs:{color:"info"}},[e._v(" "+e._s(e.t("persistentVolumeClaim.expand.notBound"))+" ")]):e._e()],1)])])])]),t("Tab",{attrs:{name:"customize",label:e.t("persistentVolumeClaim.customize.label"),weight:3}},[t("div",{staticClass:"access"},[t("h3",[e._v(e._s(e.t("persistentVolumeClaim.accessModes")))]),t("span",{staticClass:"text-error"},[e._v("*")])]),t("div",[t("Checkbox",{attrs:{label:e.t("persistentVolumeClaim.customize.accessModes.readWriteOnce"),mode:e.immutableMode},model:{value:e.readWriteOnce,callback:function(t){e.readWriteOnce=t},expression:"readWriteOnce"}})],1),t("div",[t("Checkbox",{attrs:{label:e.t("persistentVolumeClaim.customize.accessModes.readOnlyMany"),mode:e.immutableMode},model:{value:e.readOnlyMany,callback:function(t){e.readOnlyMany=t},expression:"readOnlyMany"}})],1),t("div",[t("Checkbox",{attrs:{label:e.t("persistentVolumeClaim.customize.accessModes.readWriteMany"),mode:e.immutableMode},model:{value:e.readWriteMany,callback:function(t){e.readWriteMany=t},expression:"readWriteMany"}})],1)]),e.isView?t("Tab",{attrs:{name:"status",label:e.t("persistentVolumeClaim.status.label"),weight:2}},[t("StatusTable",{attrs:{resource:e.value}})],1):e._e(),t("Tab",{attrs:{name:"labels-and-annotations","label-key":"generic.labelsAndAnnotations",weight:-1}},[t("Labels",{attrs:{"default-container-class":"labels-and-annotations-container",value:e.value,mode:e.mode,"display-side-by-side":!1}})],1)],1)],1)},i=[],l=a("0df0"),r=a("305c"),o=a("fd5f"),n=a("3c8c"),d=a("38de"),u=a("e143"),c=a("e26b"),m=a("466b"),p=a("4978"),v=a("8cb9"),h=a.n(v),b=a("da25"),f=a("907c"),y=a("f520"),g=a("c422"),C=a("4442"),S=a("6418"),w=a("2bfc"),k=a("873f");const N="10Gi";var _={name:"PersistentVolumeClaim",components:{Banner:S["a"],Checkbox:l["a"],CruResource:o["a"],LabeledInput:c["a"],LabeledSelect:m["a"],Labels:C["a"],NameNsDescription:n["a"],RadioGroup:u["a"],ResourceTabs:g["a"],StatusTable:y["a"],Tab:d["a"],UnitInput:p["a"]},mixins:[r["a"],w["a"]],async fetch(){const e={type:"disk"};this.value.metadata.annotations[k["a"].VOLUME_VM]=JSON.stringify(e);const t=await this.$store.dispatch("cluster/findAll",{type:f["E"]});this.$store.getters["cluster/canList"](f["w"])&&this.resourceManagerFetchSecondaryResources(this.secondaryResourceData),this.storageClassOptions=t.map(e=>e.name).sort(),this.storageClassOptions.unshift(this.t("persistentVolumeClaim.useDefault")),this.$set(this.value.spec,"storageClassName",this.value.spec.storageClassName||this.storageClassOptions[0])},data(){const e=this.$store.getters["cluster/canList"](f["w"]),t=this.$store.getters["cluster/canList"](f["E"]),a=[{label:this.t("persistentVolumeClaim.source.options.new"),value:"new"},{label:this.t("persistentVolumeClaim.source.options.existing"),value:"existing"}],s=["ReadWriteOnce"];this.$set(this.value,"spec",this.value.spec||{}),this.$set(this.value.spec,"resources",this.value.spec.resources||{}),this.$set(this.value.spec.resources,"requests",this.value.spec.resources.requests||{}),this.$set(this.value.spec.resources.requests,"storage",this.value.spec.resources.requests.storage||N),this.realMode===b["n"]&&this.$set(this.value.spec,"accessModes",s);const i=this.$route.query[b["c"]]||null;return{secondaryResourceData:this.secondaryResourceDataConfig(),sourceOptions:a,source:this.value.spec.volumeName?a[1].value:a[0].value,immutableMode:this.realMode===b["n"]?b["n"]:b["w"],persistentVolumeOptions:[],persistentVolumes:[],storageClassOptions:[],defaultTab:i,canListPersistentVolumes:e,canListStorageClasses:t}},computed:{readWriteOnce:{get(){return this.value.spec.accessModes.includes("ReadWriteOnce")},set(e){this.checkboxSetter("ReadWriteOnce",e)}},readOnlyMany:{get(){return this.value.spec.accessModes.includes("ReadOnlyMany")},set(e){this.checkboxSetter("ReadOnlyMany",e)}},readWriteMany:{get(){return this.value.spec.accessModes.includes("ReadWriteMany")},set(e){this.checkboxSetter("ReadWriteMany",e)}},persistentVolume:{get(){return this.value.spec.volumeName},set(e){const t=this.persistentVolumes.find(t=>t.metadata.name===e);var a,s,i;(this.$set(this.value.spec,"storageClassName",""),t)&&(this.$set(this.value.spec.resources.requests,"storage",null===(a=t.spec.capacity)||void 0===a?void 0:a.storage),null!==(s=t.spec)&&void 0!==s&&s.storageClassName&&this.$set(this.value.spec,"storageClassName",null===(i=t.spec)||void 0===i?void 0:i.storageClassName));this.$set(this.value.spec,"volumeName",e)}},storageAmountMode(){return this.isCreate?b["n"]:this.isEdit&&this.value.expandable&&this.value.bound?b["p"]:b["w"]}},created(){this.registerBeforeHook(this.willSave,"willSave")},mounted(){var e;const t=null===(e=this.$refs.volumeSize)||void 0===e?void 0:e.focus;"volumeclaim"===this.defaultTab&&t&&setTimeout(()=>t())},methods:{secondaryResourceDataConfig(){var e;return{namespace:(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.namespace)||null,data:{[f["w"]]:{applyTo:[{var:"persistentVolumes"},{var:"persistentVolumeOptions",parsingFunc:e=>e.map(e=>{const t="Available"===e.status.phase?"":` (${e.status.phase})`;return{label:`${e.metadata.name}${t}`,value:e.metadata.name}}).sort((e,t)=>e.label.localeCompare(t.label))}]}}}},checkboxSetter(e,t){if(t)this.value.spec.accessModes.push(e),this.$set(this.value,"accessModes",h()(this.value.spec.accessModes));else{const t=this.value.spec.accessModes.indexOf(e);t>=0&&this.value.spec.accessModes.splice(t,1)}},isPersistentVolumeSelectable(e){const t=this.persistentVolumes.find(t=>t.metadata.name===e.value);return"Available"===t.status.phase},updateDefaults(e){"new"===e&&this.$set(this.value.spec.resources.requests,"storage",N),this.$set(this,"persistentVolume",null)},willSave(){this.value.spec.storageClassName===this.t("persistentVolumeClaim.useDefault")&&this.$delete(this.value.spec,"storageClassName")}}},M=_,O=(a("fa89"),a("d802")),I=Object(O["a"])(M,s,i,!1,null,"1d65dfc6",null);t["default"]=I.exports},"9a01":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("ResourceTable",{attrs:{headers:e.headers,schema:e.schema,rows:e.rows},scopedSlots:e._u([{key:"group-by",fn:function({group:a}){return[t("div",{directives:[{name:"trim-whitespace",rawName:"v-trim-whitespace"}],ref:a.key,staticClass:"group-tab"},[t("span",{domProps:{innerHTML:e._s(a.key)}})])]}},{key:"cell:claimed",fn:function({row:a}){return[a.isEnabled?t("span",[e._v(e._s(a.claimedBy))]):t("span",{staticClass:"text-muted"},[e._v("—")])]}}])})},i=[],l=a("126f"),r=a("90cd"),o=a("462f"),n={name:"ListPciDevices",components:{ResourceTable:l["a"]},props:{schema:{type:Object,required:!0},rows:{type:Array,required:!0},allgpu:{type:Array,required:!0},node:{type:Array,required:!0}},async fetch(){await this.$store.dispatch(r["b"]+"/findAll",{type:r["a"].PCI_CLAIM})},data(){const e=this.$store.getters["isSingleProduct"],t=[{...o["J"]},o["H"],{name:"description",labelKey:"tableHeaders.description",value:"id",formatter:"GpuDescription",sort:["status.description"]},{name:"node",labelKey:"tableHeaders.node",value:"status.nodeName",sort:["status.nodeName"]}];return e||t.push({name:"claimed",label:"Claimed By",value:"passthroughClaim.userName",sort:["passthroughClaim.userName"]}),{headers:t}},methods:{enableGroup(e=[]){const t=e[0].status.iommuGroup,a=this.filterByGroup(t),s=a[0];s&&s.enablePassthroughBulk(a)},disableGroup(e=[]){const t=e[0].status.iommuGroup,a=this.filterByGroup(t);a.forEach(e=>{e.passthroughClaim&&e.disablePassthrough()})},groupIsAllEnabled(e=[]){return!e.find(e=>!e.passthroughClaim)},filterByGroup(e){const t=[];this.node.forEach(e=>{"true"===e.metadata.labels["gpu.infortrend.com/vm-gpu-mode"]&&t.push(e.metadata.name)});const a=this.allgpu.filter(a=>"10de"===a.status.vendorId&&t.includes(a.status.nodeName)&&a.status.iommuGroup===e)||[];return a}}},d=n,u=a("d802"),c=Object(u["a"])(d,s,i,!1,null,null,null);t["a"]=c.exports},"9c1e":function(e,t,a){"use strict";a("b232")},"9dda":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-7d491695] .resource-yaml{flex:1;display:flex;flex-direction:column}[data-v-7d491695] .resource-yaml .yaml-editor{flex:1;min-height:200px}[data-v-7d491695] .resource-yaml .yaml-editor .code-mirror .CodeMirror{min-height:200px}",""]),e.exports=t},ac8d:function(e,t,a){var s=a("d73d");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("79e8c144",s,!0,{sourceMap:!1,shadowMode:!1})},aeeb:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-5f271ac4] .labeled-select .v-select:not(.vs--single) .vs__selected-options{flex-basis:auto;flex-wrap:wrap;width:100%}[data-v-5f271ac4] .labeled-select .v-select:not(.vs--single) .vs__selected{white-space:nowrap}",""]),e.exports=t},af36:function(e,t,a){"use strict";a("76d0")},b134:function(e,t,a){"use strict";a("4cdd")},b232:function(e,t,a){var s=a("3705");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("64204601",s,!0,{sourceMap:!1,shadowMode:!1})},b61d:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("CruResource",{attrs:{"done-route":e.doneRoute,resource:e.value,mode:e.mode,errors:e.errors,"can-yaml":!!e.showEditAsYaml,"apply-hooks":e.applyHooks},on:{finish:e.saveImage}},[t("NameNsDescription",{ref:"nd",attrs:{mode:e.mode,label:e.t("generic.name"),"name-key":"spec.displayName"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),t("Tabbed",e._b({staticClass:"mt-15",attrs:{"side-tabs":!0}},"Tabbed",e.$attrs,!1),[t("Tab",{staticClass:"bordered-table",attrs:{name:"basic",label:e.t("harvester.image.tabs.basics"),weight:99}},[e.isCreate?t("RadioGroup",{attrs:{name:"model",options:["download","upload"],labels:[e.t("harvester.image.sourceType.download"),e.t("harvester.image.sourceType.upload")],mode:e.mode},model:{value:e.value.spec.sourceType,callback:function(t){e.$set(e.value.spec,"sourceType",t)},expression:"value.spec.sourceType"}}):e._e(),t("div",{staticClass:"row mb-20 mt-20"},[t("div",{staticClass:"col span-12"},[e.isCreate?e._e():t("LabeledInput",{staticClass:"mb-20",attrs:{mode:e.mode,disabled:e.isEdit,"label-key":"harvester.image.source"},model:{value:e.value.spec.sourceType,callback:function(t){e.$set(e.value.spec,"sourceType",t)},expression:"value.spec.sourceType"}}),"download"===e.value.spec.sourceType?t("LabeledInput",{staticClass:"labeled-input--tooltip",attrs:{mode:e.mode,disabled:e.isEdit,required:"","label-key":"harvester.image.url",tooltip:e.t("harvester.image.urlTip",{},!0)},model:{value:e.value.spec.url,callback:function(t){e.$set(e.value.spec,"url",t)},expression:"value.spec.url"}}):t("div",[e.isView?t("LabeledInput",{staticClass:"mt-20",attrs:{mode:e.mode,"label-key":"harvester.image.fileName"},model:{value:e.imageName,callback:function(t){e.imageName=t},expression:"imageName"}}):e._e(),e.isCreate?t("button",{staticClass:"btn role-primary",attrs:{type:"button"},on:{click:e.selectFile}},[t("span",[e._v(" "+e._s(e.t("harvester.image.uploadFile"))+" ")]),t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file",attrs:{id:"file",type:"file",accept:".qcow, .qcow2, .raw, .img, .iso"},on:{change:function(t){return e.handleFileUpload()}}})]):e._e(),e.uploadFileName?t("div",{staticClass:"fileName mt-5"},[t("span",{staticClass:"icon icon-file"}),e._v(" "+e._s(e.uploadFileName)+" ")]):e._e()],1)],1)])],1),t("Tab",{staticClass:"bordered-table",attrs:{name:"labels",label:e.t("labels.labels.title"),weight:2}},[t("KeyValue",{key:"labels",ref:"labels",attrs:{value:e.value.labels,"add-label":e.t("labels.addLabel"),mode:e.mode,"pad-left":!1,"read-allowed":!1},on:{focusKey:e.focusKey,input:function(t){return e.value.setLabels(t)}},scopedSlots:e._u([{key:"key",fn:function({row:a,keyName:s,queueUpdate:i}){return[t("input",{directives:[{name:"model",rawName:"v-model",value:a[s],expression:"row[keyName]"}],ref:"key",attrs:{placeholder:e.t("keyValue.keyPlaceholder")},domProps:{value:a[s]},on:{input:[function(t){t.target.composing||e.$set(a,s,t.target.value)},i]}})]}},{key:"value",fn:function({row:a,keyName:s,valueName:i,queueUpdate:l}){return[e.internalAnnotations(a)?t("Select",{attrs:{searchable:!0,clearable:!1,options:e.calculateOptions(a[s])},on:{input:l},model:{value:a[i],callback:function(t){e.$set(a,i,t)},expression:"row[valueName]"}}):t("input",{directives:[{name:"model",rawName:"v-model",value:a[i],expression:"row[valueName]"}],attrs:{disabled:e.isView,placeholder:e.t("keyValue.valuePlaceholder"),autocorrect:"off",autocapitalize:"off",spellcheck:"false",type:"text"},domProps:{value:a[i]},on:{input:[function(t){t.target.composing||e.$set(a,i,t.target.value)},l]}})]}}])})],1)],1)],1)},i=[],l=a("fd5f"),r=a("0cb2"),o=a("38de"),n=a("8e93"),d=a("a232"),u=a("3c8c"),c=a("e143"),m=a("47ab"),p=a("305c"),v=a("6834"),h=a("afa6"),b=a("873f"),f=a("3e9d"),y=a("a8b9"),g=a("907c"),C=a("90cd");const S="download",w="upload",k="raw_qcow2";var N={name:"EditImage",components:{Tab:o["a"],Tabbed:r["a"],KeyValue:d["a"],Select:m["a"],CruResource:l["a"],LabeledInput:n["a"],NameNsDescription:u["a"],RadioGroup:c["a"]},mixins:[p["a"]],props:{value:{type:Object,required:!0}},async fetch(){var e,t;await Object(y["a"])({images:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].IMAGE}),storageClasses:this.$store.dispatch(C["b"]+"/findAll",{type:g["E"]})}),null!==this&&void 0!==this&&null!==(e=this.value)&&void 0!==e&&null!==(e=e.metadata)&&void 0!==e&&null!==(e=e.annotations)&&void 0!==e&&e[b["a"].KOPF_LAST_HANDLED]&&delete this.value.metadata.annotations[b["a"].KOPF_LAST_HANDLED];const a=this.$store.getters[C["b"]+"/all"](g["E"]).find(e=>e.isDefault);this.$set(this,"storageClassName",this.storageClassName||(null===a||void 0===a||null===(t=a.metadata)||void 0===t?void 0:t.name)||"nfs-csi")},data(){return this.value.spec||this.$set(this.value,"spec",{sourceType:S}),this.value.metadata.name||(this.value.metadata.generateName="image-"),{url:this.value.spec.url,files:[],resource:"",headers:{},fileUrl:"",file:""}},computed:{uploadFileName(){var e;return(null===(e=this.file)||void 0===e?void 0:e.name)||""},imageName(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[b["a"].IMAGE_NAME])||"-"},isCreateEdit(){return this.isCreate||this.isEdit},showEditAsYaml(){return this.value.spec.sourceType===S},storageClassOptions(){const e=this.$store.getters[C["b"]+"/all"](g["E"]),t=e.filter(e=>{var t;return!(null!==(t=e.parameters)&&void 0!==t&&t.backingImage)}).map(e=>{const t=e.isDefault?`${e.name} (${this.t("generic.default")})`:e.name;return{label:t,value:e.name}})||[];return t},storageClassName:{get(){return this.value.metadata.annotations[b["a"].STORAGE_CLASS]},set(e){this.value.metadata.annotations[b["a"].STORAGE_CLASS]=e}}},watch:{"value.spec.url"(e){const t=e.trim();this.setImageLabels(t)},"value.spec.sourceType"(){var e;this.$set(this,"file",null),this.url="",null!==(e=this.$refs)&&void 0!==e&&null!==(e=e.file)&&void 0!==e&&e.value&&(this.$refs.file.value=null)}},methods:{async saveImage(e){if(this.value.spec.displayName=(this.value.spec.displayName||"").trim(),this.value.spec.sourceType===w&&this.isCreate)try{this.value.spec.url="";const t=this.file;this.value.metadata.annotations[b["a"].IMAGE_NAME]=null===t||void 0===t?void 0:t.name;const a=await this.value.save();a.uploadImage(t),e(!0),this.done()}catch(t){this.errors=Object(f["b"])(t),e(!1)}else this.save(e)},setImageLabels(e){var t,a;const s=(null===e||void 0===e||null===(t=e.split("/"))||void 0===t?void 0:t.pop())||e,i=null===s||void 0===s||null===(a=s.split("."))||void 0===a||null===(a=a.pop())||void 0===a?void 0:a.toLowerCase();if(h["a"].includes(i)){const e="iso"===i?i:k;this.addLabel(b["a"].IMAGE_SUFFIX,e),this.value.spec.displayName||this.$refs.nd.changeNameAndNamespace({text:s,selected:this.value.metadata.namespace})}const l=this.getOSType(e);l&&this.addLabel(b["a"].OS_TYPE,l.value)},addLabel(e,t){const a=this.$refs.labels.rows;a.map((t,a)=>{t.key===e&&this.$refs.labels.remove(a)}),this.$refs.labels.add(e,t)},handleFileUpload(){const e=this.$refs.file.files[0];this.file=e,this.setImageLabels(null===e||void 0===e?void 0:e.name),this.value.spec.displayName||this.$refs.nd.changeNameAndNamespace({text:null===e||void 0===e?void 0:e.name,selected:this.value.metadata.namespace}),this.setImageLabels()},selectFile(){this.$refs.file.value=null,this.$refs.file.click()},internalAnnotations(e){const t=[b["a"].OS_TYPE,b["a"].IMAGE_SUFFIX];return t.find(t=>t===e.key)},calculateOptions(e){return e===b["a"].OS_TYPE?v["b"]:e===b["a"].IMAGE_SUFFIX?[{label:"ISO",value:"iso"},{label:"raw/qcow2",value:k}]:[]},focusKey(){this.$refs.key.focus()},getOSType(e){if(e)return v["b"].find(t=>t.match?!!t.match.find(t=>e.toLowerCase().includes(t))&&t.value:!!e.toLowerCase().includes(t.value.toLowerCase())&&t.value)}}},_=N,M=(a("7a52"),a("d802")),O=Object(M["a"])(_,s,i,!1,null,"b112e3c2",null);t["default"]=O.exports},b930:function(e,t,a){"use strict";a("c950")},ba19:function(e,t,a){"use strict";a("4cf0")},bb35:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("CruResource",{attrs:{"done-route":e.doneRoute,resource:e.value,mode:e.mode,errors:e.errors,"apply-hooks":e.applyHooks},on:{finish:e.save}},[t("div",{staticClass:"header mb-20"},[e.isCreate?t("FileSelector",{staticClass:"btn btn-sm bg-primary mt-10",attrs:{label:e.t("generic.readFromFile"),accept:".pub"},on:{selected:e.onKeySelected}}):e._e()],1),t("NameNsDescription",{key:e.randomString,ref:"nd",attrs:{mode:e.mode},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),t("Tabbed",e._b({staticClass:"mt-15",attrs:{"side-tabs":!0}},"Tabbed",e.$attrs,!1),[t("Tab",{staticClass:"bordered-table",attrs:{name:"basic",label:e.t("harvester.sshKey.tabs.basics"),weight:1}},[t("LabeledInput",{attrs:{type:"multiline",mode:e.mode,"min-height":160,label:e.t("harvester.sshKey.keypair"),required:""},model:{value:e.publicKey,callback:function(t){e.publicKey=t},expression:"publicKey"}})],1)],1)],1)},i=[],l=a("0cb2"),r=a("38de"),o=a("fd5f"),n=a("8e93"),d=a("3c8c"),u=a("8b2c"),c=a("2cb5"),m=a("305c"),p={name:"HarvesterEditKeypair",components:{Tab:r["a"],Tabbed:l["a"],CruResource:o["a"],LabeledInput:n["a"],FileSelector:u["b"],NameNsDescription:d["a"]},mixins:[m["a"]],props:{value:{type:Object,required:!0}},data(){return this.value.spec||(this.value.spec={},this.value.metadata={name:""}),{publicKey:this.value.spec.publicKey||"",randomString:""}},watch:{publicKey(e){this.value.spec.publicKey=e;const t=e.split(/\s+/);3===t.length&&t[2].includes("@")&&!this.value.metadata.name&&(this.value.metadata.name=t[2].split("@")[0],this.randomString=Object(c["p"])(10).toLowerCase())}},methods:{onKeySelected:Object(u["a"])("publicKey")}},v=p,h=(a("2d15"),a("d802")),b=Object(h["a"])(v,s,i,!1,null,"0f630528",null);t["default"]=b.exports},bc46:function(e,t,a){var s=a("d115");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("5f6e687f",s,!0,{sourceMap:!1,shadowMode:!1})},c3cb:function(e,t,a){var s=a("6b14");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("2c1d5d1c",s,!0,{sourceMap:!1,shadowMode:!1})},c504:function(e,t,a){var s=a("e953");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("fd5ec5e6",s,!0,{sourceMap:!1,shadowMode:!1})},c545:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".box[data-v-55a8420f]{position:relative}.title[data-v-55a8420f]{display:flex}.title .state[data-v-55a8420f]{font-size:16px}.remove[data-v-55a8420f]{position:absolute;top:10px;right:10px;padding:0}.bootOrder[data-v-55a8420f]{display:flex;align-items:center}.buttons[data-v-55a8420f]{width:100%;display:flex;justify-content:flex-end}.volume-status[data-v-55a8420f]:first-letter{text-transform:uppercase}.resource-external[data-v-55a8420f]{display:flex;justify-content:center;align-items:center}",""]),e.exports=t},c950:function(e,t,a){var s=a("6439");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("2b720710",s,!0,{sourceMap:!1,shadowMode:!1})},ccae:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("CruResource",{attrs:{"done-route":e.doneRoute,resource:e.value,mode:e.mode,errors:e.errors,"apply-hooks":e.applyHooks},on:{finish:e.saveNetwork}},[t("NameNsDescription",{ref:"nd",attrs:{mode:e.mode},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),t("Tabbed",e._b({staticClass:"mt-15",attrs:{"side-tabs":!0}},"Tabbed",e.$attrs,!1),[t("Tab",{staticClass:"bordered-table",attrs:{name:"basics",label:e.t("harvester.network.tabs.basics"),weight:99}},[t("LabeledSelect",{staticClass:"mb-20",attrs:{options:e.networkType,mode:e.mode,label:e.t("harvester.fields.type"),required:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1)],1)],1)},i=[],l=a("0cb2"),r=a("38de"),o=a("fd5f"),n=a("3c8c"),d=a("466b"),u=a("873f"),c=a("305c"),m=a("90cd"),p=a("4aac");const v="auto",h="manual";var b={components:{Tab:r["a"],Tabbed:l["a"],CruResource:o["a"],NameNsDescription:n["a"],LabeledSelect:d["a"]},mixins:[c["a"]],props:{value:{type:Object,required:!0}},data(){var e;const t=JSON.parse(this.value.spec.config);(t.bridge||"").endsWith("-br")&&(t.bridge=t.bridge.slice(0,-3));const a="macvtap";return t.type=a,null!==this&&void 0!==this&&null!==(e=this.value)&&void 0!==e&&null!==(e=e.metadata)&&void 0!==e&&null!==(e=e.annotations)&&void 0!==e&&e[u["a"].KOPF_LAST_HANDLED]&&delete this.value.metadata.annotations[u["a"].KOPF_LAST_HANDLED],{config:t,type:a,resourceName:"macvtap.network.kubevirt.io/dataplane"}},created(){this.value.setAnnotation(u["a"].NETWORK_ROUTE,this.resourceName),this.registerBeforeHook&&this.registerBeforeHook(this.updateBeforeSave)},computed:{modeOptions(){return[{label:this.t("harvester.network.layer3Network.mode.auto"),value:v},{label:this.t("harvester.network.layer3Network.mode.manual"),value:h}]},clusterNetworkOptions(){const e=p["PRODUCT_NAME"],t=this.$store.getters[e+"/all"](m["a"].CLUSTER_NETWORK)||[];return t.map(e=>{const t=!e.isReady;return{label:t?`${e.id} (${this.t("generic.notReady")})`:e.id,value:e.id,disabled:t}})},networkType(){return["macvtap"]},isUntaggedNetwork(){return this.isView?"UntaggedNetwork"===this.value.vlanType:"UntaggedNetwork"===this.type}},methods:{async saveNetwork(e){const t=[];if(t.length>0)return e(!1),this.errors=t,!1;await this.save(e)},input(e){const t=/^([1-9]|[1-9][0-9]{1,2}|[1-3][0-9]{3}|40[0-9][0-4])$/;t.test(e)||""===e||(this.config.vlan=e>4094?4094:1)},updateBeforeSave(){this.config.name=this.value.metadata.name,this.isUntaggedNetwork&&delete this.config.vlan,this.value.spec.config=JSON.stringify({...this.config})}}},f=b,y=a("d802"),g=Object(y["a"])(f,s,i,!1,null,null,null);t["default"]=g.exports},d115:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"#restore[data-v-71440138]{flex-grow:1;flex-direction:column}#restore[data-v-71440138],#restore[data-v-71440138] .radio-group{display:flex}#restore[data-v-71440138] .radio-group .radio-container{margin-right:30px}#restore .content[data-v-71440138]{flex-grow:1}#restore .footer[data-v-71440138]{border-top:var(--header-border-size) solid var(--header-border);margin-left:-20px;margin-right:-20px;margin-bottom:-20px;padding:10px 20px}#restore .footer[data-v-71440138] .spacer-small{padding:0}",""]),e.exports=t},d227:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".vm__credentials-users .hasUsers.labeled-select.edit.taggable .labeled-tooltip .icon.status-icon{top:30px}",""]),e.exports=t},d73d:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".yaml[data-v-6a2ca441]{height:350px;overflow:auto}[data-v-6a2ca441] .resource-yaml{flex:1;display:flex;flex-direction:column}[data-v-6a2ca441] .resource-yaml .yaml-editor{flex:1;min-height:350px}[data-v-6a2ca441] .resource-yaml .yaml-editor .code-mirror .CodeMirror{min-height:350px}",""]),e.exports=t},db40:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"columns row"},[t("div",{staticClass:"col span-6"},[t("AccessCredentialsUsers",{attrs:{resource:e.resource,"user-options":e.userOptions,mode:e.mode,multiple:!0},on:{"update:user":e.updateUser,"update:newUser":e.updateNewUser},model:{value:e.value.users,callback:function(t){e.$set(e.value,"users",t)},expression:"value.users"}})],1),t("div",{staticClass:"col span-6"},[t("SSHKey",{staticClass:"mb-20",attrs:{namespace:e.resource.metadata.namespace,mode:e.mode,searchable:!1},on:{"update:sshKey":e.updateSSH},model:{value:e.value.sshkeys,callback:function(t){e.$set(e.value,"sshkeys",t)},expression:"value.sshkeys"}})],1)])])},i=[],l=a("2a79"),r=a("411b"),o={name:"HarvesterEditVolume",components:{SSHKey:l["a"],AccessCredentialsUsers:r["a"]},props:{mode:{type:String,default:"create"},resource:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},methods:{update(){this.$emit("update")},updateUser(e){this.$set(this.value,"users",e),this.update()},updateSSH(e){this.$set(this.value,"sshkeys",e),this.update()},updateNewUser(e){this.$emit("update:newUser",e)}}},n=o,d=a("d802"),u=Object(d["a"])(n,s,i,!1,null,null,null);t["default"]=u.exports},df1c:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),required:"",mode:e.mode},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),options:e.VOLUME_TYPE,mode:e.mode},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-image"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.image"),value:e.imageName,mode:e.mode}},[t("LabeledSelect",{attrs:{disabled:0===e.idx&&!e.isCreate&&!e.value.newCreateId&&e.isVirtualType,label:e.t("harvester.fields.image"),options:e.imagesOption,mode:e.mode,searchable:!0,required:e.validateRequired},on:{input:e.onImageChange},model:{value:e.value.image,callback:function(t){e.$set(e.value,"image",t)},expression:"value.image"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-size"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.size"),value:e.value.size,mode:e.mode}},[t("UnitInput",{attrs:{"output-modifier":!0,increment:1024,"input-exponent":3,label:e.t("harvester.fields.size"),mode:e.mode,min:10,required:e.validateRequired,suffix:"GiB"},on:{input:e.update},model:{value:e.value.size,callback:function(t){e.$set(e.value,"size",t)},expression:"value.size"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-3",attrs:{"data-testid":"input-hevi-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),mode:e.mode,options:e.InterfaceOption},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])])},i=[],l=a("bddd"),r=a("4978"),o=a("8e93"),n=a("466b"),d=a("5361"),u=a("907c"),c=a("90cd"),m=a("d37d"),p=a("7c47"),v={name:"HarvesterEditVMImage",components:{UnitInput:r["a"],LabeledInput:o["a"],LabeledSelect:n["a"],InputOrDisplay:d["a"]},props:{value:{type:Object,default:()=>({})},namespace:{type:String,default:null},mode:{type:String,default:"create"},idx:{type:Number,required:!0},isCreate:{type:Boolean,default:!0},isEdit:{type:Boolean,default:!1},validateRequired:{type:Boolean,required:!0},isVirtualType:{type:Boolean,default:!0}},data(){return{VOLUME_TYPE:p["e"],InterfaceOption:p["b"],loading:!1,images:[]}},fetch(){this.images=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE)},computed:{imagesOption(){return this.images.filter(e=>e.isReady).sort((e,t)=>e.creationTimestamp>t.creationTimestamp?-1:1).map(e=>({label:`${e.metadata.namespace}/${e.spec.displayName}`,value:e.id}))},imageName(){const e=this.imagesOption.find(e=>e.value===this.value.image);return e?e.label:"-"},pvcsResource(){const e=this.$store.getters[c["b"]+"/all"](u["x"])||[];return e.find(e=>!this.namespace||e.id===`${this.namespace}/${this.value.volumeName}`)}},watch:{"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())},"value.image"(e){this.checkImageExists(e)},imagesOption(){this.checkImageExists(this.value.image)},pvcsResource:{handler(e){var t;if(null!==e&&void 0!==e&&null!==(t=e.spec)&&void 0!==t&&null!==(t=t.resources)&&void 0!==t&&null!==(t=t.requests)&&void 0!==t&&t.storage&&this.isVirtualType){const t=Object(m["d"])(e.spec.resources.requests.storage),a=Object(m["c"])(t,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3});this.value.size=a+"Gi"}},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")},onImageChange(){var e;const t=null===(e=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE))||void 0===e?void 0:e.find(e=>this.value.image===e.id);0===this.idx&&(/iso$/i.test(null===t||void 0===t?void 0:t.imageSuffix)?(this.$set(this.value,"type","cd-rom"),this.$set(this.value,"bus","sata")):(this.$set(this.value,"type","disk"),this.$set(this.value,"bus","virtio"))),this.update()},onOpen(){this.images=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE)},checkImageExists(e){e&&this.imagesOption.length>0&&!Object(l["e"])(this.imagesOption,"value",e)&&(this.$store.dispatch("growl/error",{title:this.$store.getters["i18n/t"]("harvester.vmTemplate.tips.notExistImage.title",{name:e}),message:this.$store.getters["i18n/t"]("harvester.vmTemplate.tips.notExistImage.message")},{root:!0}),this.$set(this.value,"image",""))}}},h=v,b=a("d802"),f=Object(b["a"])(h,s,i,!1,null,null,null);t["default"]=f.exports},e299:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"row",on:{input:e.update}},[t("div",{staticClass:"col span-6"},[t("AccessCredentialsUsers",{attrs:{resource:e.resource,"user-options":e.userOptions,multiple:!1,mode:e.mode},on:{"update:user":e.updateUser,"update:newUser":e.updateNewUser},model:{value:e.value.username,callback:function(t){e.$set(e.value,"username",t)},expression:"value.username"}})],1),t("div",{staticClass:"col span-6"},[t("Password",{ref:"password",attrs:{mode:e.mode,disabled:"edit"!==e.mode,label:e.t("harvester.virtualMachine.input.password"),required:""},model:{value:e.value.newPassword,callback:function(t){e.$set(e.value,"newPassword",t)},expression:"value.newPassword"}})],1)])},i=[],l=a("6b77"),r=a("411b"),o={name:"HarvesterEditVolume",components:{Password:l["a"],AccessCredentialsUsers:r["a"]},props:{mode:{type:String,default:"create"},resource:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},data(){return{defaultPwdValue:{username:"",newPassword:""}}},methods:{update(){this.$emit("update")},updateUser(e){this.$set(this.value,"username",e),this.update()},updateNewUser(e){this.$emit("update:newUser",e)}}},n=o,d=(a("27e7"),a("d802")),u=Object(d["a"])(n,s,i,!1,null,"4ed320b6",null);t["default"]=u.exports},e953:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"#vm[data-v-9f4d8be6] .vm-radio-group .radio-group{display:flex}#vm[data-v-9f4d8be6] .vm-radio-group .radio-group .radio-container{margin-right:30px}#vm .restart[data-v-9f4d8be6]{display:flex;justify-content:flex-end}#vm .banner-right[data-v-9f4d8be6]{width:auto;display:flex;justify-items:center}",""]),e.exports=t},e961:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"restore"}},[t("div",{staticClass:"content"},[t("div",{staticClass:"mb-20"},[t("RadioGroup",{attrs:{name:"model",options:[!0,!1],labels:[e.t("harvester.backup.restore.createNew"),e.t("harvester.backup.restore.replaceExisting")],disabled:e.disableExisting,mode:e.mode},model:{value:e.restoreNewVm,callback:function(t){e.restoreNewVm=t},expression:"restoreNewVm"}})],1),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{disabled:!0,label:e.t("nameNsDescription.namespace.label"),options:e.namespaces},model:{value:e.namespace,callback:function(t){e.namespace=t},expression:"namespace"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{staticClass:"mb-20",attrs:{disabled:!e.restoreNewVm,label:e.t("harvester.backup.restore.virtualMachineName"),placeholder:e.t("nameNsDescription.name.placeholder")},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1)]),t("LabeledSelect",{staticClass:"mb-20",attrs:{label:e.t("harvester.vmSnapshot.snapshot"),options:e.snapshotOption},model:{value:e.snapshotName,callback:function(t){e.snapshotName=t},expression:"snapshotName"}}),e.restoreNewVm?e._e():t("LabeledSelect",{attrs:{label:e.t("harvester.backup.restore.deletePreviousVolumes"),options:e.deletionPolicyOption},model:{value:e.deletionPolicy,callback:function(t){e.deletionPolicy=t},expression:"deletionPolicy"}})],1),t("Footer",{staticClass:"footer",attrs:{mode:"create",errors:e.errors},on:{save:e.saveRestore,done:e.done}})],1)},i=[],l=a("62905"),r=a("e143"),o=a("8e93"),n=a("466b"),d=a("305c"),u=a("a8b9"),c=a("3e9d"),m=a("907c"),p=a("90cd"),v=a("1d19"),h=a("e24b");const b={apiVersion:"snapshot.kubevirt.io/v1alpha1",kind:"VirtualMachineRestore",metadata:{name:"",namespace:""},type:p["a"].RESTORE,spec:{target:{apiGroup:"kubevirt.io",kind:"VirtualMachine",name:""},virtualMachineSnapshotName:"",newVM:!0,deletionPolicy:"retain"}};var f={name:"CreateRestore",components:{Footer:l["a"],RadioGroup:r["a"],LabeledInput:o["a"],LabeledSelect:n["a"]},mixins:[d["a"]],async fetch(){await Object(u["a"])({backups:this.$store.dispatch("cluster/findAll",{type:p["a"].VM_SNAPSHOT}),vms:this.$store.dispatch(p["b"]+"/findAll",{type:p["a"].VM})})},data(){var e,t;const a=null===(e=this.$route.query)||void 0===e?void 0:e.restoreMode,s=null===(t=this.$route.query)||void 0===t?void 0:t.resourceName,i=Object(h["e"])(b),l="new"===a||void 0===a;return{snapshotName:s,restoreNewVm:l,restoreResource:i,name:"",description:"",deletionPolicy:"retain",namespace:""}},computed:{snapshotOption(){const e=this.$store.getters["cluster/all"](p["a"].VM_SNAPSHOT);return e.filter(e=>{var t;const a=this.restoreNewVm||e.attachVmExisting;return a&&(null===e||void 0===e||null===(t=e.status)||void 0===t?void 0:t.readyToUse)}).map(e=>({label:e.metadata.name,value:e.metadata.name}))},deletionPolicyOption(){return[{value:"retain",label:"Retain"}]},currentBackupResource(){const e=this.snapshotName,t=this.$store.getters["cluster/all"](p["a"].VM_SNAPSHOT);return t.find(t=>t.name===e)},disableExisting(){var e;return!(null!==(e=this.currentBackupResource)&&void 0!==e&&e.attachVmExisting)},snapshotNamespace(){var e;const t=this.$store.getters["cluster/all"](p["a"].VM_SNAPSHOT);return null===(e=t.find(e=>e.metadata.name===this.snapshotName))||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.namespace},namespaces(){const e=this.$store.getters["cluster/all"](m["p"]),t=this.$store.getters["systemNamespaces"],a=Object(v["a"])(e.filter(e=>!t.includes(e.metadata.name)).map(e=>({label:e.nameDisplay,value:e.id})),"label");return a}},watch:{snapshotName:{handler(e){var t;this.currentBackupResource&&(this.restoreNewVm||(this.name=null===this||void 0===this||null===(t=this.currentBackupResource)||void 0===t?void 0:t.attachVM));this.restoreResource.spec.virtualMachineSnapshotName=e},immediate:!0},restoreNewVm(e){var t;e?this.name="":this.name=null===this||void 0===this||null===(t=this.currentBackupResource)||void 0===t?void 0:t.attachVM},snapshotNamespace:{handler(e){this.namespace=e},immediate:!0}},methods:{async saveRestore(e){this.update();const t=await this.$store.dispatch("cluster/create",this.restoreResource);t.metadata.namespace=this.namespace;try{await t.save(),e(!0),this.$router.push({name:this.doneRoute,params:{resource:p["a"].VM}})}catch(a){this.errors=Object(c["b"])(a)||a,e(!1)}},update(){this.restoreResource.metadata.generateName=`restore-${this.snapshotName}-`,this.name&&(this.restoreResource.spec.target.name=this.name),this.restoreNewVm?(delete this.restoreResource.spec.deletionPolicy,this.restoreResource.spec.newVM=!0):(this.restoreResource.spec.deletionPolicy=this.deletionPolicy,delete this.restoreResource.spec.newVM)}},componentTitle(){return"restoreVM"}},y=f,g=(a("f6c6"),a("d802")),C=Object(g["a"])(y,s,i,!1,null,"71440138",null);t["default"]=C.exports},edac:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".volume-source[data-v-6386f148]{position:relative}.remove-vol[data-v-6386f148]{position:absolute;top:10px;right:10px;padding:0}",""]),e.exports=t},f19e:function(e,t,a){"use strict";a("f33f")},f33f:function(e,t,a){var s=a("c545");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("5b3e46aa",s,!0,{sourceMap:!1,shadowMode:!1})},f56d:function(e,t,a){var s=a("edac");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("694fb686",s,!0,{sourceMap:!1,shadowMode:!1})},f6c6:function(e,t,a){"use strict";a("bc46")},f7b6:function(e,t,a){"use strict";a("ac8d")},fa89:function(e,t,a){"use strict";a("c3cb")},fea5:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[e._l(e.rows,(function(a,s){return t("InfoBox",{key:s,staticClass:"infoBox"},[e.isView?e._e():t("button",{staticClass:"role-link remove-vol",attrs:{type:"button"},on:{click:function(t){return e.remove(a)}}},[t("i",{staticClass:"icon icon-x"})]),t("h3",[e._v(" "+e._s(e.t("harvester.virtualMachine.network.title"))+" ")]),t("Base",{key:e.rows[s].rowKeyId,attrs:{rows:e.rows,mode:e.mode,namespace:e.namespace,"is-single":e.isSingle,"network-option":e.networkOption},on:{update:e.update},model:{value:e.rows[s],callback:function(t){e.$set(e.rows,s,t)},expression:"rows[i]"}})],1)})),e.isView?e._e():t("button",{staticClass:"btn btn-sm bg-primary",attrs:{type:"button"},on:{click:e.add}},[e._v(" "+e._s(e.t("harvester.virtualMachine.network.addNetwork"))+" ")])],2)},i=[],l=a("13a9"),r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hen-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),required:"",mode:e.mode,disabled:e.isDisabled},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hen-model"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.model"),value:e.value.model,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.model"),disabled:e.isDisabled,options:e.modelOption,mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.model,callback:function(t){e.$set(e.value,"model",t)},expression:"value.model"}})],1)],1)]),t("div",{staticClass:"row",class:{"mb-20":!e.isMasquerade}},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hen-networkName"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.network"),value:e.value.networkName,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.network"),options:e.allNetworkOption,mode:e.mode,required:"",disabled:e.isDisabled},on:{input:e.updateNetworkName},model:{value:e.value.networkName,callback:function(t){e.$set(e.value,"networkName",t)},expression:"value.networkName"}})],1)],1)])])},o=[],n=a("5361"),d=a("8e93"),u=a("466b"),c=a("e24b"),m=a("da25"),p=a("6834");const v=[{label:"virtio",value:"virtio"},{label:"e1000",value:"e1000"}];var h={name:"HarvesterEditNetwork",components:{LabeledInput:d["a"],LabeledSelect:u["a"],InputOrDisplay:n["a"]},props:{value:{type:Object,default:()=>({})},networkOption:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},mode:{type:String,default:"create"},isSingle:{type:Boolean,default:!0},namespace:{type:String,default:null}},data(){const e=this.value.isPod;return e&&(this.value.networkName=p["a"]),{isMasquerade:e,hasManagementNetwork:!1,showAdvanced:!1}},computed:{isDisabled(){return"podnet"===this.value.name||this.isMasquerade&&!this.value.newCreateId&&!this.isCreate},isView(){return this.mode===m["w"]},isCreate(){return this.mode===m["n"]},modelOption(){return v},allNetworkOption(){const e=Object(c["e"])(this.networkOption).filter(e=>e.label.includes(this.namespace)),t=[{label:p["a"],value:p["a"]}];return this.value.newCreateId&&this.hasManagementNetwork?e:this.isMasquerade?t:e}},watch:{rows:{handler(e){const t=!!e.some(e=>e.isPod);this.$set(this,"hasManagementNetwork",t)},immediate:!0,deep:!0},isSingle(e){e||(this.$set(this.value,"macAddress",""),this.update())}},methods:{updateNetworkName(e){e===p["a"]?(this.value.isPod=!0,this.value.macAddress=""):this.value.isPod=!1,this.$set(this,"isMasquerade",this.value.isPod),this.value.isPod?this.value.type="masquerade":this.value.type="macvtap",this.update()},update(){this.$emit("update")},toggleAdvanced(){this.showAdvanced=!this.showAdvanced}}},b=h,f=a("d802"),y=Object(f["a"])(b,r,o,!1,null,null,null),g=y.exports,C=a("907c"),S=a("873f"),w=a("1d19"),k=a("2cb5"),N=a("bddd"),_=a("90cd"),M={components:{InfoBox:l["a"],Base:g},props:{mode:{type:String,default:"create"},value:{type:Array,default:()=>[]},namespace:{type:String,default:null},isSingle:{type:Boolean,default:!0}},data(){return{rows:this.addKeyId(Object(c["e"])(this.value)),nameIdx:1}},computed:{isView(){return this.mode===m["w"]},networkOption(){const e=this.$store.getters[_["b"]+"/all"](C["q"]).filter(e=>{var t;return!(null!==(t=e.metadata)&&void 0!==t&&null!==(t=t.annotations)&&void 0!==t&&t[S["a"].STORAGE_NETWORK])}),t=Object(w["a"])(e.map(e=>{const t=e.id;return{label:t,value:e.metadata.name}}),"label");return t}},watch:{value(e){this.rows=e}},methods:{add(e){const t=this.generateName(),a={name:t,networkName:"",model:"virtio",type:"bridge",newCreateId:Object(k["p"])(10),rowKeyId:Object(k["p"])(10)};this.rows.push(a),this.update()},remove(e){Object(N["i"])(this.rows,e),this.update()},addKeyId(e){return e.map(e=>({...e,rowKeyId:Object(k["p"])(10)}))},generateName(){let e="",t=!0;while(t)e="nic-"+this.nameIdx,t=this.rows.find(t=>t.name===e),this.nameIdx++;return e},update(){this.$emit("input",this.rows)}}},O=M,I=(a("b930"),Object(f["a"])(O,s,i,!1,null,"6aafe4d4",null));t["a"]=I.exports},ff89:function(e,t,a){var s=a("1916");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("94894cfa",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=harvester-ift-0.1.0.umd.min.edit.js.map