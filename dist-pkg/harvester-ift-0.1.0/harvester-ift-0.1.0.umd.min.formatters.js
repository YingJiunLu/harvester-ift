(("undefined"!==typeof self?self:this)["webpackJsonpharvester_ift_0_1_0"]=("undefined"!==typeof self?self:this)["webpackJsonpharvester_ift_0_1_0"]||[]).push([[7],{"01e3":function(e,t,s){var a=s("85af");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=s("0ed3").default;i("13a1a35e",a,!0,{sourceMap:!1,shadowMode:!1})},"0c11":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",["N/A"!==e.value?t("div",{staticClass:"text"},[t("BadgeStateFormatter",{staticClass:"ml-10",attrs:{arbitrary:e.arbitrary,row:e.row,value:e.value}})],1):t("div",{staticClass:"text"},[e._v(" "+e._s(e.value)+" ")])])},i=[],o=s("7b24"),n={components:{BadgeStateFormatter:o["a"]},props:{value:{type:String,default:""},row:{type:Object,required:!0},col:{type:Object,default:()=>{}},arbitrary:{type:Boolean,default:!1}},data(){return{}}},r=n,l=(s("1c2d"),s("d802")),d=Object(l["a"])(r,a,i,!1,null,"d543d746",null);t["default"]=d.exports},"0ed6":function(e,t,s){var a=s("5eaa");t=a(!1),t.push([e.i,".state[data-v-21cf3140]{display:flex;justify-content:space-between}.state .icon-warning[data-v-21cf3140]{margin-top:2px}",""]),e.exports=t},"1c2d":function(e,t,s){"use strict";s("01e3")},"2c7c":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("span",[t("HarvesterMigrationState",{directives:[{name:"show",rawName:"v-show",value:e.isMigrating,expression:"isMigrating"}],attrs:{"vm-resource":e.row},on:{"state-changed":e.migrationStateChanged}}),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isMigrating,expression:"!isMigrating"}],staticClass:"state"},[t("VMState",{attrs:{row:e.row}}),e.warningMessage.length?t("v-popover",{attrs:{trigger:"hover",offset:"16"}},[t("span",{staticClass:"tooltip-target"},[t("i",{staticClass:"icon icon-warning icon-lg text-warning"})]),t("template",{slot:"popover"},e._l(e.warningMessage,(function(s,a){return t("p",{key:s},[e._v(" "+e._s(a+1)+". "+e._s(s)+" ")])})),0)],2):e._e()],1)],1)},i=[],o=s("7b24"),n=s("986d"),r={components:{VMState:o["a"],HarvesterMigrationState:n["default"]},props:{value:{type:String,default:""},row:{type:Object,required:!0},allNodeNetwork:{type:Array,default:()=>[]},allClusterNetwork:{type:Array,default:()=>[]}},data(){return{isMigrating:!1}},computed:{warningMessage(){var e,t,s,a;const i=[];if(null!==(e=this.row.warningMessage)&&void 0!==e&&e.pod){var o,n;const e=this.row.warningMessage.pod;var r;if(null!==(o=e.metadata)&&void 0!==o&&null!==(o=o.state)&&void 0!==o&&o.error&&!/pod has unbound immediate PersistentVolumeClaims/.test(null===(n=e.metadata)||void 0===n||null===(n=n.state)||void 0===n?void 0:n.message))i.push(null===(r=e.metadata)||void 0===r||null===(r=r.state)||void 0===r?void 0:r.message)}var l,d;"VM error"===(null===(t=this.row)||void 0===t?void 0:t.actualState)&&null!==(s=this.row.warningMessage)&&void 0!==s&&s.message&&i.push(null===(l=this.row.warningMessage)||void 0===l?void 0:l.message);null!==(a=this.row)&&void 0!==a&&a.migrationMessage&&i.push(null===(d=this.row)||void 0===d?void 0:d.migrationMessage.message);return i}},methods:{migrationStateChanged(e){this.isMigrating="Failed"!==e&&!!e}}},l=r,d=(s("65bb"),s("d802")),c=Object(d["a"])(l,a,i,!1,null,"21cf3140",null);t["default"]=c.exports},"385b":function(e,t,s){var a=s("da1f");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=s("0ed3").default;i("25814934",a,!0,{sourceMap:!1,shadowMode:!1})},"4a38":function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("a",{staticClass:"copy-to-clipboard-text",class:{copied:e.copied,plain:e.plain},attrs:{href:"#"},on:{click:e.clicked}},[e._v(" "+e._s(e.text)+" "),t("i",{staticClass:"icon",class:{"icon-copy":!e.copied,"icon-checkmark":e.copied}})])},i=[],o={props:{text:{type:String,required:!0},plain:{type:Boolean,default:!1}},data(){return{copied:!1}},methods:{clicked(e){if(!this.copied){e.preventDefault(),this.$copyText(this.text),this.copied=!0;let t=e.target;"I"===t.tagName&&(t=t.parentElement||t),setTimeout(()=>{this.copied=!1},500)}}}},n=o,r=(s("f9dd"),s("d802")),l=Object(r["a"])(n,a,i,!1,null,"f6a2b8be",null);t["a"]=l.exports},"4b06":function(e,t,s){"use strict";s.d(t,"a",(function(){return m})),s.d(t,"b",(function(){return g}));var a=s("e3b5"),i=s.n(a),o=s("7838"),n=s.n(o),r=s("9e74"),l=s.n(r),d=s("e24b"),c=s("907c"),u=s("90cd"),p=s("873f"),h=s("6834");const m={package_update:!0,packages:["qemu-guest-agent"],runcmd:[["systemctl","enable","--now","qemu-guest-agent.service"]]},v={default:"qemu-guest-agent.service"},g=[{bus:"usb",name:"tablet",type:"tablet"}],f={EXISTING_ALL:"EXISTING_ALL",EXISTING_ONLY_ANNOTATION:"EXISTING_ANNOTATION",EXISTING_ONLY_CLOUD:"EXISTING_CLOUD"};t["c"]={methods:{hasCloudConfigComment(e){var t,s,a;const o=e?i.a.parseDocument(e):i.a.parseDocument({}),n=(null===o||void 0===o||null===(t=o.contents)||void 0===t?void 0:t.items)||[];let r=!1;return("cloud-config"===(null===o||void 0===o?void 0:o.comment)||null!==o&&void 0!==o&&null!==(s=o.comment)&&void 0!==s&&s.includes("cloud-config\n"))&&(r=!0),("cloud-config"===(null===o||void 0===o?void 0:o.commentBefore)||null!==o&&void 0!==o&&null!==(a=o.commentBefore)&&void 0!==a&&a.includes("cloud-config\n"))&&(r=!0),n.map(e=>{var t;const s=e.key;("cloud-config"===(null===s||void 0===s?void 0:s.commentBefore)||null!==s&&void 0!==s&&null!==(t=s.commentBefore)&&void 0!==t&&t.includes("cloud-config\n"))&&(r=!0)}),r},getSSHValue(e){var t;const s=this.$store.getters[u["b"]+"/all"](u["a"].SSH)||[];return(null===(t=s.find(t=>t.id===e))||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.publicKey)||void 0},getOsType(e){var t;return null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[p["a"].OS]},getMatchQGA(e){const t=Object(d["e"])(m);let s=!1;return h["b"].forEach(t=>{t.match&&(s=t.match.find(t=>t===e))}),t.runcmd[0][3]=s?v[e]:v["default"],t},getSimilarRuncmd(e){const t=Object(d["e"])(m);return t.runcmd[0][3]="openSUSE"===e?v["default"]:v["suse"],t.runcmd[0]},hasInstallAgent(e,t,s){var a,i;let o={};const r=this.getMatchQGA(t);try{o=n.a.load(e)||{}}catch(l){return new Error("Function(hasInstallAgent) error"),s}return(null===(a=o)||void 0===a||null===(a=a.packages)||void 0===a?void 0:a.includes("qemu-guest-agent"))&&!(null===(i=o)||void 0===i||null===(i=i.runcmd)||void 0===i||!i.find(e=>Array.isArray(e)&&e.join("-")===r.runcmd[0].join("-")))},isInstallUSBTablet(e){var t;const s=null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.devices)||void 0===t?void 0:t.inputs;return!!Array.isArray(s)&&!!s.find(e=>l()(e,g[0]))},isEfiEnabled(e){var t,s;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.features)||void 0===t||!t.smm||null===e||void 0===e||null===(s=e.template)||void 0===s||null===(s=s.spec)||void 0===s||null===(s=s.domain)||void 0===s||null===(s=s.firmware)||void 0===s||null===(s=s.bootloader)||void 0===s||!s.efi)},isSecureBoot(e){var t;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.firmware)||void 0===t||null===(t=t.bootloader)||void 0===t||null===(t=t.efi)||void 0===t||!t.secureBoot)},getCloudInitNoCloud(e){var t,s,a;const i=this.getSecret(e);let o=null===i||void 0===i||null===(t=i.decodedData)||void 0===t?void 0:t.userdata,n=null===i||void 0===i||null===(s=i.decodedData)||void 0===s?void 0:s.networkdata;const r=(null===e||void 0===e||null===(a=e.template)||void 0===a||null===(a=a.spec)||void 0===a||null===(a=a.volumes)||void 0===a||null===(a=a.find(e=>"cloudinitdisk"===e.name))||void 0===a?void 0:a.cloudInitNoCloud)||{};return null!==r&&void 0!==r&&r.userData&&(o=r.userData,this.saveUserDataAsClearText=!0),null!==r&&void 0!==r&&r.networkData&&(n=r.networkData,this.saveNetworkDataAsClearText=!0),{userData:o,networkData:n}},getSecret(e){var t,s,a;const i=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.volumes)||void 0===t||null===(t=t.find(e=>"cloudinitdisk"===e.name))||void 0===t?void 0:t.cloudInitNoCloud)||{},o=this.$store.getters[u["b"]+"/all"](c["B"])||[],n=(null===i||void 0===i||null===(s=i.secretRef)||void 0===s?void 0:s.name)||(null===i||void 0===i||null===(a=i.networkDataSecretRef)||void 0===a?void 0:a.name),r=o.find(e=>e.metadata.name===n);return r},getAccessCredentials(e){var t,s;const a=this.$store.getters[u["b"]+"/all"](c["B"])||[],i=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.accessCredentials)||[],o=JSON.parse((null===(s=e.template.metadata)||void 0===s||null===(s=s.annotations)||void 0===s?void 0:s[p["a"].DYNAMIC_SSHKEYS_NAMES])||"[]");return i.map(e=>{var t;const s=e.userPassword?"userPassword":"sshPublicKey",i=null===(t=e[s])||void 0===t||null===(t=t.source)||void 0===t||null===(t=t.secret)||void 0===t?void 0:t.secretName,n=a.find(e=>e.metadata.name===i),r={source:s,username:"",newPassword:"",users:[],sshkeys:[],secretName:i,secretRef:n};if(n)if("userPassword"===s){const e=Object.keys(null===n||void 0===n?void 0:n.data)[0],t=n.decodedData[e];r.username=e,r.newPassword=t}else{const t=e[s].propagationMethod.qemuGuestAgent.users,a=null===o||void 0===o?void 0:o[i];r.users=t,r.sshkeys=a}else r.secretRef=void 0;return r})},getVolumeClaimTemplates(e){let t=[];try{t=JSON.parse(e.metadata.annotations[p["a"].VOLUME_CLAIM_TEMPLATE])}catch(s){new Error("Function: getVolumeClaimTemplates, "+s)}return t},getRootImageId(e){var t;const s=this.getVolumeClaimTemplates(e);return(null===(t=s[0])||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[p["a"].IMAGE_ID])||""},getSSHFromAnnotation(e){var t;const s=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[p["a"].SSH_NAMES])||"[]";return JSON.parse(s)},convertToJson(e=""){let t={};try{t=n.a.load(e)}catch(s){new Error("Function(convertToJson) error")}return t},getSSHFromUserData(e){var t;return(null===(t=this.convertToJson(e))||void 0===t?void 0:t.ssh_authorized_keys)||[]},compareSSHValue(e="",t=""){const s=/(\r\n\t|\n|\r\t)|(\s*)/gm;return e.replace(s,"")===t.replace(s,"")},mergeAllSSHs(e){const t=this.getSSHFromAnnotation(e),{userScript:s}=this.getCloudInitNoCloud(e);if(!(null!==t&&void 0!==t&&t.length)<0&&!s)return[];let a=[];const i=this.$store.getters[u["b"]+"/all"](u["a"].SSH)||[];a=(t||[]).map(e=>{const t=i.find(t=>t.id===e);return t?{id:t.id,data:t,type:f.EXISTING_ALL}:{id:e,data:e,type:f.EXISTING_ONLY_ANNOTATION}});const o=this.getSSHFromUserData(s);return o.map(e=>{const t=i.find(t=>{var s;return this.compareSSHValue(e,null===(s=t.spec)||void 0===s?void 0:s.publicKey)});t&&!a.find(e=>e.id===t.id)?a.push({id:t.id,data:t,type:f.EXISTING_ALL}):t||a.push({id:"Unknown",data:e,type:f.EXISTING_ONLY_CLOUD})}),a}}}},"60aa":function(e,t,s){var a=s("5eaa");t=a(!1),t.push([e.i,".badge-state[data-v-5ceec65a]{padding:5px 10px;border:1px solid transparent;border-radius:20px}.badge-state.bg-info[data-v-5ceec65a]{border-color:var(--primary)}.badge-state.bg-error[data-v-5ceec65a]{border-color:var(--error)}.badge-state.bg-warning[data-v-5ceec65a]{border-color:var(--warning)}.badge-state.bg-success[data-v-5ceec65a]{color:var(--success);border-color:var(--success);background:transparent}.sortable-table TD .badge-state[data-v-5ceec65a]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;word-wrap:break-word;display:inline-block;max-width:100%;position:relative;padding:2px 10px 1px 10px;font-size:1em;max-width:200px;font-size:.85em;vertical-align:middle}",""]),e.exports=t},"65bb":function(e,t,s){"use strict";s("b1bd")},6834:function(e,t,s){"use strict";s.d(t,"a",(function(){return I})),s.d(t,"b",(function(){return T}));var a=s("e3b5"),i=s.n(a),o=s("7838"),n=s.n(o),r=s("9e74"),l=s.n(r),d=s("330a"),c=s.n(d),u=s("94a3"),p=s.n(u),h=s("1d19"),m=s("e24b"),v=s("a8b9"),g=s("2cb5"),f=s("0f81"),S=s("d37d"),b=s("7c47"),y=s("da25"),_=s("907c"),A=s("90cd");const E={BACKUP_TARGET:"backup-target",CONTAINERD_REGISTRY:"containerd-registry",LOG_LEVEL:"log-level",SERVER_VERSION:"server-version",UI_INDEX:"ui-index",UI_PLUGIN_INDEX:"ui-plugin-index",UPGRADE_CHECKER_ENABLED:"upgrade-checker-enabled",UPGRADE_CHECKER_URL:"upgrade-checker-url",VLAN:"vlan",UI_SOURCE:"ui-source",HTTP_PROXY:"http-proxy",ADDITIONAL_CA:"additional-ca",OVERCOMMIT_CONFIG:"overcommit-config",CLUSTER_REGISTRATION_URL:"cluster-registration-url",DEFAULT_STORAGE_CLASS:"default-storage-class",VIP:"vip-pools",SUPPORT_BUNDLE_TIMEOUT:"support-bundle-timeout",SUPPORT_BUNDLE_IMAGE:"support-bundle-image",STORAGE_NETWORK:"storage-network",VM_FORCE_RESET_POLICY:"vm-force-reset-policy",SSL_CERTIFICATES:"ssl-certificates",SSL_PARAMETERS:"ssl-parameters",SUPPORT_BUNDLE_NAMESPACES:"support-bundle-namespaces",AUTO_DISK_PROVISION_PATHS:"auto-disk-provision-paths",RELEASE_DOWNLOAD_URL:"release-download-url",CCM_CSI_VERSION:"harvester-csi-ccm-versions"};E.BACKUP_TARGET,E.LOG_LEVEL,E.VLAN,E.SERVER_VERSION,E.UPGRADE_CHECKER_ENABLED,E.UPGRADE_CHECKER_URL,E.HTTP_PROXY,E.ADDITIONAL_CA,E.OVERCOMMIT_CONFIG,E.SUPPORT_BUNDLE_TIMEOUT,E.SUPPORT_BUNDLE_IMAGE,E.STORAGE_NETWORK,E.VM_FORCE_RESET_POLICY,E.SSL_CERTIFICATES,E.VIP,E.SSL_PARAMETERS,E.SUPPORT_BUNDLE_NAMESPACES,E.AUTO_DISK_PROVISION_PATHS,E.RELEASE_DOWNLOAD_URL,E.UI_PLUGIN_INDEX,E.CONTAINERD_REGISTRY,E.UI_SOURCE,E.UI_INDEX,E.CLUSTER_REGISTRATION_URL;var w=s("4ac6"),N=s("873f"),C=s("4b06");const I="management Network",T=[{label:"Windows",value:"windows"},{label:"Linux",value:"linux"},{label:"SUSE Linux Enterprise",value:"SLEs"},{label:"Debian",value:"debian"},{label:"Fedora",value:"fedora"},{label:"Gentoo",value:"gentoo"},{label:"Oracle",value:"oracle"},{label:"Red Hat",value:"redhat"},{label:"openSUSE",value:"openSUSE"},{label:"Ubuntu",value:"ubuntu"},{label:"Other Linux",match:["centos"],value:"otherLinux"}],O="cd-rom",M="disk";t["c"]={mixins:[C["c"]],props:{value:{type:Object,required:!0},resource:{type:String,default:""}},async fetch(){var e;const t={pvs:this.$store.dispatch(A["b"]+"/findAll",{type:_["w"]}),pvcs:this.$store.dispatch(A["b"]+"/findAll",{type:_["x"]}),storageClasses:this.$store.dispatch(A["b"]+"/findAll",{type:_["E"]}),sshs:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].SSH}),settings:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].SETTING}),images:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].IMAGE}),versions:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].VM_VERSION}),templates:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].VM_TEMPLATE}),networkAttachment:this.$store.dispatch(A["b"]+"/findAll",{type:_["q"]}),vmis:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].VMI}),vmims:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].VMIM}),vms:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].VM}),secrets:this.$store.dispatch(A["b"]+"/findAll",{type:_["B"]}),addons:this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].ADD_ONS})};this.$store.getters[A["b"]+"/schemaFor"](_["s"])&&(t.nodes=this.$store.dispatch(A["b"]+"/findAll",{type:_["s"]})),this.$store.getters[A["b"]+"/schemaFor"](A["a"].CLUSTER_NETWORK)&&(t.clusterNetworks=this.$store.dispatch(A["b"]+"/findAll",{type:A["a"].CLUSTER_NETWORK}));const s=await Object(v["a"])(t),a=this.$store.getters[A["b"]+"/schemaFor"](A["a"].PCI_DEVICE);this.enabledPCI=!0===(null===(e=s.addons.find(e=>"pcidevices-controller"===e.name))||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.enabled)&&a},data(){const e=this.realMode===y["l"];return{OS:T,isClone:e,spec:null,osType:"linux",sshKey:[],runStrategy:"RerunOnFailure",installAgent:!0,hasCreateVolumes:[],installUSBTablet:!0,networkScript:"",userScript:"",imageId:"",diskRows:[],networkRows:[],machineType:"",secretName:"",secretRef:null,showAdvanced:!1,deleteAgent:!0,memory:null,cpu:"",reservedMemory:null,accessCredentials:[],efiEnabled:!1,secureBoot:!1,userDataTemplateId:"",saveUserDataAsClearText:!1,saveNetworkDataAsClearText:!1,enabledPCI:!1,immutableMode:this.realMode===y["n"]?y["n"]:y["w"]}},computed:{inStore(){return A["b"]},images(){return this.$store.getters[this.inStore+"/all"](A["a"].IMAGE)},versions(){return this.$store.getters[this.inStore+"/all"](A["a"].VM_VERSION)},templates(){return this.$store.getters[this.inStore+"/all"](A["a"].VM_TEMPLATE)},pvcs(){return this.$store.getters[this.inStore+"/all"](_["x"])},secrets(){return this.$store.getters[this.inStore+"/all"](_["B"])},nodesIdOptions(){const e=this.$store.getters[this.inStore+"/all"](_["s"]);return e.filter(e=>!e.isUnSchedulable).map(e=>({label:e.nameDisplay,value:e.id}))},defaultStorageClass(){var e;const t=this.$store.getters[this.inStore+"/all"](_["E"]).find(e=>e.isDefault);return(null===t||void 0===t||null===(e=t.metadata)||void 0===e?void 0:e.name)||"longhorn"},storageClassSetting(){try{var e;const t=null===(e=this.$store.getters[this.inStore+"/all"](A["a"].SETTING).find(e=>e.id===E.DEFAULT_STORAGE_CLASS))||void 0===e?void 0:e.value;return JSON.parse(t)}catch(t){return{}}},customVolumeMode(){return this.storageClassSetting.volumeMode||"Block"},customAccessMode(){return this.storageClassSetting.accessModes||"ReadWriteMany"},isWindows(){return"windows"===this.osType},needNewSecret(){return this.resource===A["a"].VM_VERSION||this.isCreate}},async created(){await this.$store.dispatch(this.inStore+"/findAll",{type:_["B"]}),this.getInitConfig({value:this.value,init:this.isCreate})},methods:{getInitConfig(e){var t,s,a,i,o;const{value:n,existUserData:r,fromTemplate:l=!1,init:d=!1}=e,c=this.resource===A["a"].VM?n:this.resource===A["a"].BACKUP?null===(t=this.value.status)||void 0===t?void 0:t.source:n.spec.vm,u=null===c||void 0===c?void 0:c.spec;if(!u)return;const p=u.template.spec.domain.resources;null!==p&&void 0!==p&&p.limits&&(null===p||void 0===p||!p.limits||null!==p&&void 0!==p&&null!==(s=p.limits)&&void 0!==s&&s.memory||null===(null===p||void 0===p||null===(a=p.limits)||void 0===a?void 0:a.memory))||(u.template.spec.domain.resources={...u.template.spec.domain.resources,limits:{...u.template.spec.domain.resources.limits,memory:u.template.spec.domain.resources.requests.memory}});const h=u.runStrategy||"RerunOnFailure",m=n.machineType,v=null===(i=u.template.spec.domain)||void 0===i||null===(i=i.cpu)||void 0===i?void 0:i.cores,g=u.template.spec.domain.resources.limits.memory,S=null===(o=c.metadata)||void 0===o||null===(o=o.annotations)||void 0===o?void 0:o[N["a"].VM_RESERVED_MEMORY],b=this.getSSHFromAnnotation(u)||[],y=this.getRootImageId(c)||"",_=this.getDiskRows(c),E=this.getNetworkRows(c,{fromTemplate:l,init:d}),w=this.getHasCreatedVolumes(u)||[];let{userData:C,networkData:I}=this.getCloudInitNoCloud(u);if(this.resource===A["a"].BACKUP){var T;const e=null===(T=this.value.status)||void 0===T?void 0:T.secretBackups;if(e){var O,M;const t=(null===(O=e[0])||void 0===O||null===(O=O.data)||void 0===O?void 0:O.networkdata)||"",s=(null===(M=e[0])||void 0===M||null===(M=M.data)||void 0===M?void 0:M.userdata)||"";C=Object(f["a"])(s),I=Object(f["a"])(t)}}const R=this.getOsType(c)||"linux";C=!this.isCreate||r||this.isClone?C:this.getInitUserData({osType:R});const k=this.isInstallUSBTablet(u),D=this.hasInstallAgent(C,R,!0),V=this.isEfiEnabled(u),$=this.isSecureBoot(u),x=this.getSecret(u),U=this.getAccessCredentials(u);Object.prototype.hasOwnProperty.call(u,"running")&&(delete u.running,u.runStrategy="RerunOnFailure"),this.$set(this,"spec",u),this.$set(this,"runStrategy",h),this.$set(this,"secretRef",x),this.$set(this,"accessCredentials",U),this.$set(this,"userScript",C),this.$set(this,"networkScript",I),this.$set(this,"sshKey",b),this.$set(this,"osType",R),this.$set(this,"installAgent",D),this.$set(this,"cpu",v),this.$set(this,"memory",g),this.$set(this,"reservedMemory",S),this.$set(this,"machineType",m),this.$set(this,"installUSBTablet",k),this.$set(this,"efiEnabled",V),this.$set(this,"secureBoot",$),this.$set(this,"hasCreateVolumes",w),this.$set(this,"networkRows",E),this.$set(this,"imageId",y),this.$set(this,"diskRows",_),this.refreshYamlEditor()},getDiskRows(e){const t=e.metadata.namespace,s=e.spec.template.spec.volumes||[],a=e.spec.template.spec.domain.devices.disks||[],i=this.getVolumeClaimTemplates(e);let o=[];return 0===a.length?o.push({id:Object(g["p"])(5),source:b["d"].IMAGE,name:"disk-0",accessMode:"ReadWriteMany",bus:"virtio",volumeName:"",size:"10Gi",type:M,storageClassName:"",image:this.imageId,volumeMode:"Block"}):o=a.map((e,a)=>{var o,n,r,l;const d=s.find(t=>t.name===e.name);let c="",u="",p="",h="",m="",v="",f="",y="",E="",w=!1,C=null;const I=null!==e&&void 0!==e&&e.cdrom?O:null!==e&&void 0!==e&&e.disk?M:"";if(null!==d&&void 0!==d&&d.containerDisk&&(p=b["d"].CONTAINER,m=d.containerDisk.image),d.persistentVolumeClaim&&null!==(o=d.persistentVolumeClaim)&&void 0!==o&&o.claimName){v=d.persistentVolumeClaim.claimName;const e=i.find(e=>e.metadata.name===v);if(h=v,e){var T,R,k,D;if(void 0!==(null===(T=e.metadata)||void 0===T||null===(T=T.annotations)||void 0===T?void 0:T[N["a"].IMAGE_ID]))u=null===(D=e.metadata)||void 0===D||null===(D=D.annotations)||void 0===D?void 0:D[N["a"].IMAGE_ID],p=b["d"].IMAGE;else p=b["d"].NEW;const t=(null===e||void 0===e?void 0:e.spec)||{};y=null===t||void 0===t?void 0:t.volumeMode,f=null===t||void 0===t||null===(R=t.accessModes)||void 0===R?void 0:R[0],c=(null===t||void 0===t||null===(k=t.resources)||void 0===k||null===(k=k.requests)||void 0===k?void 0:k.storage)||"10Gi",E=null===t||void 0===t?void 0:t.storageClassName,C=null===t||void 0===t?void 0:t.dataSource}else{var V,$,x,U,P;const e=this.$store.getters[A["b"]+"/all"](_["x"]),s=e.find(e=>{var s;return e.id===`${t}/${null===d||void 0===d||null===(s=d.persistentVolumeClaim)||void 0===s?void 0:s.claimName}`});p=b["d"].ATTACH_VOLUME,f=(null===s||void 0===s||null===(V=s.spec)||void 0===V||null===(V=V.accessModes)||void 0===V?void 0:V[0])||"ReadWriteMany",c=(null===s||void 0===s||null===($=s.spec)||void 0===$||null===($=$.resources)||void 0===$||null===($=$.requests)||void 0===$?void 0:$.storage)||"10Gi",E=null===s||void 0===s||null===(x=s.spec)||void 0===x?void 0:x.storageClassName,y=(null===s||void 0===s||null===(U=s.spec)||void 0===U?void 0:U.volumeMode)||"Block",v=(null===s||void 0===s||null===(P=s.metadata)||void 0===P?void 0:P.name)||""}w=d.persistentVolumeClaim.hotpluggable||!1}const L=(null===e||void 0===e||null===(n=e.disk)||void 0===n?void 0:n.bus)||(null===e||void 0===e||null===(r=e.cdrom)||void 0===r?void 0:r.bus),G=null!==e&&void 0!==e&&e.bootOrder?null===e||void 0===e?void 0:e.bootOrder:a,j=Object(S["d"])(c),B=Object(S["c"])(j,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3}),H=null===(l=this.pvcs.find(e=>e.id===`${this.value.metadata.namespace}/${v}`))||void 0===l||null===(l=l.relatedPV)||void 0===l||null===(l=l.metadata)||void 0===l||null===(l=l.annotations)||void 0===l?void 0:l[N["a"].VOLUME_ERROR];return{id:Object(g["p"])(5),bootOrder:G,source:p,name:e.name,realName:h,bus:L,volumeName:v,container:m,accessMode:f,size:B+"Gi",volumeMode:y||this.customVolumeMode,image:u,type:I,storageClassName:E,hotpluggable:w,volumeStatus:H,dataSource:C}}),o=Object(h["a"])(o,"bootOrder"),o.filter(e=>"cloudinitdisk"!==e.name)},getNetworkRows(e,t){const{fromTemplate:s=!1,init:a=!1}=t,i=e.spec.template.spec.networks||[],o=e.spec.template.spec.domain.devices.interfaces||[],n=o.map((e,t)=>{var o;const n=i.find(t=>e.name===t.name),r=e.sriov?"sriov":e.bridge?"bridge":"masquerade",l=!!n.pod;return{...e,index:t,type:r,isPod:l,newCreateId:!(!s&&!a)&&Object(g["p"])(10),model:e.model,networkName:l?I:null===n||void 0===n||null===(o=n.multus)||void 0===o?void 0:o.networkName}});return n},parseVM(){this.userData=this.getUserData({osType:this.osType,installAgent:this.installAgent}),this.parseOther(),this.parseAccessCredentials(),this.parseNetworkRows(this.networkRows),this.parseDiskRows(this.diskRows)},parseOther(){this.spec.template.spec.domain.machine?this.$set(this.spec.template.spec.domain.machine,"type",this.machineType):this.$set(this.spec.template.spec.domain,"machine",{type:this.machineType}),this.spec.template.spec.domain.cpu.cores=this.cpu,this.spec.template.spec.domain.resources.limits.cpu=this.cpu?this.cpu.toString():this.cpu,this.spec.template.spec.domain.resources.limits.memory=this.memory;const e=this.resource===A["a"].VM?this.value:this.value.spec.vm;this.reservedMemory?e.metadata.annotations[N["a"].VM_RESERVED_MEMORY]=this.reservedMemory:delete e.metadata.annotations[N["a"].VM_RESERVED_MEMORY]},parseDiskRows(e){var t,s,a,i,o,n,r;const l=[],d=[],c=[],u=[];if(e.forEach((e,t)=>{var s;const a=(null===(s=this.value.metadata)||void 0===s?void 0:s.name)||"";let i="";i=e.source===b["d"].ATTACH_VOLUME?e.volumeName:this.isClone||!this.hasCreateVolumes.includes(e.realName)?`${a}-${e.name}-${Object(g["p"])(5).toLowerCase()}`:e.realName;const o=this.parseDisk(e,t),n=this.parseVolume(e,i),r=this.parseVolumeClaimTemplate(e,i);l.push(o),d.push(n),c.push(i),e.source!==b["d"].CONTAINER&&u.push(r)}),this.secretName&&!this.needNewSecret||(this.secretName=this.generateSecretName(this.secretNamePrefix)),!l.find(e=>"cloudinitdisk"===e.name)&&(this.userData||this.networkData)&&!this.isWindows){l.push({name:"cloudinitdisk",disk:{bus:"virtio"}});const e=this.getUserData({osType:this.osType,installAgent:this.installAgent}),t={name:"cloudinitdisk",cloudInitNoCloud:{}};this.saveUserDataAsClearText?t.cloudInitNoCloud.userData=e:t.cloudInitNoCloud.secretRef={name:this.secretName},this.saveNetworkDataAsClearText?t.cloudInitNoCloud.networkData=this.networkScript:t.cloudInitNoCloud.networkDataSecretRef={name:this.secretName},d.push(t)}let p={...this.spec,runStrategy:this.runStrategy,template:{...this.spec.template,metadata:{...null===(t=this.spec)||void 0===t||null===(t=t.template)||void 0===t?void 0:t.metadata,annotations:{...null===(s=this.spec)||void 0===s||null===(s=s.template)||void 0===s||null===(s=s.metadata)||void 0===s?void 0:s.annotations,[N["a"].SSH_NAMES]:JSON.stringify(this.sshKey)},labels:{...null===(a=this.spec)||void 0===a||null===(a=a.template)||void 0===a||null===(a=a.metadata)||void 0===a?void 0:a.labels,[N["a"].VM_NAME]:null===(i=this.value)||void 0===i||null===(i=i.metadata)||void 0===i?void 0:i.name}},spec:{...null===(o=this.spec.template)||void 0===o?void 0:o.spec,domain:{...null===(n=this.spec.template)||void 0===n||null===(n=n.spec)||void 0===n?void 0:n.domain,devices:{...null===(r=this.spec.template)||void 0===r||null===(r=r.spec)||void 0===r||null===(r=r.domain)||void 0===r?void 0:r.devices,disks:l}},volumes:d}}};0===d.length&&delete p.template.spec.volumes,this.resource===A["a"].VM?(this.isSingle||(p=this.multiVMScheduler(p)),this.$set(this.value.metadata,"annotations",{...this.value.metadata.annotations,[N["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(u),[N["a"].NETWORK_IPS]:JSON.stringify(this.value.networkIps)}),this.$set(this.value.metadata,"labels",{...this.value.metadata.labels,[N["a"].CREATOR]:"harvester",[N["a"].OS]:this.osType}),this.$set(this.value,"spec",p),this.$set(this,"spec",p)):this.resource===A["a"].VM_VERSION&&(this.$set(this.value.spec.vm,"spec",p),this.$set(this.value.spec.vm.metadata,"annotations",{...this.value.spec.vm.metadata.annotations,[N["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(u)}),this.$set(this.value.spec.vm.metadata,"labels",{[N["a"].OS]:this.osType}),this.$set(this,"spec",p))},multiVMScheduler(e){var t,s;e.template.metadata.labels[N["a"].VM_NAME_PREFIX]=this.namePrefix;const a={weight:1,podAffinityTerm:{topologyKey:w["g"],labelSelector:{matchLabels:{[N["a"].VM_NAME_PREFIX]:this.namePrefix}}}};return{...e,template:{...e.template,spec:{...e.template.spec,affinity:{...e.template.spec.affinity,podAntiAffinity:{...null===(t=e.template.spec)||void 0===t||null===(t=t.affinity)||void 0===t?void 0:t.podAntiAffinity,preferredDuringSchedulingIgnoredDuringExecution:[...(null===(s=e.template.spec)||void 0===s||null===(s=s.affinity)||void 0===s||null===(s=s.podAntiAffinity)||void 0===s?void 0:s.preferredDuringSchedulingIgnoredDuringExecution)||[],a]}}}}}},parseNetworkRows(e){const t=[],s=[];e.forEach(e=>{const a=this.parseNetwork(e),i=this.parseInterface(e);t.push(a),s.push(i)});const a={...this.spec.template.spec,domain:{...this.spec.template.spec.domain,devices:{...this.spec.template.spec.domain.devices,interfaces:s}},networks:t};this.$set(this.spec.template,"spec",a)},parseAccessCredentials(){var e;const t=[],s={},a=JSON.parse((null===(e=this.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[N["a"].DYNAMIC_SSHKEYS_USERS])||"[]");for(const i of this.accessCredentials)this.needNewSecret&&(i.secretName=this.generateSecretName(this.secretNamePrefix)),i.source===b["a"].RESET_PWD&&(a.push(i.username),t.push({userPassword:{source:{secret:{secretName:i.secretName}},propagationMethod:{qemuGuestAgent:{}}}})),i.source===b["a"].INJECT_SSH&&(a.push(...i.users),s[i.secretName]=i.sshkeys,t.push({sshPublicKey:{source:{secret:{secretName:i.secretName}},propagationMethod:{qemuGuestAgent:{users:i.users}}}}));0===t.length&&this.spec.template.spec.accessCredentials?delete this.spec.template.spec.accessCredentials:this.spec.template.spec.accessCredentials=t,0!==a.length&&(this.spec.template.metadata.annotations[N["a"].DYNAMIC_SSHKEYS_USERS]=JSON.stringify(Array.from(new Set(a))),this.spec.template.metadata.annotations[N["a"].DYNAMIC_SSHKEYS_NAMES]=JSON.stringify(s))},getInitUserData(e){const t=this.getMatchQGA(e.osType),s=n.a.dump(t);return"#cloud-config\n"+s},getUserData(e){try{let t=this.userScript?i.a.parseDocument(this.userScript):i.a.parseDocument({});const s=this.mergeSSHAuthorizedKeys(this.userScript);s.length>0?t.setIn(["ssh_authorized_keys"],s):i.a.isCollection(t.getIn("ssh_authorized_keys"))&&t.deleteIn(["ssh_authorized_keys"]),t=e.installAgent?this.mergeQGA({userDataDoc:t,...e}):this.deleteQGA({userDataDoc:t,...e});const a=t.toString();if("{}\n"===a)return;return a}catch(t){return console.error("Error: Unable to parse yaml document",t),this.userScript}},updateSSHKey(e){this.$set(this,"sshKey",e)},updateCpuMemory(e,t){this.$set(this,"cpu",e),this.$set(this,"memory",t)},parseDisk(e,t){const s={name:e.name};return e.type===M?s.disk={bus:e.bus}:e.type===O&&(s.cdrom={bus:e.bus}),s.bootOrder=t+1,s},parseVolume(e,t){const s={name:e.name};return e.source===b["d"].CONTAINER?s.containerDisk={image:e.container}:e.source!==b["d"].IMAGE&&e.source!==b["d"].NEW&&e.source!==b["d"].ATTACH_VOLUME||(s.persistentVolumeClaim={claimName:t},e.hotpluggable&&(s.persistentVolumeClaim.hotpluggable=!0)),s},parseVolumeClaimTemplate(e,t){!String(e.size).includes("Gi")&&e.size&&(e.size=e.size+"Gi");const s={metadata:{name:t},spec:{accessModes:[e.accessMode],resources:{requests:{storage:e.size}},volumeMode:e.volumeMode}};switch(e.dataSource&&(s.spec.dataSource=e.dataSource),e.source){case b["d"].ATTACH_VOLUME:s.spec.storageClassName=e.storageClassName;break;case b["d"].NEW:s.spec.storageClassName=e.storageClassName;break;case b["d"].IMAGE:{const t=this.images.find(t=>e.image===t.id);t?(s.spec.storageClassName="longhorn-"+t.metadata.name,s.metadata.annotations={[N["a"].IMAGE_ID]:t.id}):s.metadata.annotations={[N["a"].IMAGE_ID]:""};break}}return s},getSSHListValue(e){return e.map(e=>this.getSSHValue(e)).filter(e=>void 0!==e)},parseInterface(e){const t={},s=e.type;return t[s]={},e.macAddress&&(t.macAddress=e.macAddress),t.model=e.model,t.name=e.name,t},parseNetwork(e){const t={name:e.name};return e.isPod?t.pod={}:t.multus={networkName:e.networkName},t},updateUserData(e){this.userScript=e},updateNetworkData(e){this.networkScript=e},mergeSSHAuthorizedKeys(e){try{var t;const s=(null===(t=i.a.parseDocument(e).get("ssh_authorized_keys"))||void 0===t?void 0:t.toJSON())||[],a=this.getSSHListValue(this.sshKey);return s.length?[...new Set([...a,...s])]:a}catch(s){return[]}},deleteYamlDocProp(e,t){try{var s,a;const i=null===(s=e.getIn([]))||void 0===s?void 0:s.items[0],o=null===i||void 0===i?void 0:i.key,n=!(null===o||void 0===o||null===(a=o.commentBefore)||void 0===a||!a.includes("cloud-config")),r=o.source===t[t.length-1];o&&n&&r||e.deleteIn(t)}catch(i){}},mergeQGA(e){const{osType:t,userDataDoc:s}=e,a=this.getMatchQGA(t),o=s.toString(),n=i.a.parse(o);let r=(null===n||void 0===n?void 0:n.packages)||[],l=(null===n||void 0===n?void 0:n.runcmd)||[];if(s.setIn(["package_update"],!0),Array.isArray(r)?r.includes("qemu-guest-agent")||r.push("qemu-guest-agent"):r=C["a"].packages,Array.isArray(l)){let e=-1;const s=l.find(e=>Array.isArray(e)&&e.join("-")===a.runcmd[0].join("-")),i=l.find((s,a)=>!(!Array.isArray(s)||s.join("-")!==this.getSimilarRuncmd(t).join("-"))&&(e=a,!0));i?l[e]=a.runcmd[0]:s||l.push(a.runcmd[0])}else l=a.runcmd;return r.length>0?s.setIn(["packages"],r):(s.setIn(["packages"],[]),this.deleteYamlDocProp(s,["packages"]),this.deleteYamlDocProp(s,["package_update"])),l.length>0?s.setIn(["runcmd"],l):this.deleteYamlDocProp(s,["runcmd"]),s},deleteQGA(e){var t;const{osType:s,userDataDoc:a,deletePackage:o=!1}=e,n=(null===(t=this.$store.getters[A["b"]+"/byId"](_["c"],this.userDataTemplateId))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.cloudInit)||"",r=a.toString(),l=i.a.parse(r),d=(null===l||void 0===l?void 0:l.packages)||[],c=(null===l||void 0===l?void 0:l.runcmd)||[];if(Array.isArray(d)&&o){const e=this.convertToJson(n);for(let t=0;t<d.length;t++)"qemu-guest-agent"===d[t]&&(Array.isArray(null===e||void 0===e?void 0:e.packages)&&e.packages.includes("qemu-guest-agent")||d.splice(t,1))}if(Array.isArray(c)){const e=this.getMatchQGA(s);for(let t=0;t<c.length;t++)Array.isArray(c[t])&&c[t].join("-")===e.runcmd[0].join("-")&&c.splice(t,1)}return d.length>0?a.setIn(["packages"],d):(a.setIn(["packages"],[]),this.deleteYamlDocProp(a,["packages"]),this.deleteYamlDocProp(a,["package_update"])),c.length>0?a.setIn(["runcmd"],c):this.deleteYamlDocProp(a,["runcmd"]),a},generateSecretName(e){return e?`${e}-${Object(g["p"])(5).toLowerCase()}`:void 0},getOwnerReferencesFromVM(e){var t;const s=e.metadata.name,a=e.kind,i=this.resource===A["a"].VM?"kubevirt.io/v1":"harvesterhci.io/v1beta1",o=null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.uid;return[{name:s,kind:a,uid:o,apiVersion:i}]},async saveSecret(e){if(null===e||void 0===e||!e.spec||!this.secretName||this.isWindows)return!0;let t=this.getSecret(e.spec);!t&&this.isEdit&&this.secretRef&&(t=this.secretRef),t&&!this.needNewSecret||(t=await this.$store.dispatch(A["b"]+"/create",{metadata:{name:this.secretName,namespace:this.value.metadata.namespace,labels:{[N["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:_["B"]}));try{t&&(this.saveUserDataAsClearText&&this.saveNetworkDataAsClearText||(t.setData("userdata",this.userData||""),t.setData("networkdata",this.networkScript||""),await t.save()))}catch(s){return Promise.reject(s)}},async saveAccessCredentials(e){if(null===e||void 0===e||!e.spec)return!0;const t=[];for(const a of this.accessCredentials){let s=a.secretRef;if(s&&!this.needNewSecret||(s=await this.$store.dispatch(A["b"]+"/create",{metadata:{name:a.secretName,namespace:e.metadata.namespace,labels:{[N["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:_["B"]})),a.source===b["a"].RESET_PWD&&s.setData(a.username,a.newPassword),a.source===b["a"].INJECT_SSH)for(const e of a.sshkeys){const t=(this.$store.getters["cluster/all"](A["a"].SSH)||[]).find(t=>t.id===e);s.setData(`${t.metadata.namespace}-${t.metadata.name}`,t.spec.publicKey)}t.push(s)}try{for(const e of t)await e.save()}catch(s){return Promise.reject(s)}},getAccessCredentialsValidation(){const e=[];for(let t=0;t<this.accessCredentials.length;t++){const s=this.accessCredentials[t],a=s.source;if(a===b["a"].RESET_PWD){if(!s.username){const t=this.t("harvester.virtualMachine.input.username"),s=this.t("validation.required",{key:t});e.push(s)}if(!s.newPassword){const t=this.t("harvester.virtualMachine.input.password"),s=this.t("validation.required",{key:t});e.push(s)}if(s.newPassword&&s.newPassword.length<6){const t=this.t("harvester.virtualMachine.input.password"),s=this.t("validation.number.min",{key:t,val:"6"});e.push(s)}}else{if(!s.users||0===s.users.length){const t=this.t("harvester.virtualMachine.input.username"),s=this.t("validation.required",{key:t});e.push(s)}if(!s.sshkeys||0===s.sshkeys.length){const t=this.t("harvester.virtualMachine.input.sshKeyValue"),s=this.t("validation.required",{key:t});e.push(s)}}if(e.length>0)break}return e},getHasCreatedVolumes(e){const t=[];return e.template.spec.volumes&&e.template.spec.volumes.forEach(e=>{var s;null!==e&&void 0!==e&&null!==(s=e.persistentVolumeClaim)&&void 0!==s&&s.claimName&&t.push(e.persistentVolumeClaim.claimName)}),t},handlerUSBTablet(e){var t;const s=this.isInstallUSBTablet(this.spec),a=(null===(t=this.spec.template.spec.domain.devices)||void 0===t?void 0:t.inputs)||[];if(e&&!s)a.length>0?a.push(C["b"][0]):Object.assign(this.spec.template.spec.domain.devices,{inputs:[C["b"][0]]});else if(!e){const e=a.findIndex(e=>l()(e,C["b"][0]));s&&1===a.length?this.$delete(this.spec.template.spec.domain.devices,"inputs"):s&&(a.splice(e,1),this.$set(this.spec.template.spec.domain.devices,"inputs",a))}},setBootMethod(e={efi:!1,secureBoot:!1}){e.efi&&e.secureBoot?(Object(m["j"])(this.spec.template.spec.domain,"features.smm.enabled",!0),Object(m["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!0)):e.efi&&!e.secureBoot?(Object(m["j"])(this.spec.template.spec.domain,"features.smm.enabled",!1),Object(m["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!1)):(this.$delete(this.spec.template.spec.domain,"firmware"),this.$delete(this.spec.template.spec.domain.features,"smm"))},deleteSSHFromUserData(e=[]){const t=this.getSSHFromUserData(this.userScript);e.map(e=>{const s=t.findIndex(t=>t===this.getSSHValue(e));s>=0&&t.splice(s,1)});const s=this.convertToJson(this.userScript);s.ssh_authorized_keys=t,0===t.length&&delete s.ssh_authorized_keys,c()(s)?this.$set(this,"userScript",void 0):this.$set(this,"userScript",n.a.dump(s)),this.refreshYamlEditor()},refreshYamlEditor(){this.$nextTick(()=>{var e;null===(e=this.$refs.yamlEditor)||void 0===e||e.updateValue()})},toggleAdvanced(){this.showAdvanced=!this.showAdvanced},updateAgent(e){e||(this.deletePackage=!0)},updateDataTemplateId(e,t){if("user"===e){const e=this.installAgent;this.userDataTemplateId=t,this.$nextTick(()=>{e&&(this.installAgent=e)})}},updateReserved(e={}){const{memory:t}=e;this.$set(this,"reservedMemory",t)}},watch:{diskRows:{handler(e,t){if(Array.isArray(e)){var s,a;const i=null===(s=e[0])||void 0===s?void 0:s.image,o=this.images.find(e=>i===e.id),n=null===o||void 0===o?void 0:o.imageOSType,r=null===(a=t[0])||void 0===a?void 0:a.image;this.isCreate&&r===i&&i&&(this.osType=n)}}},secretRef:{handler(e){e&&this.resource!==A["a"].BACKUP&&(this.secretName=null===e||void 0===e?void 0:e.metadata.name)},immediate:!0,deep:!0},isWindows(e){e&&(this.$set(this,"sshKey",[]),this.$set(this,"userScript",void 0),this.$set(this,"installAgent",!1))},installUSBTablet(e){this.handlerUSBTablet(e)},efiEnabled(e){this.setBootMethod({efi:e,secureBoot:this.secureBoot})},secureBoot(e){this.setBootMethod({efi:this.efiEnabled,secureBoot:e})},installAgent:{handler(e){if(this.deleteAgent){let t=this.getUserData({installAgent:e,osType:this.osType,deletePackage:this.deletePackage});if(e){const e=this.hasCloudConfigComment(t);e||(t="#cloud-config\n"+t)}this.$set(this,"userScript",t),this.refreshYamlEditor()}this.deleteAgent=!0,this.deletePackage=!1}},osType(e){const t=this.getUserData({installAgent:this.installAgent,osType:e});this.$set(this,"userScript",t),this.refreshYamlEditor()},userScript(e,t){const s=this.hasInstallAgent(e,this.osType,this.installAgent);s!==this.installAgent&&(this.deleteAgent=!1,this.installAgent=s)},sshKey(e,t){const s=p()(t,e);s.length&&this.isEdit&&this.deleteSSHFromUserData(s)}}}},"6d1e":function(e,t,s){var a=s("bb25");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=s("0ed3").default;i("3bc4a900",a,!0,{sourceMap:!1,shadowMode:!1})},7026:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[e._v(" "+e._s(e.nodeName)+" "),t("CopyToClipboard",{staticClass:"icon-btn",attrs:{text:e.nodeName,"label-as":"tooltip","action-color":"bg-transparent"}})],1)},i=[],o=s("907c"),n=s("90cd"),r=s("e7e3"),l={components:{CopyToClipboard:r["a"]},props:{value:{type:String,default:""},row:{type:Object,required:!0}},data(){return{inStore:"harvester"}},created(){this.inStore=n["b"]},computed:{nodeName(){var e;return(null===(e=this.node)||void 0===e?void 0:e.nameDisplay)||""},vmi(){const e=this.$store.getters[this.inStore+"/all"](n["a"].VMI),t=e.find(e=>e.id===this.row.id)||null;return t},node(){var e;const t=null===(e=this.vmi)||void 0===e||null===(e=e.status)||void 0===e?void 0:e.nodeName;return this.$store.getters[this.inStore+"/byId"](o["s"],t)}}},d=l,c=s("d802"),u=Object(c["a"])(d,a,i,!1,null,null,null);t["default"]=u.exports},"70b3":function(e,t,s){"use strict";s("853d")},"7b56":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return e.value.length>0?t("n-link",{attrs:{to:e.to}},[e._v(" "+e._s(e.value.length)+" ")]):e._e()},i=[],o={props:{value:{type:Array,default:()=>[]},row:{type:Object,default:()=>({})}},computed:{to(){var e;const t=null===(e=this.row)||void 0===e?void 0:e.detailLocation;return t.hash="#instances",t}}},n=o,r=s("d802"),l=Object(r["a"])(n,a,i,!1,null,null,null);t["default"]=l.exports},"7d26":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[e._v(" "+e._s(e.GpuDescription)+" ")])},i=[],o={props:{row:{type:Object,required:!0}},computed:{GpuDescription(){const e=this.row.status.description,t=e.split(":");if(t.length>=2){const e=t.slice(1).join(":").trim();return e}return e}}},n=o,r=s("d802"),l=Object(r["a"])(n,a,i,!1,null,null,null);t["default"]=l.exports},"7e72":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("span",[t("span",[e._v(e._s(e.mainVM))]),t("br"),e.vms.length-1>0?t("span",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:e.attachedVMLabels,expression:"attachedVMLabels",modifiers:{bottom:!0}}],staticClass:"plus-more"},[e._v(e._s(e.t("generic.plusMore",{n:e.vms.length-1})))]):e._e()])},i=[],o=s("9ce4"),n=s("873f"),r={props:{row:{type:Object,default:()=>({})}},computed:{...Object(o["a"])({t:"i18n/t"}),vms(){const e=this.row.metadata.annotations[n["a"].NAD_OCCUPATION]?JSON.parse(this.row.metadata.annotations[n["a"].NAD_OCCUPATION]):"";return!(null===e||void 0===e||!e["attached-vm"])&&(null===e||void 0===e?void 0:e["attached-vm"])},attachedVMLabels(){if(Array.isArray(this.vms)&&this.vms.length>1){let e="";return this.vms.forEach((t,s)=>{e+=`&#8226; ${t}<br>`}),e}return null},mainVM(){const e=this.vms;return e[0]}}},l=r,d=s("d802"),c=Object(d["a"])(l,a,i,!1,null,null,null);t["default"]=c.exports},"853d":function(e,t,s){var a=s("60aa");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=s("0ed3").default;i("62a8e292",a,!0,{sourceMap:!1,shadowMode:!1})},"85af":function(e,t,s){var a=s("5eaa");t=a(!1),t.push([e.i,".text[data-v-d543d746]{text-align:center}",""]),e.exports=t},"95b7":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return e.to?t("n-link",{attrs:{to:e.to}},[e._v(" "+e._s(e.value)+" ")]):t("span",[e._v(" "+e._s(e.value)+" ")])},i=[],o=s("90cd"),n={props:{value:{type:String,default:""},row:{type:Object,default:()=>({})}},data(){const e=this.$store.getters[o["b"]+"/all"](o["a"].VM)||[];return{vmList:e}},computed:{vm(){const e=this.vmList.find(e=>e.id===`${this.row.metadata.namespace}/${this.value}`);return e},to(){var e;return null===(e=this.vm)||void 0===e?void 0:e.detailLocation}}},r=n,l=s("d802"),d=Object(l["a"])(r,a,i,!1,null,null,null);t["default"]=d.exports},"986d":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return e.state?t("div",[e.showSuccess?e._e():t("span",[e._v("/")]),t("BadgeState",{attrs:{label:e.vmiResource.migrationState.status,color:e.vmiResource.migrationStateBackground}})],1):e._e()},i=[],o=s("90cd"),n=s("f17a"),r={components:{BadgeState:n["a"]},props:{vmResource:{type:Object,required:!0},showSuccess:{type:Boolean,default:!0}},computed:{vmiResource(){const e=this.$store.getters[o["b"]+"/all"](o["a"].VMI)||[],t=e.find(e=>{var t,s;return(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.ownerReferences)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.uid)===(null===(s=this.vmResource)||void 0===s||null===(s=s.metadata)||void 0===s?void 0:s.uid)});return t},state(){var e;return(null===(e=this.vmiResource)||void 0===e||null===(e=e.migrationState)||void 0===e?void 0:e.status)||""}},watch:{state(e){this.$emit("state-changed",e)}}},l=r,d=(s("70b3"),s("d802")),c=Object(d["a"])(l,a,i,!1,null,"5ceec65a",null);t["default"]=c.exports},a858:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return e.showIP?t("div",e._l(e.ips,(function({ip:e}){return t("span",{key:e},[t("CopyToClipboardText",{attrs:{text:e}})],1)})),0):e._e()},i=[],o=s("44f6"),n=s("e24b"),r=s("2cb5"),l=s("873f"),d=s("90cd"),c=s("6834"),u=s("4a38"),p={components:{CopyToClipboardText:u["a"]},props:{value:{type:String,default:""},row:{type:Object,required:!0},col:{type:Object,default:()=>{}}},data(){return{inStore:"harvester"}},created(){this.inStore=d["b"]},computed:{ips(){return[...this.vmiIp,...this.networkAnnotationIP].filter(Boolean).sort((e,t)=>e.ip<t.ip?-1:1)},networkAnnotationIP(){if("Running"!==this.row.actualState)return[];const e=Object(n["g"])(this.row,`metadata.annotations."${l["a"].NETWORK_IPS}"`)||"[]";try{const t=JSON.parse(e);return t.map(e=>({ip:e.replace(/\/[\d\D]*/,""),name:""}))}catch(t){return[]}},vmiIp(){var e,t;const s=this.$store.getters[this.inStore+"/all"](d["a"].VMI),a=s.find(e=>e.id===this.value)||null,i=this.row.networksName||[],o=(null===a||void 0===a||null===(e=a.spec)||void 0===e?void 0:e.networks)||[];return((null===a||void 0===a||null===(t=a.status)||void 0===t?void 0:t.interfaces)||[]).filter(e=>Object(r["k"])(e.ipAddress)&&i.includes(e.name)).map(e=>{let t;const s=o.find(t=>t.name===e.name);return s&&s.multus?t=s.multus.networkName:s&&s.pod&&(t=c["a"]),{ip:e.ipAddress,name:t}})},showIP(){return this.row.stateDisplay!==o["OFF"]}}},h=p,m=s("d802"),v=Object(m["a"])(h,a,i,!1,null,null,null);t["default"]=v.exports},b1bd:function(e,t,s){var a=s("0ed6");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=s("0ed3").default;i("66aca528",a,!0,{sourceMap:!1,shadowMode:!1})},bb25:function(e,t,s){var a=s("5eaa");t=a(!1),t.push([e.i,".state[data-v-bc47731e]{display:flex;justify-content:space-between}.state .icon-warning[data-v-bc47731e]{margin-top:2px}.warning-message[data-v-bc47731e]:first-letter{text-transform:uppercase}",""]),e.exports=t},c3df:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("span",[t("div",{staticClass:"state"},[t("VolumeState",{attrs:{row:e.row}}),e.warningMessage?t("v-popover",{attrs:{trigger:"hover",offset:"16"}},[t("span",{staticClass:"tooltip-target"},[t("i",{staticClass:"icon icon-warning icon-lg text-warning"})]),t("template",{slot:"popover"},[t("p",{staticClass:"warning-message"},[e._v(" "+e._s(e.warningMessage)+" ")])])],2):e._e()],1)])},i=[],o=s("873f"),n=s("7b24"),r={components:{VolumeState:n["a"]},props:{row:{type:Object,required:!0}},computed:{warningMessage(){var e;return null===(e=this.row.relatedPV)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[o["a"].VOLUME_ERROR]}}},l=r,d=(s("fd85"),s("d802")),c=Object(d["a"])(l,a,i,!1,null,"bc47731e",null);t["default"]=c.exports},da1f:function(e,t,s){var a=s("5eaa");t=a(!1),t.push([e.i,".copy-to-clipboard-text.plain[data-v-f6a2b8be]{color:var(--body-text)}.copy-to-clipboard-text.plain[data-v-f6a2b8be]:hover{text-decoration:none}.copy-to-clipboard-text.copied[data-v-f6a2b8be]{pointer-events:none;color:var(--success)}",""]),e.exports=t},f9dd:function(e,t,s){"use strict";s("385b")},fd85:function(e,t,s){"use strict";s("6d1e")}}]);
//# sourceMappingURL=harvester-ift-0.1.0.umd.min.formatters.js.map